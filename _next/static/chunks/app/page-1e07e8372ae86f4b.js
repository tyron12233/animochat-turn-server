(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3287:()=>{},5001:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>ei});var r=n(5155);function s(){return(0,r.jsxs)("div",{className:"fixed inset-0 overflow-hidden pointer-events-none z-5",children:[(0,r.jsx)("div",{className:"absolute top-1/4 left-1/4 w-24 h-24 bg-gradient-to-r from-green-100 to-green-50 rounded-full opacity-50 animate-float mix-blend-multiply"}),(0,r.jsx)("div",{className:"absolute top-1/3 right-32 w-48 h-48 bg-green-100 rounded-full opacity-20 animate-blob animation-delay-2000"}),(0,r.jsx)("div",{className:"absolute top-2/3 left-16 w-16 h-16 bg-green-50 rotate-45 opacity-30 animate-float animation-delay-3000"}),(0,r.jsx)("div",{className:"absolute bottom-32 right-1/4",children:(0,r.jsx)("div",{className:"w-32 h-32 border-4 border-green-100 rounded-full animate-pulse opacity-30"})}),(0,r.jsx)("div",{className:"absolute inset-0 opacity-10",children:(0,r.jsx)("div",{className:"h-full w-full bg-[linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] bg-[size:24px_24px]"})}),(0,r.jsx)("div",{className:"absolute top-0 left-0 w-1/3 h-full animate-line",children:(0,r.jsx)("div",{className:"w-px h-full bg-gradient-to-b from-transparent via-green-100 to-transparent"})})]})}var i=n(2115),a=n(2596),o=n(9688);function l(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,o.QP)((0,a.$)(t))}let c=i.forwardRef((e,t)=>{let{className:n,type:s,...i}=e;return(0,r.jsx)("input",{type:s,className:l("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),ref:t,...i})});c.displayName="Input";var d=n(4624);let u=(0,n(2085).F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function m(e){let{className:t,variant:n,size:s,asChild:i=!1,...a}=e,o=i?d.DX:"button";return(0,r.jsx)(o,{"data-slot":"button",className:l(u({variant:n,size:s,className:t})),...a})}var x=n(6474),h=n(4416),p=n(5736);let g=(0,n(4982).UU)("https://wkafplnaexyyuobfufxa.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndrYWZwbG5hZXh5eXVvYmZ1ZnhhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0NjYwODEsImV4cCI6MjA2MTA0MjA4MX0.Sp9g2aWN24QoymYPoYJbxInnFNMautc26uJ1ba6Dvdc"),f=()=>{let[e,t]=(0,i.useState)(!1);return(0,r.jsxs)("div",{className:"w-[350px] max-w-full mx-auto my-6 bg-yellow-50 border border-yellow-200 rounded-lg shadow-sm transition-all duration-300",children:[(0,r.jsxs)("button",{onClick:()=>t(!e),className:"w-full flex justify-between items-center p-4 text-left font-semibold text-yellow-800 hover:bg-yellow-100 transition-colors focus:outline-none focus:ring-2 focus:ring-yellow-400 rounded-lg","aria-expanded":e,"aria-controls":"infobox-content",children:[(0,r.jsx)("span",{children:"A Quick Note on Peer-to-Peer Chat"}),(0,r.jsx)(x.A,{size:20,className:"transform transition-transform duration-300 ".concat(e?"rotate-180":"")})]}),e&&(0,r.jsxs)("div",{id:"infobox-content",className:"p-4 border-t border-yellow-200 text-sm text-yellow-900 animate-in fade-in-0 slide-in-from-top-2 duration-300",children:[(0,r.jsx)("p",{className:"mb-3",children:"We are developing peer-to-peer (P2P) chat to build a sustainable future for AnimoChat."}),(0,r.jsx)("p",{className:"mb-3",children:"Currently, AnimoChat does not generate any revenue, and we rely on the free tier of our online database (Supabase) to operate. Hosting servers for real-time chat is expensive."}),(0,r.jsx)("p",{className:"mb-3",children:"A P2P model allows users to connect directly, removing our dependency on costly central servers. This ensures the service can remain free and available for all of you guys."}),(0,r.jsx)("p",{className:"mt-3 font-semibold",children:"Thank you for your support!"})]})]})},b=()=>{let[e,t]=(0,i.useState)(!1);return(0,r.jsxs)("div",{className:"w-[350px] max-w-full mx-auto my-2 bg-blue-50 border border-blue-200 rounded-lg shadow-sm transition-all duration-300",children:[(0,r.jsxs)("button",{onClick:()=>t(!e),className:"w-full flex justify-between items-center p-4 text-left font-semibold text-blue-800 hover:bg-blue-100 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-400 rounded-lg","aria-expanded":e,"aria-controls":"updatesbox-content",children:[(0,r.jsx)("span",{children:"P2P Chat Development Updates"}),(0,r.jsx)(x.A,{size:20,className:"transform transition-transform duration-300 ".concat(e?"rotate-180":"")})]}),e&&(0,r.jsxs)("div",{id:"updatesbox-content",className:"p-4 border-t border-blue-200 text-sm text-blue-900 animate-in fade-in-0 slide-in-from-top-2 duration-300",children:[(0,r.jsx)("p",{className:"mb-3 font-semibold",children:"Thank you for your feedback! It helps us immensely. Here are the latest updates:"}),(0,r.jsxs)("ul",{className:"list-disc list-inside space-y-2",children:[(0,r.jsx)("li",{children:"Reactions are implemented."}),(0,r.jsx)("li",{children:"Editing messages is now possible."}),(0,r.jsx)("li",{children:"You can now reply to messages."}),(0,r.jsx)("li",{children:'Added a new "finding match" animation.'}),(0,r.jsx)("li",{children:"Improved connection speed with peers (BY A LOT) by removing the initial handshake."}),(0,r.jsxs)("li",{children:["The matchmaking protocol server is now open source! Check it out ",(0,r.jsx)("a",{href:"https://github.com/tyron12233/animochat-turn-server",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"here"}),"."]})]})]})]})},y=e=>{let{text:t,onRemove:n}=e;return(0,r.jsxs)("div",{className:"tag inline-flex items-center bg-green-600 text-white py-1 px-3 rounded-full m-1 font-medium text-sm transition-all duration-200 animate-in fade-in-50",children:[(0,r.jsx)("span",{children:t}),(0,r.jsx)("button",{onClick:()=>n(t),className:"ml-2 bg-black/10 hover:bg-black/30 rounded-full w-5 h-5 flex items-center justify-center transition-colors","aria-label":"Remove ".concat(t),children:(0,r.jsx)(h.A,{size:14})})]})},v=()=>(0,r.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),j=e=>{let{isOpen:t,onClose:n,onSubmit:s}=e,[a,o]=(0,i.useState)(""),[l,c]=(0,i.useState)(!1),[d,u]=(0,i.useState)(null),[x,g]=(0,i.useState)(!1),f=(0,i.useRef)(null);if((0,i.useEffect)(()=>{let e=e=>{"Escape"===e.key&&n()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[n]),(0,i.useEffect)(()=>{if(t){var e;null==(e=f.current)||e.focus(),o(""),c(!1),u(null),g(!1)}},[t]),!t)return null;let b=async e=>{if(e.preventDefault(),!a.trim())return void u("Feedback cannot be empty.");c(!0),u(null);try{await s(a),g(!0),setTimeout(()=>{n()},2e3)}catch(e){u("Failed to submit feedback. Please try again."),console.error(e)}finally{c(!1)}};return(0,r.jsx)("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center animate-in fade-in-50","aria-modal":"true",role:"dialog",children:(0,r.jsxs)("div",{ref:f,tabIndex:-1,className:"bg-white rounded-2xl shadow-2xl w-full max-w-md m-4 p-8 relative transform transition-all duration-300 scale-95 animate-in slide-in-from-bottom-10",children:[(0,r.jsx)("button",{onClick:n,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Close dialog",children:(0,r.jsx)(h.A,{size:24})}),(0,r.jsxs)("div",{className:"flex flex-col items-center text-center",children:[(0,r.jsx)("div",{className:"bg-green-100 p-3 rounded-full mb-4",children:(0,r.jsx)(p.A,{className:"text-green-600",size:32})}),(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Got a suggestion?"}),(0,r.jsx)("p",{className:"text-gray-500 mb-6",children:"We'd love to hear your ideas for new features or improvements."})]}),x?(0,r.jsx)("div",{className:"text-center p-4 bg-green-50 border border-green-200 rounded-lg",children:(0,r.jsx)("p",{className:"font-semibold text-green-700",children:"Thank you! Your feedback has been submitted."})}):(0,r.jsxs)("form",{onSubmit:b,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"feedback-content",className:"sr-only",children:"Your suggestion"}),(0,r.jsx)("textarea",{id:"feedback-content",value:a,onChange:e=>o(e.target.value),placeholder:"Type your suggestion here...",className:"w-full h-32 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors",required:!0})]}),d&&(0,r.jsx)("p",{className:"text-red-600 text-sm text-center",children:d}),(0,r.jsxs)(m,{type:"submit",disabled:l,className:"w-full rounded-full py-3 bg-green-600 hover:bg-green-700 text-white font-bold text-base disabled:bg-gray-400 disabled:cursor-wait flex items-center justify-center",children:[l&&(0,r.jsx)(v,{}),l?"Submitting...":"Submit Feedback"]})]})]})})};function w(e){let{interests:t,onInterestsChange:n,onFindMatch:s,isConnecting:a,status:o}=e,[l,d]=(0,i.useState)(""),[u,x]=(0,i.useState)([]),[h,w]=(0,i.useState)(!0),[N,k]=(0,i.useState)(null),[C,S]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(async()=>{w(!0);try{let e=await fetch("".concat("https://animochat-turn-server.onrender.com","/interests/popular"));if(!e.ok)throw Error("HTTP error! Status: ".concat(e.status));let t=await e.json();x(t)}catch(e){console.error("Failed to fetch popular interests:",e),k("Could not load topics.")}finally{w(!1)}})()},[]);let E=e=>{let r=e.trim().toUpperCase();r&&!t.has(r)&&n(new Set(t).add(r)),d("")},T=e=>{let r=new Set(t);r.delete(e),n(r)},I=async e=>{let{error:t}=await g.from("suggestions").insert([{content:e}]);if(t)throw console.error("Error submitting feedback to Supabase:",t),t};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"w-[350px] max-w-full mx-auto",children:[(0,r.jsx)("div",{className:"flex flex-wrap justify-center gap-2 min-h-[36px] mb-4",children:Array.from(t).map(e=>(0,r.jsx)(y,{text:e,onRemove:T},e))}),(0,r.jsx)(c,{id:"interest-input",type:"text",value:l,onChange:e=>d(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),E(l))},className:"rounded-full py-6 px-6 focus-visible:border-green-500 focus-visible:ring-green-500 ring-offset-1 text-center",placeholder:"Type an interest & press Enter",maxLength:26})]}),(0,r.jsxs)("div",{className:"mt-8 text-center",children:[(0,r.jsx)("h3",{className:"text-sm font-bold text-gray-500 uppercase tracking-wider mb-4",children:"Popular Topics"}),(0,r.jsx)("div",{className:"flex flex-wrap justify-center gap-2 max-w-md mx-auto",children:h?(0,r.jsx)("p",{className:"text-sm text-gray-400",children:"Loading topics..."}):N?(0,r.jsx)("p",{className:"text-sm text-red-500",children:N}):0===u.length?(0,r.jsx)("p",{className:"text-sm text-gray-400",children:"No active topics."}):u.map(e=>{let{interest:t,count:n}=e;return(0,r.jsxs)("button",{onClick:()=>E(t),className:"bg-green-100 text-green-800 text-xs font-semibold px-3 py-1.5 rounded-full hover:bg-green-200 hover:scale-105 transition-all duration-200",children:[(0,r.jsx)("span",{children:t}),(0,r.jsx)("span",{className:"bg-green-200 text-green-900 text-[10px] font-bold px-1.5 py-0.5 rounded-full ml-2",children:n})]},t)})})]}),(0,r.jsx)("div",{className:"mt-12 w-[350px] max-w-full mx-auto",children:(0,r.jsx)(m,{onClick:()=>{let e=new Set(t);l.trim()&&!e.has(l.trim().toUpperCase())&&n(e=new Set(e).add(l.trim().toUpperCase())),s(e)},disabled:a||0===t.size&&!l.trim(),className:"w-full rounded-full py-6 bg-green-600 hover:bg-green-700 text-white font-bold text-base disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center",children:a?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(v,{}),o]}):"Find Match"})}),(0,r.jsx)(f,{}),(0,r.jsx)(b,{}),(0,r.jsx)("div",{className:"text-center mt-6",children:(0,r.jsxs)(m,{variant:"secondary",className:"text-gray-500 hover:text-green-600 transition-colors",onClick:()=>S(!0),children:[(0,r.jsx)(p.A,{size:16,className:"mr-2"}),"We'd love to hear your feedback"]})}),(0,r.jsx)(j,{isOpen:C,onClose:()=>S(!1),onSubmit:I})]})}let N={id:"default",name:"Default Chat Theme",accentColor:"#16a34a",userBubbleGradient:"linear-gradient(90deg, #16a34a, #16a34a)",userTextColor:"#ffffff",otherBubbleGradient:"linear-gradient(90deg, #f3f4f6, #f3f4f6)",otherTextColor:"#1F2937",otherAnimated:!1,userAnimated:!1,chatBackground:"linear-gradient(180deg, #ffffff, #ffffff)"};var k=n(3319);function C(e){if(e.includes("linear-gradient")){let t=e.match(/#([0-9A-F]{6}|[0-9A-F]{3})/gi);if(t)return t.reduce((e,t)=>{let n="#"===t.charAt(0)?t.substring(1,7):t,r=parseInt(n.substring(0,2),16);return e+.299*r+.587*parseInt(n.substring(2,4),16)+.114*parseInt(n.substring(4,6),16)},0)/t.length>186?"#000000":"#ffffff"}let t="#"===e.charAt(0)?e.substring(1,7):e,n=parseInt(t.substring(0,2),16);return .299*n+.587*parseInt(t.substring(2,4),16)+.114*parseInt(t.substring(4,6),16)>186?"#000000":"#ffffff"}n(7351),n(3287);var S=n(892),E=n(8619),T=n(8829),I=n(7859),_=n(9424);function P(e){let{visible:t,isUserMessage:n,reply:s,onOpenEmojiMenu:i,theme:a,isDeleted:o=!1}=e;return(0,r.jsxs)("div",{className:"flex flex-row h-full min-h-full justify-center space-x-1 ".concat(t?"visible":"invisible"),children:[(0,r.jsx)("div",{className:"".concat(n?"mr-1 mt-1":"ml-2 mt-1"," h-[2rem] rounded-full transition-colors p-2 cursor-pointer hover:opacity-100 opacity-80"),style:{background:n?a.userBubbleGradient:a.otherBubbleGradient,color:n?a.userTextColor:a.otherTextColor},onClick:s,children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",strokeWidth:"2",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})}),!o&&(0,r.jsx)("div",{className:"mt-1 h-[2rem] opacity-80 rounded-full transition-colors p-2 cursor-pointer hover:opacity-100",onClick:i,style:{background:n?a.userBubbleGradient:a.otherBubbleGradient},children:(0,r.jsx)(_.A,{className:"w-4 h-4",style:{color:n?a.userTextColor:a.otherTextColor},fill:"none",strokeWidth:"2",stroke:"currentColor",viewBox:"0 0 24 24"})}),n&&(0,r.jsx)("div",{className:"w-1"})]},"actions")}var M=n(6766);function A(e){let{message:t,isUserMessage:n,theme:s}=e;return t?"image"===t.type?(0,r.jsx)(R,{message:t,isUserMessage:n,theme:s}):(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("div",{className:"rounded-tl-3xl rounded-tr-3xl rounded-b-3xl px-3 pt-2 text-sm opacity-[0.65] pb-[32px] -mb-[32px] -z-20",style:{background:n?s.userBubbleGradient:s.otherBubbleGradient,color:n?s.userTextColor:s.otherTextColor},children:(0,r.jsx)("p",{className:"break-words whitespace-pre-wrap",children:"deleted"===t.type?"Deleted message.":t.content})})}):null}function R(e){let{message:t,isUserMessage:n,theme:s}=e;return(0,r.jsx)("div",{className:"pb-[32px] -mb-[32px] rounded-tl-3xl rounded-tr-3xl rounded-b-3xl",children:(0,r.jsx)(M.default,{src:t.content,alt:"image",className:"rounded-tl-3xl rounded-tr-3xl rounded-b-3xl object-contain mb-1",width:80,height:100})})}function D(e){let{message:t,user:n,theme:s}=e,i=t.reactions;if(!i||0===i.length)return null;let a=i.length,o=Array.from(new Set(i.map(e=>e.emoji))),l=i.find(e=>e.user_id===n.id);return(0,r.jsx)(I.P.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},exit:{opacity:0,scale:0},transition:{duration:.2,ease:"easeOut"},className:"flex justify-end",children:(0,r.jsx)("div",{className:"self-end text-xs text-black relative rounded-full mt-auto bg-gray-200 border-2 border-white p-1.5 -top-2",children:(0,r.jsxs)("div",{className:"flex justify-center",children:[o.map((e,t)=>(0,r.jsx)("div",{className:"text-center",children:e},t)),(0,r.jsx)("p",{className:"pl-1",children:(0,r.jsx)("span",{style:{color:l?s.accentColor:"black"},children:a})})]})})})}var z=n(4032),F=n(9597);function L(e){var t,n,s;let{message:a,user:o,hovered:c,reply:d,animate:u=!1,onOpenEmojiMenu:m,onResendMessage:x,theme:h=N,advertisementMessageId:p,onLinkClick:g,onReact:f}=e,b=a.sender===o.id,y=(n=a.hasPrevious,s=a.hasNext,b?"rounded-tl-3xl rounded-bl-3xl ".concat(n?"rounded-tr-sm":"rounded-tr-3xl"," ").concat(s?"rounded-br-sm":"rounded-br-3xl"):"rounded-tr-3xl rounded-br-3xl ".concat(n?"rounded-tl-sm":"rounded-tl-3xl"," ").concat(s?"rounded-bl-sm":"rounded-bl-3xl")),v="sending"===a.status,j="error"===a.status,w=null!=(t=a.edited)&&t,k=a.content,S=function(e){let t=e.trim();if(!t)return!1;let n=t.replace(/\s+/g,""),r=RegExp("(\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F)","gu"),s=n.match(r);return!!s&&s.join("")===n}(k)&&3>=function(e){let t=e.trim().replace(/\s+/g,""),n=RegExp("(\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F)","gu"),r=t.match(n);return r?r.length:0}(k),_=(0,E.d)(0),M=(0,T.G)(_,b?[0,-30,-40,-50]:[0,30,40,50],[0,.5,.8,1]),R=function(e){let{delay:t=500}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(0,i.useRef)(null),r=(0,i.useRef)(!1),s=(0,i.useCallback)(()=>{null!==n.current&&(clearTimeout(n.current),n.current=null)},[]),a=(0,i.useCallback)(s=>{r.current=!1,n.current=window.setTimeout(()=>{e(s)},t)},[e,t]),o=(0,i.useCallback)(e=>{r.current=!0,s()},[s]);return{onTouchStart:a,onTouchMove:o,onTouchEnd:(0,i.useCallback)(e=>{r.current||e.stopPropagation(),s()},[s]),onTouchCancel:(0,i.useCallback)(e=>{s()},[s])}}(e=>{if("deleted"===a.type)return;m();let t=new TouchEvent("pointerup",{bubbles:!0,cancelable:!0,composed:!0});e.target.dispatchEvent(t)});return(0,r.jsxs)("div",{className:"relative flex w-full items-center ".concat(b?"justify-end":"justify-start"),children:[(0,r.jsx)(I.P.div,{className:l("absolute p-2.5 rounded-full",b?"right-0":"left-0"),style:{background:"".concat(h.accentColor,"15"),scale:M},children:(0,r.jsx)(z.A,{className:l("w-4 h-4"),style:{color:h.accentColor}})}),!j&&b&&(0,r.jsx)("p",{className:"opacity-50 text-[0.70rem] self-end pr-2 pb-2 overflow-clip -mr-[80px] ".concat(p!==a.id||c?"invisible":"visible"),style:{color:C(h.chatBackground)},children:"AnimoChat.com"}),b&&(0,r.jsx)(P,{isUserMessage:a.sender===o.id,visible:c,theme:h,reply:d,onOpenEmojiMenu:m,isDeleted:"deleted"===a.type}),j&&b&&(0,r.jsxs)("p",{className:"opacity-50 text-[0.70rem] self-end pr-2 pb-2 overflow-clip text-red-800",children:["Error sending message."," ",(0,r.jsx)("span",{className:"underline cursor-pointer",onClick:()=>x(a),children:"Retry"})]}),(0,r.jsxs)(I.P.div,{id:"message-bubble",dragSnapToOrigin:!0,dragTransition:{bounceDamping:13},drag:"x",dragConstraints:{left:0,right:0},onDrag:(e,t)=>{if((!b||!(t.offset.x>0))&&(b||!(t.offset.x<0))){if(document.querySelector("#emoji-overlay-main")){if(_.set(0),e instanceof TouchEvent){var n;let t=new TouchEvent("touchstart",{bubbles:!0,cancelable:!0,composed:!0,touches:[e.touches[0]]});null==(n=document)||n.dispatchEvent(t)}return}_.set(t.offset.x)}},onDragEnd:(e,t)=>{(b&&t.offset.x<-50||!b&&t.offset.x>50)&&!document.querySelector("#emoji-overlay-main")&&d(),_.set(0)},whileTap:{scale:.8},style:{x:_,originX:+!!b,WebkitTapHighlightColor:"transparent"},onDoubleClick:()=>{f("❤️")},..."deleted"!==a.type&&{onContextMenu:e=>{e.preventDefault(),e.stopPropagation(),m()}},...R,initial:!!u&&{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",duration:.4},className:"max-w-[75%] mb-0.5 flex flex-col ".concat(b?"items-end":"items-start"," ").concat(v?"opacity-50":""),children:[w&&(0,r.jsx)("p",{className:"text-[0.70rem] px-2 text-gray-500",children:"Edited"}),a.replyingTo&&(0,r.jsx)(A,{message:a.replyingTo,isUserMessage:b,theme:h}),(null===a.type||void 0===a.type||"text"===a.type||"deleted"===a.type)&&(0,r.jsx)(O,{isLargeEmojiMessage:S,message:a,user:o,theme:h,isUserMessage:b,roundedCorners:y,onLinkClick:g}),"image"===a.type&&(0,r.jsx)(B,{user:o,message:a,roundedCorners:y,isUserMessage:b,theme:h})]},a.id+"-bubble"),!b&&(0,r.jsx)(P,{visible:c,theme:h,isUserMessage:!1,reply:d,onOpenEmojiMenu:m}),!b&&(0,r.jsx)("p",{className:"opacity-50 text-[0.70rem] self-end pl-2 pb-2 -ml-[70px] ".concat(p!==a.id||c?"invisible":"visible"),style:{color:C(h.chatBackground)},children:"AnimoChat.com"})]},a.id)}function B(e){let{user:t,message:n,roundedCorners:s,isUserMessage:a,theme:o}=e,[l,c]=(0,i.useState)(!1),d="rounded-3xl ".concat(s," ").concat(a?"rounded-tr-3xl":"rounded-tl-3xl");return(0,r.jsxs)("div",{id:"image-message-container",onClick:()=>c(!0),style:{cursor:"pointer"},children:[(0,r.jsxs)("div",{className:d,style:{overflow:"hidden",position:"relative",border:"2px solid transparent"},children:[(0,r.jsx)(F.A8,{src:n.content,children:(0,r.jsx)(M.default,{width:Math.min(.6*window.innerWidth,300),height:Math.min(.6*window.innerWidth,300),className:d,src:n.content,alt:"Image",style:{filter:l?"none":"blur(8px)",transition:"filter 0.3s ease-in-out",maxWidth:"100%",objectFit:"contain",backgroundColor:o.chatBackground},sizes:"(max-width: 768px) 70vw, 400px"})},n.id),!l&&(0,r.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:o.userTextColor,backgroundColor:"rgba(0, 0, 0, 0.4)",padding:"4px 8px",borderRadius:"0.25rem",pointerEvents:"none",fontSize:"0.85rem"},children:"(tap to reveal)"})]}),(0,r.jsx)(D,{message:n,user:t,theme:o})]})}function O(e){let{message:t,user:n,theme:s,isUserMessage:i,roundedCorners:a,isLargeEmojiMessage:o,onLinkClick:l}=e,c="deleted"===t.type;return(0,r.jsx)(r.Fragment,{children:o?(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"px-2 py-2",children:[(0,r.jsx)("p",{className:"text-5xl",children:t.content}),(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)(D,{message:t,user:n,theme:s})})]})}):(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsxs)("div",{className:"relative group",children:[(0,r.jsx)("div",{className:"".concat(a," animate-gradient-x"),style:{background:i?s.userBubbleGradient:s.otherBubbleGradient,backgroundSize:"200% 100%",color:i?s.userTextColor:s.otherTextColor}}),(0,r.jsx)("div",{className:"".concat(a," relative max-w-full break-words px-3 py-2 ").concat(!i&&s.otherAnimated||i&&s.userAnimated?"bg-white opacity-70":""),style:{wordBreak:"break-word",overflowWrap:"break-word",color:i?s.userTextColor:s.otherTextColor},children:(0,r.jsx)("p",{className:"break-words whitespace-pre-wrap",children:(0,r.jsx)(S.A,{options:{attributes:{target:"_blank",rel:"noopener noreferrer",className:"underline"},render:e=>{let{attributes:t,content:n}=e;return(0,r.jsx)("a",{...t,onClick:e=>{l?l(e):e.stopPropagation()},children:n})}},children:c?(0,r.jsx)("span",{className:"italic",children:"Message has been deleted."}):t.content})})})]}),(0,r.jsx)(D,{message:t,user:n,theme:s})]})})}function W(e){let{message:t,user:n,onSwipe:s,onReact:a,onStartedSwipe:o,onEndedSwipe:l,animate:c=!1,theme:d=N,advertisementMessageId:u,onOpenEmojiMenu:m=()=>{},onResendMessage:x=()=>{},isEmojiMenuOpen:h,onLinkClick:p}=e,[g,f]=(0,i.useState)(!1),[b,y]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{y("ontouchstart"in window||navigator.maxTouchPoints>0)},[]),(0,r.jsx)("div",{"data-message-id":"message-"+t.id,className:"relative px-4 select-none",onMouseEnter:()=>!b&&f(!0),onMouseLeave:()=>!b&&f(!1),children:(0,r.jsx)("div",{children:(0,r.jsx)(L,{onLinkClick:p,animate:c,message:t,user:n,hovered:g,reply:()=>s(t.id),onOpenEmojiMenu:()=>m(t),onReact:e=>a(t.id,e),onResendMessage:x,theme:d,advertisementMessageId:u},t.id+"-bubble")},"parent-message-bubble flex flex-col")})}function Y(e){let{index:t,message:n,user:s,animate:i=!1,isLast:a=!1,onSwipe:o,onStartedSwipe:l,onEndedSwipe:c,onReact:d,onOpenEmojiMenu:u,onResendMessage:m,isEmojiMenuOpen:x,theme:h,secondVisibleElement:p,onLinkClick:g}=e;if("system"===n.sender)return(0,r.jsx)("div",{className:"flex justify-center py-4 px-4 text-center",children:(0,r.jsx)("p",{className:"text-xs text-gray-500",children:n.content})},n.id+"_system");let f=t%5==0?n.id:null;return(0,r.jsxs)("div",{"data-is-message":"true","data-message-id":n.id,className:"max-w-full w-full select-none",children:[n.showTime&&(0,r.jsx)("div",{className:"flex justify-center py-4",children:(0,r.jsx)("p",{className:"text-xs text-gray-500 font-normal",children:n.created_at&&(0,k.GP)(new Date(n.created_at),"h:mm a")})},n.id+"_time"),(0,r.jsx)(W,{advertisementMessageId:f,message:n,animate:i,user:s,onSwipe:o,onStartedSwipe:l,onEndedSwipe:c,onReact:d,onOpenEmojiMenu:u,onResendMessage:m,theme:h,isEmojiMenuOpen:x,onLinkClick:g},n.id+"_message"),(a||!n.hasNext)&&(0,r.jsx)("div",{className:"h-1"},n.id+"_bottom")]},"parent_message_"+n.id)}var U=n(760);let G=["❤️","\uD83D\uDE06","\uD83D\uDE2E","\uD83D\uDE22","\uD83D\uDE2D","\uD83D\uDE21","\uD83D\uDC4D"];function J(e){let{isUserMessage:t,preselectedEmoji:n,message:s,messageDiv:a,onReact:o,onClose:l}=e,c=(0,i.useRef)(null),[d,u]=(0,i.useState)({top:0,left:0}),[m,x]=(0,i.useState)(null),h=(0,i.useRef)(null);return(0,i.useLayoutEffect)(()=>{let e=a.querySelector("#message-bubble");if(e.style.position="relative",e.style.zIndex="30",e&&c.current){let t=e.getBoundingClientRect(),n=c.current,r=n.offsetHeight,s=t.top+window.scrollY-r-10,i=t.right-n.offsetWidth-16;e.classList.contains("items-end")||(i=t.left-16),u({top:s,left:i})}return()=>{e.style.zIndex="0"}},[a]),(0,i.useEffect)(()=>{let e=c.current;if(!e)return;let t=t=>{if(0!==t.button)return;try{e.setPointerCapture(t.pointerId)}catch(e){}h.current=t.pointerId;let n=document.elementFromPoint(t.clientX,t.clientY);if(n){let e=n.closest("[data-emoji]");if(e)return void x(e.getAttribute("data-emoji"))}x(null)},r=t=>{if(h.current!==t.pointerId||!e)return;let n=document.elementFromPoint(t.clientX,t.clientY);if(n){let e=n.closest("[data-emoji]");if(e)return void x(e.getAttribute("data-emoji"))}x(null)},i=t=>{if(h.current===t.pointerId){if(m){let e=(null==n?void 0:n.emoji)===m?null:m;o(s.id,e)}l();try{e.releasePointerCapture(t.pointerId)}catch(e){}h.current=null}};return e.addEventListener("pointerdown",t),window.addEventListener("pointermove",r),window.addEventListener("pointerup",i),()=>{e.removeEventListener("pointerdown",t),window.removeEventListener("pointermove",r),window.removeEventListener("pointerup",i)}},[m,o,l,n,s.id]),(0,r.jsx)(I.P.div,{layout:!0,className:"absolute top-0 left-0 w-screen h-screen",initial:{userSelect:"none",zIndex:100,opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:(0,r.jsx)("div",{id:"emoji-abs-container",className:"absolute border-box flex z-50 w-full md:w-fit px-4",style:{position:"absolute",top:d.top,left:d.left},children:(0,r.jsx)(I.P.div,{ref:c,id:"emoji-container-wrapper",className:"w-full backdrop-blur-md bg-gray-100 py-2 px-5 dark:bg-gray-800/80 shadow-lg rounded-full border border-gray-200 dark:border-gray-700",initial:{scale:.8,opacity:0,y:10},animate:{scale:1,opacity:1,y:0,transition:{type:"spring",stiffness:300,damping:20}},exit:{scale:.8,opacity:0,y:10,transition:{duration:.15}},children:(0,r.jsx)("div",{id:"emoji-container",className:"flex justify-between",children:(0,r.jsx)(U.N,{children:G.map(e=>(0,r.jsxs)(I.P.div,{className:"relative z-10 cursor-pointer rounded-full p-2 ".concat((null==n?void 0:n.emoji)===e?"bg-gray-200/80 dark:bg-gray-700/80":m===e?"bg-gray-100/80 dark:bg-gray-600/80":""),"data-emoji":e,animate:{scale:m===e?1.6:1},transition:{type:"spring",stiffness:300,damping:20},children:[(0,r.jsx)("span",{className:"text-xl",children:e}),(null==n?void 0:n.emoji)===e&&(0,r.jsx)(I.P.div,{className:"absolute -bottom-0.5 left-1/2 w-1 h-1 bg-green-500 rounded-full",initial:{opacity:0},animate:{opacity:1},layoutId:"selectedDot",style:{translateX:"-50%"}})]},e))})})})})},"emoji-menu")}var X=n(4357),q=n(3717),H=n(4126);function Z(e){let{theme:t,anchor:n,onReply:s,onCopy:a,onEdit:o,onClose:l,onDelete:c}=e,d=n.querySelector("#message-bubble"),u=d.classList.contains("items-end"),m=null!==d.querySelector("#image-message-container"),x=[{icon:(0,r.jsx)(z.A,{className:"h-4 w-4"}),text:"Reply",onClick:s},{icon:(0,r.jsx)(X.A,{className:"h-4 w-4"}),text:"Copy",onClick:a},...u&&!m?[{icon:(0,r.jsx)(q.A,{className:"h-4 w-4"}),text:"Edit",onClick:o}]:[],...u?[{icon:(0,r.jsx)(H.A,{className:"h-4 w-4"}),text:"Delete",onClick:c}]:[]],[h,p]=(0,i.useState)({top:0,left:0}),[g,f]=(0,i.useState)(null),b=(0,i.useRef)(null),y=(0,i.createRef)();return(0,i.useEffect)(()=>{b.current=g},[g]),(0,i.useLayoutEffect)(()=>{if(!n||!y.current)return;let e=n.querySelector("#message-bubble"),t=document.querySelector("#chat-container"),r=e.getBoundingClientRect(),s=y.current.getBoundingClientRect(),i=r.bottom+10;if(i+s.height>t.clientHeight/2){i=r.top-s.height-10;let e=document.querySelector("#emoji-abs-container");e&&(e.style.top="".concat(i-s.height,"px"),i-=e.offsetHeight+24)}i+=window.scrollY;let a=r.right-s.width-24;u||(a=r.left),p({top:i,left:a})},[n,u]),(0,i.useEffect)(()=>{let e=e=>{if(!y.current)return;let t=y.current.querySelectorAll("button"),n=null;t.forEach((t,r)=>{let s=t.getBoundingClientRect();e.clientX>=s.left&&e.clientX<=s.right&&e.clientY>=s.top&&e.clientY<=s.bottom&&(n=r)}),f(n)},t=e=>{if(null!==b.current&&y.current){let e=y.current.querySelectorAll("button")[b.current];e&&e.click()}};window.addEventListener("pointermove",e),window.addEventListener("pointerup",t);let n=new PointerEvent("pointerdown",{bubbles:!0});return window.dispatchEvent(n),()=>{window.removeEventListener("pointermove",e),window.removeEventListener("pointerup",t)}},[]),(0,r.jsx)(I.P.div,{ref:y,id:"context-menu",className:"absolute flex flex-col rounded-3xl w-[200px] overflow-clip",style:{background:(null==t?void 0:t.chatBackground)||"linear-gradient(180deg, #ffffff, #ffffff)",top:h.top,left:h.left},initial:{opacity:0,scale:.9,transition:{type:"spring",stiffness:300,damping:20}},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9,transition:{duration:.15}},children:x.map((e,t)=>(0,r.jsx)(V,{icon:e.icon,text:e.text,onClick:()=>{e.onClick(),l()},active:g===t},t))})}function V(e){let{icon:t,text:n,onClick:s,active:i}=e;return(0,r.jsx)("div",{children:(0,r.jsxs)("button",{onClick:s,className:"flex items-center justify-start w-full px-6 py-4 text-sm text-black hover:bg-gray-200 ".concat(i?"bg-gray-200":""),children:[(0,r.jsx)("p",{className:"mr-auto",children:n}),t]})})}let Q=e=>{var t,n,s,i;let{open:a,message:o,messageDiv:l,user:c,onReact:d,onClose:u,onCopy:m,onEdit:x,onReply:h,onDelete:p}=e;return(0,r.jsx)(U.N,{children:a&&(0,r.jsxs)("div",{id:"emoji-overlay-main",className:"overflow-visible absolute left-0 top-0 select-none",children:[(0,r.jsx)(I.P.div,{layout:!0,initial:{opacity:0},animate:{opacity:.5},exit:{opacity:0},className:"fixed inset-0 bg-black z-30",onClick:u},"emoji-overlay"),(0,r.jsxs)("div",{className:"relative z-40 w-full",children:[(0,r.jsx)(J,{isUserMessage:o.sender===c.id,preselectedEmoji:(null==(n=o.reactions)||null==(t=n.find(e=>e.user_id===c.id))?void 0:t.emoji)!=null?{emoji:null==(i=o.reactions)||null==(s=i.find(e=>e.user_id===c.id))?void 0:s.emoji}:void 0,messageDiv:l,message:o,onReact:d,onClose:u},"emoji-menu"),(0,r.jsx)(Z,{onCopy:()=>m(o.id),onEdit:()=>x(o.id),onReply:()=>h(o.id),onDelete:()=>p(o.id),onClose:u,theme:N,anchor:l},"context-menu")]},"context-container")]},"emoji-overlay-main")})},K=()=>(0,r.jsx)(I.P.div,{className:"flex justify-start",children:(0,r.jsxs)("div",{className:"flex mb-2 mx-4 max-w-[100%] rounded-3xl px-4 py-4 bg-gray-100 text-gray-800 relative",children:[(0,r.jsx)("div",{className:"h-2 w-2 bg-gray-800 rounded-full animate-bounce [animation-delay:-0.3s]"}),(0,r.jsx)("div",{className:"h-2 w-2 mx-1 bg-gray-800 rounded-full animate-bounce [animation-delay:-0.15s]"}),(0,r.jsx)("div",{className:"h-2 w-2 bg-gray-800 rounded-full animate-bounce"})]})},"typing-motiondiv"),$=(e,t)=>Math.random()*(t-e)+e,ee=e=>{let{a:t,d:n}=e,s=Math.cos(t)*n,i=Math.sin(t)*n,a=$(2,4),o=$(0,2),l=$(.8,1.2);return(0,r.jsx)(I.P.div,{className:"absolute bg-white rounded-full",style:{width:10,height:10,left:"50%",top:"50%",translateX:"-50%",translateY:"-50%"},initial:{x:0,y:0,scale:0},animate:{x:s,y:i,scale:l},transition:{duration:a,delay:o,repeat:1/0,repeatType:"reverse",ease:"easeInOut"}})},et=()=>{let e=Array.from({length:5}).map((e,t)=>({id:t,angle:t/5*2*Math.PI,distance:$(80,120)})),t={initial:{scale:0,opacity:1},animate:e=>({scale:1,opacity:0,transition:{delay:.7*e,duration:2.1,repeat:1/0,ease:"circOut"}})};return(0,r.jsxs)(I.P.div,{className:"absolute inset-0 flex flex-col items-center justify-center w-full h-full bg-green-500 overflow-hidden z-10",variants:{hidden:{opacity:0,scale:.95},visible:{opacity:1,scale:1,transition:{duration:.4,ease:"easeOut"}},exit:{opacity:0,scale:.95,transition:{duration:.3,ease:"easeIn"}}},initial:"hidden",animate:"visible",exit:"exit",children:[(0,r.jsxs)("div",{className:"relative w-64 h-64 flex items-center justify-center",children:[(0,r.jsx)(U.N,{children:[0,1,2].map(e=>(0,r.jsx)(I.P.div,{className:"absolute w-full h-full rounded-full border-2 border-white/50",variants:t,initial:"initial",animate:"animate",custom:e},e))}),(0,r.jsx)(I.P.div,{className:"relative w-24 h-24 bg-white rounded-full flex items-center justify-center shadow-lg",animate:{scale:[1,1.1,1]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:(0,r.jsx)("svg",{className:"w-12 h-12 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8s-9-3.582-9-8 4.03-8 9-8 9 3.582 9 8z"})})}),(0,r.jsx)("div",{className:"absolute w-full h-full",children:e.map(e=>(0,r.jsx)(ee,{a:e.angle,d:e.distance},e.id))})]}),(0,r.jsx)(I.P.p,{className:"mt-8 text-2xl font-semibold text-white tracking-wider",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.5,ease:"easeOut"},children:"Finding a match..."})]})};function en(e){let{messages:t,goBack:n,sendMessage:s,onStartTyping:a,onEditMessage:o,isStrangerTyping:l,endChat:d,newChat:u,onReact:x,peerId:h,status:p}=e,[g,f]=(0,i.useState)(""),[b,y]=(0,i.useState)(!1),v=(0,i.useRef)(null),j=(0,i.useRef)(!1),[w,k]=(0,i.useState)({open:!1}),C=(0,i.useRef)(!1),S=function(e){let[t,n]=(0,i.useState)([]);return(0,i.useEffect)(()=>{if(!e||0===e.length)return void n([]);let t=null,r=[];for(let n=0;n<e.length;n++){let s=e[n],i=new Date(s.created_at).getTime(),a=!1;isNaN(i)?console.warn("Invalid date encountered for message:",s.id):"system"!==s.sender&&"typing"!==s.id&&"filler"!==s.id&&(null===t||i-t>3e5)&&(a=!0,t=i),r.push({...s,showTime:a,hasPrevious:!1,hasNext:!1})}r=r.map(e=>{let t=e.replyingTo;if(t&&"string"==typeof t){let n=r.find(e=>e.id===t);if(n)return{...e,replyingTo:n}}return e});for(let e=0;e<r.length;e++){let t=r[e],n=r[e-1],s=r[e+1];if(!t)continue;t.hasPrevious=!!n&&n.sender===t.sender,t.hasNext=!!s&&s.sender===t.sender,t.showTime&&n&&(t.hasPrevious=!1,n.hasNext=!1),t.reactions&&t.reactions.length>0&&s&&(t.hasNext=!1,s.sender===t.sender&&(s.hasPrevious=!1)),t.replyingTo&&n&&(t.hasPrevious=!1,n.sender===t.sender&&(n.hasNext=!1)),t.replyingTo&&s&&(t.hasNext=!1,s.sender===t.sender&&(s.hasPrevious=!1)),n&&n.replyingTo&&(t.hasPrevious=!1,n.hasNext=!1);let i=r[e+1];i&&("system"===i.sender||"typing"===i.id||"filler"===i.id)&&(t.hasNext=!1)}let s=null,i=r.findIndex(e=>"typing"===e.id);-1!==i&&(s=r.splice(i,1)[0]);let a=new Set,o=r.filter(e=>!a.has(e.id)&&(a.add(e.id),!0));s&&o.push(s),n(o)},[e]),t}(t),[E,T]=(0,i.useState)(null),I=e=>{if(!e){k({open:!1}),C.current=!1;return}let t=document.querySelector('[data-message-id="'.concat(null==e?void 0:e.id,'"]'));t&&(C.current=!0,k({open:!0,message:e,messageDiv:t}))};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Q,{open:w.open,message:w.message,messageDiv:w.messageDiv,user:{id:h},onReact:x,onReply:e=>{let n=t.find(t=>t.id===e);n&&T({message:n,type:"replying",title:"Replying",description:n.content})},onEdit:e=>{let n=t.find(t=>t.id===e);n&&(f(n.content),T({message:n,type:"editing",title:"Editing",description:n.content}))},onCopy:e=>{let n=t.find(t=>t.id===e);n&&(navigator.clipboard.writeText(n.content).then(()=>{console.log("Message copied to clipboard")}).catch(e=>{console.error("Failed to copy message: ",e)}),I(null))},onDelete:e=>{t.find(t=>t.id===e)&&(console.log("Delete message with ID: ".concat(e)),I(null))},onClose:()=>I(null)}),(0,r.jsxs)("div",{id:"chat-container",className:"w-full max-w-md mx-auto h-[100dvh] flex flex-col bg-white/70 backdrop-blur-xl sm:rounded-[2rem] shadow-2xl overflow-hidden",children:[(0,r.jsxs)("div",{className:"p-4 bg-white/60 border-b border-gray-200/80 flex items-center shrink-0",children:["connected"!==p&&(0,r.jsx)(m,{variant:"outline",size:"sm",onClick:n,className:"rounded-full mr-2",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,r.jsx)("polyline",{points:"15 18 9 12 15 6"})})}),(0,r.jsxs)("div",{className:"text-left mr-auto ml-2",children:[(0,r.jsx)("p",{className:"text-xs font-medium text-gray-500",children:"Status"}),(0,r.jsx)("p",{className:"text-sm font-semibold text-green-600",children:p.charAt(0).toUpperCase()+p.slice(1)})]}),"connected"===p&&(0,r.jsx)(m,{variant:b?"destructive":"outline",size:"sm",onClick:()=>{b?(d(),y(!1)):y(!0)},className:"rounded-full",children:b?"Confirm?":"End Chat"}),"connected"!==p&&(0,r.jsx)(m,{variant:"default",size:"sm",onClick:u,className:"bg-green-600 rounded-full hover:bg-green-700",children:"New Chat"})]}),(0,r.jsxs)("div",{className:"p-2 text-center text-xs text-gray-500 bg-white/60 border-b border-gray-200/80 shrink-0",children:["not all features are implemented, still in early stages ",(0,r.jsx)("br",{})," ","-@tyronscott_"]}),(0,r.jsxs)("div",{ref:v,className:"flex-grow overflow-y-auto overflow-x-hidden py-4 flex flex-col-reverse",children:[l&&(0,r.jsx)(K,{}),"finding_match"!==p&&"connecting"!==p&&[...S].reverse().map((e,n)=>"system"===e.sender||"system"===e.type?(0,r.jsx)("div",{className:"text-center my-2",children:(0,r.jsx)("span",{className:"text-xs text-gray-500 bg-gray-100 rounded-full px-3 py-1",children:e.content})},n):(0,r.jsx)(Y,{index:n,message:e,user:{id:h},isLast:0===n,onSwipe:e=>{let n=t.find(t=>t.id===e);n&&T({message:n,type:"replying",title:"Replying",description:n.content})},onStartedSwipe:()=>{},onEndedSwipe:()=>{},onReact:x,onOpenEmojiMenu:()=>I(e),onResendMessage:()=>{},isEmojiMenuOpen:j,theme:N,animate:!1,secondVisibleElement:null},n)),(0,r.jsx)(U.N,{children:("finding_match"===p||"connecting"===p)&&(0,r.jsx)(et,{})})]}),E&&(0,r.jsx)("div",{className:"flex items-start gap-2 px-3 py-2 bg-gray-100 border-l-4 mb-2 relative",children:(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-xs font-semibold text-green-700",children:"replying"===E.type?"Replying to":"Editing"}),(0,r.jsx)("button",{type:"button",className:"ml-auto text-gray-400 hover:text-gray-600","aria-label":"Cancel",onClick:()=>T(null),children:(0,r.jsxs)("svg",{width:"18",height:"18",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:[(0,r.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,r.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,r.jsx)("div",{className:"text-xs text-gray-700 truncate max-w-xs",children:E.description})]})}),(0,r.jsx)("div",{className:"p-4 bg-white/60 border-t border-gray-200/80 shrink-0",children:(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault();let t=g.trim();if(t){var n;let e=null==E||null==(n=E.message)?void 0:n.id;if(e&&(null==E?void 0:E.type)==="editing"){null==o||o(e,t),T(null),f("");return}s(t,e),f(""),e&&T(null)}},className:"flex space-x-3",children:[(0,r.jsx)(c,{disabled:"connected"!==p,type:"text",value:g,onChange:e=>{f(e.target.value),a()},placeholder:"Type a message...",className:"text-[16px] flex-grow p-3 border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500 bg-white/80",autoComplete:"off",required:!0}),(0,r.jsx)(m,{type:"submit",disabled:!g.trim()||"connected"!==p,className:"bg-green-500 text-white font-bold w-12 h-12 rounded-full hover:bg-green-600 flex items-center justify-center shadow-lg",children:(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("line",{x1:"12",y1:"19",x2:"12",y2:"5"}),(0,r.jsx)("polyline",{points:"5 12 12 5 19 12"})]})})]})})]})]})}var er=n(5723);let es=()=>{let[e,t]=(0,i.useState)("intro"),[n,r]=(0,i.useState)("initializing"),[s,a]=(0,i.useState)([]),[o,l]=(0,i.useState)(""),[c,d]=(0,i.useState)(!1),[u,m]=(0,i.useState)(""),x=(0,i.useRef)(null),h=(0,i.useRef)(null),p=(0,i.useRef)(null),g=(0,i.useRef)(null),f=(0,i.useRef)([]),b=(e,t,n)=>{console.log("Handling reaction:",{messageId:e,emoji:t,userId:n}),a(r=>r.map(r=>{let s;if(r.id!==e||"system"===r.type)return r;let i=r.reactions||[],a=i.findIndex(e=>e.user_id===n);return a>-1?t?(s=[...i])[a]={user_id:n,emoji:t,message_id:e}:s=i.filter((e,t)=>t!==a):s=t?[...i,{user_id:n,emoji:t,message_id:e}]:i,{...r,reactions:s}}))},y=(0,i.useRef)(!1),v=async(e,t)=>{if(!h.current||!o)return void console.error("Connection not established or peerId not set.");let n=h.current;b(e,t||null,o),n&&n.open&&await n.send({type:"reaction",sender:o,content:{message_id:e,emoji:t||null,user_id:o}})};(0,i.useEffect)(()=>{r("initializing");try{let e=new er.xM;x.current=e,e.on("open",e=>{console.log("My peer ID is: "+e),l(e),r("ready")}),e.on("connection",e=>{console.log("Received connection from:",e.peer),g.current&&(clearTimeout(g.current),g.current=null),r("connecting"),t("chat"),h.current=e,j(e)}),e.on("error",e=>{console.error("PeerJS error:",e),r("error")}),e.on("disconnected",()=>{console.log("PeerJS disconnected."),r("disconnected"),x.current&&x.current.reconnect()})}catch(e){console.error("Failed to initialize PeerJS:",e),r("error")}return()=>{console.log("Cleaning up useAnimochat hook."),g.current&&clearTimeout(g.current),p.current&&p.current.close(),h.current&&h.current.close(),x.current&&x.current.destroy()}},[]);let j=(0,i.useCallback)(e=>{e.on("open",()=>{var n,s;g.current&&(clearTimeout(g.current),g.current=null),console.log("Connection established with:",e.peer),r("connected"),t("chat");let i="session_".concat(o,"_").concat(e.peer);m(i),console.log("METADATA: ",e.metadata);let l=null!=(s=null==(n=f.current)?void 0:n.join(", "))?s:"an unknown topic.";a([{id:"system_".concat(Date.now()),session_id:i,created_at:new Date().toISOString(),type:"system",content:"You are now connected with a stranger on ".concat(l),sender:"system"}])}),e.on("data",e=>{let t;try{t="string"==typeof e?JSON.parse(e):e}catch(t){console.error("Failed to parse incoming data:",e);return}if(console.log("Received packet:",t),"message"===t.type){let e=t.content;a(t=>[...t,e])}else if("reaction"===t.type){let{message_id:e,emoji:n,user_id:r}=t.content;b(e,n,r)}else if("typing"===t.type)d(t.content);else if("edit_message"===t.type){let{message_id:e,new_content:n,user_id:r}=t.content;a(t=>t.map(t=>t.id===e&&t.sender===r?{...t,content:n,edited:!0}:t))}}),e.on("close",()=>{console.log("Connection closed with:",e.peer),r("disconnected");let t={id:"system_".concat(Date.now()),session_id:u,created_at:new Date().toISOString(),type:"system",content:"The other user has disconnected.",sender:"system"};a(e=>[...e,t])}),e.on("error",e=>{console.error("Connection error:",e),r("error")})},[o,u]),w=(0,i.useCallback)(e=>{if(!o){console.error("Peer ID not set yet. Cannot start matchmaking."),r("error");return}t("chat"),r("finding_match");let n=e.join(","),s="".concat("https://animochat-turn-server.onrender.com","/matchmaking?userId=").concat(o,"&interest=").concat(n);console.log("Connecting to matchmaking server: ".concat(s));let i=new EventSource(s);p.current=i,i.onmessage=t=>{let n=JSON.parse(t.data);if(console.log("Matchmaking update:",n),"MATCHED"===n.state){if(console.log("Match found with user ".concat(n.matchedUserId," on interest ").concat(n.interest,"!")),r("connecting"),i.close(),f.current=n.interest.split(","),x.current){let t=x.current.connect(n.matchedUserId,{metadata:{interest:n.interest},reliable:!0});h.current=t,j(t),g.current&&clearTimeout(g.current),g.current=setTimeout(()=>{if(console.warn("Connection to ".concat(n.matchedUserId," timed out. Retrying...")),h.current&&!h.current.open){h.current.close(),h.current=null;let t={id:"system_".concat(Date.now()),session_id:u,created_at:new Date().toISOString(),type:"system",content:"Could not connect to the stranger. Finding a new one...",sender:"system"};a(e=>[...e,t]),w(e)}},1e4)}}else"WAITING"===n.state&&(console.log("Waiting for a match..."),r("waiting_for_match"))},i.onerror=e=>{console.error("EventSource failed:",e),r("error"),i.close()}},[o,j]);return{screen:e,status:n,messages:s,onReact:v,editMessage:(e,t)=>{if(!t||!e)return;if(!h.current||!o)return void console.error("Connection not established or peerId not set.");let n=h.current;y.current=!1,n&&n.open&&n.send({type:"typing",content:!1,sender:o}),a(n=>n.map(n=>n.id===e?{...n,content:t,edited:!0}:n)),n&&n.open&&n.send({type:"edit_message",content:{message_id:e,new_content:t,user_id:o},sender:o})},handleGetStarted:()=>{t("matchmaking")},startMatchmaking:w,sendMessage:(0,i.useCallback)((e,t)=>{if(h.current&&h.current.open&&o&&u){y.current=!1,h.current&&h.current.open&&h.current.send({type:"typing",content:!1,sender:o});let n={id:"msg_".concat(Date.now()),session_id:u,created_at:new Date().toISOString(),content:e,replyingTo:t,sender:o};h.current.send({type:"message",content:n,sender:o}),a(e=>[...e,n])}else console.error("Cannot send message, connection not open.")},[o,u]),disconnect:(0,i.useCallback)(()=>{h.current&&h.current.close(),g.current&&(clearTimeout(g.current),g.current=null),r("disconnected"),m(""),h.current=null,p.current&&(p.current.close(),p.current=null)},[]),onStartTyping:()=>{if(!o||!h.current)return void console.error("Connection not established or peerId not set.");let e=h.current;y.current||(y.current=!0,e&&e.open&&e.send({type:"typing",content:!0,sender:o}),setTimeout(()=>{y.current=!1,e&&e.open&&e.send({type:"typing",content:!1,sender:o})},3e3))},isStrangerTyping:c,peerId:o}};function ei(){let{screen:e,peerId:t,status:n,messages:a,startMatchmaking:o,disconnect:l,editMessage:c,sendMessage:d,onReact:u,onStartTyping:x,handleGetStarted:h,isStrangerTyping:p}=es(),[g,f]=(0,i.useState)(new Set),b=e=>{0!==e.size&&o(Array.from(e))};return(0,r.jsx)("div",{className:"h-full overflow-y-auto overflow-x-hidden",children:(0,r.jsxs)("main",{className:"container h-full mx-auto flex flex-col ".concat("chat"===e?"p-0":"px-4 py-8 md:py-16"),children:["chat"!==e&&(0,r.jsx)(s,{}),(0,r.jsx)("div",{className:"flex-grow flex flex-col justify-center items-center",children:(0,r.jsx)(U.N,{mode:"sync",children:(()=>{switch(e){case"chat":return(0,r.jsx)("div",{className:"h-full w-full flex items-center justify-center sm:p-4",children:(0,r.jsx)(en,{goBack:()=>{h()},onEditMessage:c,onStartTyping:x,isStrangerTyping:p,onReact:u,messages:a,sendMessage:d,newChat:()=>{b(g)},endChat:l,peerId:t,status:n})});case"matchmaking":return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"max-w-3xl mx-auto relative w-full",children:(0,r.jsxs)("div",{className:"text-center mb-12",children:[(0,r.jsx)("h2",{className:"text-4xl md:text-6xl font-bold bg-gradient-to-r from-green-600 to-green-400 bg-clip-text text-transparent",children:"Choose Your Interests"}),(0,r.jsx)("p",{className:"text-gray-600 text-lg my-8",children:"Find someone to chat with based on what you like."})]})}),(0,r.jsx)(w,{interests:g,onInterestsChange:f,onFindMatch:b,isConnecting:!1,status:n})]});default:return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"max-w-3xl mx-auto relative w-full",children:(0,r.jsxs)("div",{className:"text-center mb-12",children:[(0,r.jsxs)("h2",{className:"text-4xl md:text-6xl font-bold bg-gradient-to-r from-green-600 to-green-400 bg-clip-text text-transparent",children:["Real-time",(0,r.jsx)("br",{}),"Anonymous Chat"]}),(0,r.jsx)("p",{className:"text-gray-600 text-lg my-8",children:"Connect with students anonymously and securely."})]})}),(0,r.jsxs)("div",{className:"max-w-md mx-auto text-sm space-y-6 text-center",children:[(0,r.jsxs)("details",{className:"text-gray-500 bg-gray-50/80 p-3 rounded-2xl border border-gray-200",children:[(0,r.jsx)("summary",{className:"cursor-pointer font-medium hover:text-green-600",children:"What is Peer-to-Peer (P2P) Chat?"}),(0,r.jsx)("p",{className:"mt-2 text-left",children:'Peer-to-Peer chat means your messages go directly to the other user without passing through a central server. This provides better privacy and can be faster. Our server only helps to "introduce" two users to each other.'})]}),(0,r.jsx)("div",{className:"text-red-700 bg-red-50 p-4 rounded-2xl border border-red-200 font-medium",children:(0,r.jsx)("p",{children:"This is a test version of AnimoChat. Not all features are implemented, and you may encounter bugs."})})]}),(0,r.jsx)("div",{className:"text-center mt-12",children:(0,r.jsx)(m,{onClick:h,size:"lg",className:"rounded-full py-7 px-8 bg-green-500 hover:bg-green-600 text-white font-bold text-lg",children:"Get Started"})})]})}})()})}),"chat"!==e&&(0,r.jsxs)("footer",{className:"text-xs text-gray-500 text-center py-4 shrink-0",children:[(0,r.jsxs)("h3",{className:"py-4",children:["Created by developers from"," ",(0,r.jsx)("span",{className:"text-green-700 font-semibold",children:"De La Salle Lipa"})]}),t&&(0,r.jsxs)("p",{className:"font-mono text-gray-400 text-[10px] mt-2",children:["Your Peer ID: ",t]})]})]})})}},6379:(e,t,n)=>{Promise.resolve().then(n.bind(n,5001))},7351:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[817,664,441,684,358],()=>t(6379)),_N_E=e.O()}]);