(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3287:()=>{},5001:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>ea});var s=n(5155);function r(){return(0,s.jsxs)("div",{className:"fixed inset-0 overflow-hidden pointer-events-none z-5",children:[(0,s.jsx)("div",{className:"absolute top-1/4 left-1/4 w-24 h-24 bg-gradient-to-r from-green-100 to-green-50 rounded-full opacity-50 animate-float mix-blend-multiply"}),(0,s.jsx)("div",{className:"absolute top-1/3 right-32 w-48 h-48 bg-green-100 rounded-full opacity-20 animate-blob animation-delay-2000"}),(0,s.jsx)("div",{className:"absolute top-2/3 left-16 w-16 h-16 bg-green-50 rotate-45 opacity-30 animate-float animation-delay-3000"}),(0,s.jsx)("div",{className:"absolute bottom-32 right-1/4",children:(0,s.jsx)("div",{className:"w-32 h-32 border-4 border-green-100 rounded-full animate-pulse opacity-30"})}),(0,s.jsx)("div",{className:"absolute inset-0 opacity-10",children:(0,s.jsx)("div",{className:"h-full w-full bg-[linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] bg-[size:24px_24px]"})}),(0,s.jsx)("div",{className:"absolute top-0 left-0 w-1/3 h-full animate-line",children:(0,s.jsx)("div",{className:"w-px h-full bg-gradient-to-b from-transparent via-green-100 to-transparent"})})]})}var a=n(2115),i=n(2596),l=n(9688);function o(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,l.QP)((0,i.$)(t))}let c=a.forwardRef((e,t)=>{let{className:n,type:r,...a}=e;return(0,s.jsx)("input",{type:r,className:o("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),ref:t,...a})});c.displayName="Input";var d=n(4624);let u=(0,n(2085).F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function m(e){let{className:t,variant:n,size:r,asChild:a=!1,...i}=e,l=a?d.DX:"button";return(0,s.jsx)(l,{"data-slot":"button",className:o(u({variant:n,size:r,className:t})),...i})}var x=n(6474),h=n(4416),p=n(5736);let f=(0,n(4982).UU)("https://wkafplnaexyyuobfufxa.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndrYWZwbG5hZXh5eXVvYmZ1ZnhhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0NjYwODEsImV4cCI6MjA2MTA0MjA4MX0.Sp9g2aWN24QoymYPoYJbxInnFNMautc26uJ1ba6Dvdc"),g=()=>{let[e,t]=(0,a.useState)(!1);return(0,s.jsxs)("div",{className:"w-[350px] max-w-full mx-auto my-6 bg-yellow-50 border border-yellow-200 rounded-lg shadow-sm transition-all duration-300",children:[(0,s.jsxs)("button",{onClick:()=>t(!e),className:"w-full flex justify-between items-center p-4 text-left font-semibold text-yellow-800 hover:bg-yellow-100 transition-colors focus:outline-none focus:ring-2 focus:ring-yellow-400 rounded-lg","aria-expanded":e,"aria-controls":"infobox-content",children:[(0,s.jsx)("span",{children:"A Quick Note on Peer-to-Peer Chat"}),(0,s.jsx)(x.A,{size:20,className:"transform transition-transform duration-300 ".concat(e?"rotate-180":"")})]}),e&&(0,s.jsxs)("div",{id:"infobox-content",className:"p-4 border-t border-yellow-200 text-sm text-yellow-900 animate-in fade-in-0 slide-in-from-top-2 duration-300",children:[(0,s.jsx)("p",{className:"mb-3",children:"We are developing peer-to-peer (P2P) chat to build a sustainable future for AnimoChat."}),(0,s.jsx)("p",{className:"mb-3",children:"Currently, AnimoChat does not generate any revenue, and we rely on the free tier of our online database (Supabase) to operate. Hosting servers for real-time chat is expensive."}),(0,s.jsx)("p",{className:"mb-3",children:"A P2P model allows users to connect directly, removing our dependency on costly central servers. This ensures the service can remain free and available for all of you guys."}),(0,s.jsx)("p",{className:"mt-3 font-semibold",children:"Thank you for your support!"})]})]})},b=()=>{let[e,t]=(0,a.useState)(!1);return(0,s.jsxs)("div",{className:"w-[350px] max-w-full mx-auto my-2 bg-blue-50 border border-blue-200 rounded-lg shadow-sm transition-all duration-300",children:[(0,s.jsxs)("button",{onClick:()=>t(!e),className:"w-full flex justify-between items-center p-4 text-left font-semibold text-blue-800 hover:bg-blue-100 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-400 rounded-lg","aria-expanded":e,"aria-controls":"updatesbox-content",children:[(0,s.jsx)("span",{children:"P2P Chat Development Updates"}),(0,s.jsx)(x.A,{size:20,className:"transform transition-transform duration-300 ".concat(e?"rotate-180":"")})]}),e&&(0,s.jsxs)("div",{id:"updatesbox-content",className:"p-4 border-t border-blue-200 text-sm text-blue-900 animate-in fade-in-0 slide-in-from-top-2 duration-300",children:[(0,s.jsx)("p",{className:"mb-3 font-semibold",children:"Thank you for your feedback! It helps us immensely. Here are the latest updates:"}),(0,s.jsxs)("ul",{className:"list-disc list-inside space-y-2",children:[(0,s.jsx)("li",{children:"Reactions are implemented."}),(0,s.jsx)("li",{children:"Editing messages is now possible."}),(0,s.jsx)("li",{children:"You can now reply to messages."}),(0,s.jsx)("li",{children:'Added a new "finding match" animation.'}),(0,s.jsx)("li",{children:"Improved connection speed with peers (BY A LOT) by removing the initial handshake."}),(0,s.jsxs)("li",{children:["The matchmaking protocol server is now open source! Check it out ",(0,s.jsx)("a",{href:"https://github.com/tyron12233/animochat-turn-server",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"here"}),"."]})]})]})]})},y=e=>{let{text:t,onRemove:n}=e;return(0,s.jsxs)("div",{className:"tag inline-flex items-center bg-green-600 text-white py-1 px-3 rounded-full m-1 font-medium text-sm transition-all duration-200 animate-in fade-in-50",children:[(0,s.jsx)("span",{children:t}),(0,s.jsx)("button",{onClick:()=>n(t),className:"ml-2 bg-black/10 hover:bg-black/30 rounded-full w-5 h-5 flex items-center justify-center transition-colors","aria-label":"Remove ".concat(t),children:(0,s.jsx)(h.A,{size:14})})]})},v=()=>(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),j=e=>{let{isOpen:t,onClose:n,onSubmit:r}=e,[i,l]=(0,a.useState)(""),[o,c]=(0,a.useState)(!1),[d,u]=(0,a.useState)(null),[x,f]=(0,a.useState)(!1),g=(0,a.useRef)(null);if((0,a.useEffect)(()=>{let e=e=>{"Escape"===e.key&&n()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[n]),(0,a.useEffect)(()=>{if(t){var e;null==(e=g.current)||e.focus(),l(""),c(!1),u(null),f(!1)}},[t]),!t)return null;let b=async e=>{if(e.preventDefault(),!i.trim())return void u("Feedback cannot be empty.");c(!0),u(null);try{await r(i),f(!0),setTimeout(()=>{n()},2e3)}catch(e){u("Failed to submit feedback. Please try again."),console.error(e)}finally{c(!1)}};return(0,s.jsx)("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center animate-in fade-in-50","aria-modal":"true",role:"dialog",children:(0,s.jsxs)("div",{ref:g,tabIndex:-1,className:"bg-white rounded-2xl shadow-2xl w-full max-w-md m-4 p-8 relative transform transition-all duration-300 scale-95 animate-in slide-in-from-bottom-10",children:[(0,s.jsx)("button",{onClick:n,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Close dialog",children:(0,s.jsx)(h.A,{size:24})}),(0,s.jsxs)("div",{className:"flex flex-col items-center text-center",children:[(0,s.jsx)("div",{className:"bg-green-100 p-3 rounded-full mb-4",children:(0,s.jsx)(p.A,{className:"text-green-600",size:32})}),(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Got a suggestion?"}),(0,s.jsx)("p",{className:"text-gray-500 mb-6",children:"We'd love to hear your ideas for new features or improvements."})]}),x?(0,s.jsx)("div",{className:"text-center p-4 bg-green-50 border border-green-200 rounded-lg",children:(0,s.jsx)("p",{className:"font-semibold text-green-700",children:"Thank you! Your feedback has been submitted."})}):(0,s.jsxs)("form",{onSubmit:b,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"feedback-content",className:"sr-only",children:"Your suggestion"}),(0,s.jsx)("textarea",{id:"feedback-content",value:i,onChange:e=>l(e.target.value),placeholder:"Type your suggestion here...",className:"w-full h-32 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors",required:!0})]}),d&&(0,s.jsx)("p",{className:"text-red-600 text-sm text-center",children:d}),(0,s.jsxs)(m,{type:"submit",disabled:o,className:"w-full rounded-full py-3 bg-green-600 hover:bg-green-700 text-white font-bold text-base disabled:bg-gray-400 disabled:cursor-wait flex items-center justify-center",children:[o&&(0,s.jsx)(v,{}),o?"Submitting...":"Submit Feedback"]})]})]})})};function w(e){let{interests:t,onInterestsChange:n,onFindMatch:r,isConnecting:i,status:l}=e,[o,d]=(0,a.useState)(""),[u,x]=(0,a.useState)([]),[h,w]=(0,a.useState)(!0),[N,k]=(0,a.useState)(null),[C,S]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{w(!0);try{let e=await fetch("".concat("https://animochat-turn-server.onrender.com","/interests/popular"));if(!e.ok)throw Error("HTTP error! Status: ".concat(e.status));let t=await e.json();x(t)}catch(e){console.error("Failed to fetch popular interests:",e),k("Could not load topics.")}finally{w(!1)}})()},[]);let E=e=>{let s=e.trim().toUpperCase();s&&!t.has(s)&&n(new Set(t).add(s)),d("")},I=e=>{let s=new Set(t);s.delete(e),n(s)},_=async e=>{let{error:t}=await f.from("suggestions").insert([{content:e}]);if(t)throw console.error("Error submitting feedback to Supabase:",t),t};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"w-[350px] max-w-full mx-auto",children:[(0,s.jsx)("div",{className:"flex flex-wrap justify-center gap-2 min-h-[36px] mb-4",children:Array.from(t).map(e=>(0,s.jsx)(y,{text:e,onRemove:I},e))}),(0,s.jsx)(c,{id:"interest-input",type:"text",value:o,onChange:e=>d(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),E(o))},className:"rounded-full py-6 px-6 focus-visible:border-green-500 focus-visible:ring-green-500 ring-offset-1 text-center",placeholder:"Type an interest & press Enter",maxLength:26})]}),(0,s.jsxs)("div",{className:"mt-8 text-center",children:[(0,s.jsx)("h3",{className:"text-sm font-bold text-gray-500 uppercase tracking-wider mb-4",children:"Popular Topics"}),(0,s.jsx)("div",{className:"flex flex-wrap justify-center gap-2 max-w-md mx-auto",children:h?(0,s.jsx)("p",{className:"text-sm text-gray-400",children:"Loading topics..."}):N?(0,s.jsx)("p",{className:"text-sm text-red-500",children:N}):0===u.length?(0,s.jsx)("p",{className:"text-sm text-gray-400",children:"No active topics."}):u.map(e=>{let{interest:t,count:n}=e;return(0,s.jsxs)("button",{onClick:()=>E(t),className:"bg-green-100 text-green-800 text-xs font-semibold px-3 py-1.5 rounded-full hover:bg-green-200 hover:scale-105 transition-all duration-200",children:[(0,s.jsx)("span",{children:t}),(0,s.jsx)("span",{className:"bg-green-200 text-green-900 text-[10px] font-bold px-1.5 py-0.5 rounded-full ml-2",children:n})]},t)})})]}),(0,s.jsx)("div",{className:"mt-12 w-[350px] max-w-full mx-auto",children:(0,s.jsx)(m,{onClick:()=>{let e=new Set(t);o.trim()&&!e.has(o.trim().toUpperCase())&&n(e=new Set(e).add(o.trim().toUpperCase())),r(e)},disabled:i||0===t.size&&!o.trim(),className:"w-full rounded-full py-6 bg-green-600 hover:bg-green-700 text-white font-bold text-base disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center",children:i?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(v,{}),l]}):"Find Match"})}),(0,s.jsx)(g,{}),(0,s.jsx)(b,{}),(0,s.jsx)("div",{className:"text-center mt-6",children:(0,s.jsxs)(m,{variant:"secondary",className:"text-gray-500 hover:text-green-600 transition-colors",onClick:()=>S(!0),children:[(0,s.jsx)(p.A,{size:16,className:"mr-2"}),"We'd love to hear your feedback"]})}),(0,s.jsx)(j,{isOpen:C,onClose:()=>S(!1),onSubmit:_})]})}let N={id:"default",name:"Default Chat Theme",accentColor:"#16a34a",userBubbleGradient:"linear-gradient(90deg, #16a34a, #16a34a)",userTextColor:"#ffffff",otherBubbleGradient:"linear-gradient(90deg, #f3f4f6, #f3f4f6)",otherTextColor:"#1F2937",otherAnimated:!1,userAnimated:!1,chatBackground:"linear-gradient(180deg, #ffffff, #ffffff)"};var k=n(3319);function C(e){if(e.includes("linear-gradient")){let t=e.match(/#([0-9A-F]{6}|[0-9A-F]{3})/gi);if(t)return t.reduce((e,t)=>{let n="#"===t.charAt(0)?t.substring(1,7):t,s=parseInt(n.substring(0,2),16);return e+.299*s+.587*parseInt(n.substring(2,4),16)+.114*parseInt(n.substring(4,6),16)},0)/t.length>186?"#000000":"#ffffff"}let t="#"===e.charAt(0)?e.substring(1,7):e,n=parseInt(t.substring(0,2),16);return .299*n+.587*parseInt(t.substring(2,4),16)+.114*parseInt(t.substring(4,6),16)>186?"#000000":"#ffffff"}n(7351),n(3287);var S=n(892),E=n(8619),I=n(8829),_=n(7859),T=n(9424);function M(e){let{visible:t,isUserMessage:n,reply:r,onOpenEmojiMenu:a,theme:i,isDeleted:l=!1}=e;return(0,s.jsxs)("div",{className:"flex flex-row h-full min-h-full justify-center space-x-1 ".concat(t?"visible":"invisible"),children:[(0,s.jsx)("div",{className:"".concat(n?"mr-1 mt-1":"ml-2 mt-1"," h-[2rem] rounded-full transition-colors p-2 cursor-pointer hover:opacity-100 opacity-80"),style:{background:n?i.userBubbleGradient:i.otherBubbleGradient,color:n?i.userTextColor:i.otherTextColor},onClick:r,children:(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",strokeWidth:"2",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})}),!l&&(0,s.jsx)("div",{className:"mt-1 h-[2rem] opacity-80 rounded-full transition-colors p-2 cursor-pointer hover:opacity-100",onClick:a,style:{background:n?i.userBubbleGradient:i.otherBubbleGradient},children:(0,s.jsx)(T.A,{className:"w-4 h-4",style:{color:n?i.userTextColor:i.otherTextColor},fill:"none",strokeWidth:"2",stroke:"currentColor",viewBox:"0 0 24 24"})}),n&&(0,s.jsx)("div",{className:"w-1"})]},"actions")}var P=n(6766);function A(e){let{message:t,isUserMessage:n,theme:r}=e;return t?"image"===t.type?(0,s.jsx)(R,{message:t,isUserMessage:n,theme:r}):(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{className:"rounded-tl-3xl rounded-tr-3xl rounded-b-3xl px-3 pt-2 text-sm opacity-[0.65] pb-[32px] -mb-[32px] -z-20",style:{background:n?r.userBubbleGradient:r.otherBubbleGradient,color:n?r.userTextColor:r.otherTextColor},children:(0,s.jsx)("p",{className:"break-words whitespace-pre-wrap",children:"deleted"===t.type?"Deleted message.":t.content})})}):null}function R(e){let{message:t,isUserMessage:n,theme:r}=e;return(0,s.jsx)("div",{className:"pb-[32px] -mb-[32px] rounded-tl-3xl rounded-tr-3xl rounded-b-3xl",children:(0,s.jsx)(P.default,{src:t.content,alt:"image",className:"rounded-tl-3xl rounded-tr-3xl rounded-b-3xl object-contain mb-1",width:80,height:100})})}function D(e){let{message:t,user:n,theme:r}=e,a=t.reactions;if(!a||0===a.length)return null;let i=a.length,l=Array.from(new Set(a.map(e=>e.emoji))),o=a.find(e=>e.user_id===n.id);return(0,s.jsx)(_.P.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},exit:{opacity:0,scale:0},transition:{duration:.2,ease:"easeOut"},className:"flex justify-end",children:(0,s.jsx)("div",{className:"self-end text-xs text-black relative rounded-full mt-auto bg-gray-200 border-2 border-white p-1.5 -top-2",children:(0,s.jsxs)("div",{className:"flex justify-center",children:[l.map((e,t)=>(0,s.jsx)("div",{className:"text-center",children:e},t)),(0,s.jsx)("p",{className:"pl-1",children:(0,s.jsx)("span",{style:{color:o?r.accentColor:"black"},children:i})})]})})})}var z=n(4032),L=n(9597);function F(e){var t,n,r;let{message:i,user:l,hovered:c,reply:d,animate:u=!1,onOpenEmojiMenu:m,onResendMessage:x,theme:h=N,advertisementMessageId:p,onLinkClick:f,onReact:g}=e,b=i.sender===l.id,y=(n=i.hasPrevious,r=i.hasNext,b?"rounded-tl-3xl rounded-bl-3xl ".concat(n?"rounded-tr-sm":"rounded-tr-3xl"," ").concat(r?"rounded-br-sm":"rounded-br-3xl"):"rounded-tr-3xl rounded-br-3xl ".concat(n?"rounded-tl-sm":"rounded-tl-3xl"," ").concat(r?"rounded-bl-sm":"rounded-bl-3xl")),v="sending"===i.status,j="error"===i.status,w=null!=(t=i.edited)&&t,k=i.content,S=function(e){let t=e.trim();if(!t)return!1;let n=t.replace(/\s+/g,""),s=RegExp("(\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F)","gu"),r=n.match(s);return!!r&&r.join("")===n}(k)&&3>=function(e){let t=e.trim().replace(/\s+/g,""),n=RegExp("(\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F)","gu"),s=t.match(n);return s?s.length:0}(k),T=(0,E.d)(0),P=(0,I.G)(T,b?[0,-30,-40,-50]:[0,30,40,50],[0,.5,.8,1]),R=function(e){let{delay:t=500}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(0,a.useRef)(null),s=(0,a.useRef)(!1),r=(0,a.useCallback)(()=>{null!==n.current&&(clearTimeout(n.current),n.current=null)},[]),i=(0,a.useCallback)(r=>{s.current=!1,n.current=window.setTimeout(()=>{e(r)},t)},[e,t]),l=(0,a.useCallback)(e=>{s.current=!0,r()},[r]);return{onTouchStart:i,onTouchMove:l,onTouchEnd:(0,a.useCallback)(e=>{s.current||e.stopPropagation(),r()},[r]),onTouchCancel:(0,a.useCallback)(e=>{r()},[r])}}(e=>{if("deleted"===i.type)return;m();let t=new TouchEvent("pointerup",{bubbles:!0,cancelable:!0,composed:!0});e.target.dispatchEvent(t)});return(0,s.jsxs)("div",{className:"relative flex w-full items-center ".concat(b?"justify-end":"justify-start"),children:[(0,s.jsx)(_.P.div,{className:o("absolute p-2.5 rounded-full",b?"right-0":"left-0"),style:{background:"".concat(h.accentColor,"15"),scale:P},children:(0,s.jsx)(z.A,{className:o("w-4 h-4"),style:{color:h.accentColor}})}),!j&&b&&(0,s.jsx)("p",{className:"opacity-50 text-[0.70rem] self-end pr-2 pb-2 overflow-clip -mr-[80px] ".concat(p!==i.id||c?"invisible":"visible"),style:{color:C(h.chatBackground)},children:"AnimoChat.com"}),b&&(0,s.jsx)(M,{isUserMessage:i.sender===l.id,visible:c,theme:h,reply:d,onOpenEmojiMenu:m,isDeleted:"deleted"===i.type}),j&&b&&(0,s.jsxs)("p",{className:"opacity-50 text-[0.70rem] self-end pr-2 pb-2 overflow-clip text-red-800",children:["Error sending message."," ",(0,s.jsx)("span",{className:"underline cursor-pointer",onClick:()=>x(i),children:"Retry"})]}),(0,s.jsxs)(_.P.div,{id:"message-bubble",dragSnapToOrigin:!0,dragTransition:{bounceDamping:13},drag:"x",dragConstraints:{left:0,right:0},onDrag:(e,t)=>{if((!b||!(t.offset.x>0))&&(b||!(t.offset.x<0))){if(document.querySelector("#emoji-overlay-main")){if(T.set(0),e instanceof TouchEvent){var n;let t=new TouchEvent("touchstart",{bubbles:!0,cancelable:!0,composed:!0,touches:[e.touches[0]]});null==(n=document)||n.dispatchEvent(t)}return}T.set(t.offset.x)}},onDragEnd:(e,t)=>{(b&&t.offset.x<-50||!b&&t.offset.x>50)&&!document.querySelector("#emoji-overlay-main")&&d(),T.set(0)},whileTap:{scale:.8},style:{x:T,originX:+!!b,WebkitTapHighlightColor:"transparent"},onDoubleClick:()=>{g("❤️")},..."deleted"!==i.type&&{onContextMenu:e=>{e.preventDefault(),e.stopPropagation(),m()}},...R,initial:!!u&&{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",duration:.4},className:"max-w-[75%] mb-0.5 flex flex-col ".concat(b?"items-end":"items-start"," ").concat(v?"opacity-50":""),children:[w&&(0,s.jsx)("p",{className:"text-[0.70rem] px-2 text-gray-500",children:"Edited"}),i.replyingTo&&(0,s.jsx)(A,{message:i.replyingTo,isUserMessage:b,theme:h}),(null===i.type||void 0===i.type||"text"===i.type||"deleted"===i.type)&&(0,s.jsx)(O,{isLargeEmojiMessage:S,message:i,user:l,theme:h,isUserMessage:b,roundedCorners:y,onLinkClick:f}),"image"===i.type&&(0,s.jsx)(B,{user:l,message:i,roundedCorners:y,isUserMessage:b,theme:h})]},i.id+"-bubble"),!b&&(0,s.jsx)(M,{visible:c,theme:h,isUserMessage:!1,reply:d,onOpenEmojiMenu:m}),!b&&(0,s.jsx)("p",{className:"opacity-50 text-[0.70rem] self-end pl-2 pb-2 -ml-[70px] ".concat(p!==i.id||c?"invisible":"visible"),style:{color:C(h.chatBackground)},children:"AnimoChat.com"})]},i.id)}function B(e){let{user:t,message:n,roundedCorners:r,isUserMessage:i,theme:l}=e,[o,c]=(0,a.useState)(!1),d="rounded-3xl ".concat(r," ").concat(i?"rounded-tr-3xl":"rounded-tl-3xl");return(0,s.jsxs)("div",{id:"image-message-container",onClick:()=>c(!0),style:{cursor:"pointer"},children:[(0,s.jsxs)("div",{className:d,style:{overflow:"hidden",position:"relative",border:"2px solid transparent"},children:[(0,s.jsx)(L.A8,{src:n.content,children:(0,s.jsx)(P.default,{width:Math.min(.6*window.innerWidth,300),height:Math.min(.6*window.innerWidth,300),className:d,src:n.content,alt:"Image",style:{filter:o?"none":"blur(8px)",transition:"filter 0.3s ease-in-out",maxWidth:"100%",objectFit:"contain",backgroundColor:l.chatBackground},sizes:"(max-width: 768px) 70vw, 400px"})},n.id),!o&&(0,s.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:l.userTextColor,backgroundColor:"rgba(0, 0, 0, 0.4)",padding:"4px 8px",borderRadius:"0.25rem",pointerEvents:"none",fontSize:"0.85rem"},children:"(tap to reveal)"})]}),(0,s.jsx)(D,{message:n,user:t,theme:l})]})}function O(e){let{message:t,user:n,theme:r,isUserMessage:a,roundedCorners:i,isLargeEmojiMessage:l,onLinkClick:o}=e,c="deleted"===t.type;return(0,s.jsx)(s.Fragment,{children:l?(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"px-2 py-2",children:[(0,s.jsx)("p",{className:"text-5xl",children:t.content}),(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)(D,{message:t,user:n,theme:r})})]})}):(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsxs)("div",{className:"relative group",children:[(0,s.jsx)("div",{className:"".concat(i," animate-gradient-x"),style:{background:a?r.userBubbleGradient:r.otherBubbleGradient,backgroundSize:"200% 100%",color:a?r.userTextColor:r.otherTextColor}}),(0,s.jsx)("div",{className:"".concat(i," relative max-w-full break-words px-3 py-2 ").concat(!a&&r.otherAnimated||a&&r.userAnimated?"bg-white opacity-70":""),style:{wordBreak:"break-word",overflowWrap:"break-word",color:a?r.userTextColor:r.otherTextColor},children:(0,s.jsx)("p",{className:"break-words whitespace-pre-wrap",children:(0,s.jsx)(S.A,{options:{attributes:{target:"_blank",rel:"noopener noreferrer",className:"underline"},render:e=>{let{attributes:t,content:n}=e;return(0,s.jsx)("a",{...t,onClick:e=>{o?o(e):e.stopPropagation()},children:n})}},children:c?(0,s.jsx)("span",{className:"italic",children:"Message has been deleted."}):t.content})})})]}),(0,s.jsx)(D,{message:t,user:n,theme:r})]})})}function W(e){let{message:t,user:n,onSwipe:r,onReact:i,onStartedSwipe:l,onEndedSwipe:o,animate:c=!1,theme:d=N,advertisementMessageId:u,onOpenEmojiMenu:m=()=>{},onResendMessage:x=()=>{},isEmojiMenuOpen:h,onLinkClick:p}=e,[f,g]=(0,a.useState)(!1),[b,y]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{y("ontouchstart"in window||navigator.maxTouchPoints>0)},[]),(0,s.jsx)("div",{"data-message-id":"message-"+t.id,className:"relative px-4 select-none",onMouseEnter:()=>!b&&g(!0),onMouseLeave:()=>!b&&g(!1),children:(0,s.jsx)("div",{children:(0,s.jsx)(F,{onLinkClick:p,animate:c,message:t,user:n,hovered:f,reply:()=>r(t.id),onOpenEmojiMenu:()=>m(t),onReact:e=>i(t.id,e),onResendMessage:x,theme:d,advertisementMessageId:u},t.id+"-bubble")},"parent-message-bubble flex flex-col")})}function U(e){let{index:t,message:n,user:r,animate:a=!1,isLast:i=!1,onSwipe:l,onStartedSwipe:o,onEndedSwipe:c,onReact:d,onOpenEmojiMenu:u,onResendMessage:m,isEmojiMenuOpen:x,theme:h,secondVisibleElement:p,onLinkClick:f}=e;if("system"===n.sender)return(0,s.jsx)("div",{className:"flex justify-center py-4 px-4 text-center",children:(0,s.jsx)("p",{className:"text-xs text-gray-500",children:n.content})},n.id+"_system");let g=t%5==0?n.id:null;return(0,s.jsxs)("div",{"data-is-message":"true","data-message-id":n.id,className:"max-w-full w-full select-none",children:[n.showTime&&(0,s.jsx)("div",{className:"flex justify-center py-4",children:(0,s.jsx)("p",{className:"text-xs text-gray-500 font-normal",children:n.created_at&&(0,k.GP)(new Date(n.created_at),"h:mm a")})},n.id+"_time"),(0,s.jsx)(W,{advertisementMessageId:g,message:n,animate:a,user:r,onSwipe:l,onStartedSwipe:o,onEndedSwipe:c,onReact:d,onOpenEmojiMenu:u,onResendMessage:m,theme:h,isEmojiMenuOpen:x,onLinkClick:f},n.id+"_message"),(i||!n.hasNext)&&(0,s.jsx)("div",{className:"h-1"},n.id+"_bottom")]},"parent_message_"+n.id)}var Y=n(760);let G=["❤️","\uD83D\uDE06","\uD83D\uDE2E","\uD83D\uDE22","\uD83D\uDE2D","\uD83D\uDE21","\uD83D\uDC4D"];function X(e){let{isUserMessage:t,preselectedEmoji:n,message:r,messageDiv:i,onReact:l,onClose:o}=e,c=(0,a.useRef)(null),[d,u]=(0,a.useState)({top:0,left:0}),[m,x]=(0,a.useState)(null),h=(0,a.useRef)(null);return(0,a.useLayoutEffect)(()=>{let e=i.querySelector("#message-bubble");if(e.style.position="relative",e.style.zIndex="30",e&&c.current){let t=e.getBoundingClientRect(),n=c.current,s=n.offsetHeight,r=t.top+window.scrollY-s-10,a=t.right-n.offsetWidth-16;e.classList.contains("items-end")||(a=t.left-16),u({top:r,left:a})}return()=>{e.style.zIndex="0"}},[i]),(0,a.useEffect)(()=>{let e=c.current;if(!e)return;let t=t=>{if(0!==t.button)return;try{e.setPointerCapture(t.pointerId)}catch(e){}h.current=t.pointerId;let n=document.elementFromPoint(t.clientX,t.clientY);if(n){let e=n.closest("[data-emoji]");if(e)return void x(e.getAttribute("data-emoji"))}x(null)},s=t=>{if(h.current!==t.pointerId||!e)return;let n=document.elementFromPoint(t.clientX,t.clientY);if(n){let e=n.closest("[data-emoji]");if(e)return void x(e.getAttribute("data-emoji"))}x(null)},a=t=>{if(h.current===t.pointerId){if(m){let e=(null==n?void 0:n.emoji)===m?null:m;l(r.id,e)}o();try{e.releasePointerCapture(t.pointerId)}catch(e){}h.current=null}};return e.addEventListener("pointerdown",t),window.addEventListener("pointermove",s),window.addEventListener("pointerup",a),()=>{e.removeEventListener("pointerdown",t),window.removeEventListener("pointermove",s),window.removeEventListener("pointerup",a)}},[m,l,o,n,r.id]),(0,s.jsx)(_.P.div,{layout:!0,className:"absolute top-0 left-0 w-screen h-screen",initial:{userSelect:"none",zIndex:100,opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:(0,s.jsx)("div",{id:"emoji-abs-container",className:"absolute border-box flex z-50 w-full md:w-fit px-4",style:{position:"absolute",top:d.top,left:d.left},children:(0,s.jsx)(_.P.div,{ref:c,id:"emoji-container-wrapper",className:"w-full backdrop-blur-md bg-gray-100 py-2 px-5 dark:bg-gray-800/80 shadow-lg rounded-full border border-gray-200 dark:border-gray-700",initial:{scale:.8,opacity:0,y:10},animate:{scale:1,opacity:1,y:0,transition:{type:"spring",stiffness:300,damping:20}},exit:{scale:.8,opacity:0,y:10,transition:{duration:.15}},children:(0,s.jsx)("div",{id:"emoji-container",className:"flex justify-between",children:(0,s.jsx)(Y.N,{children:G.map(e=>(0,s.jsxs)(_.P.div,{className:"relative z-10 cursor-pointer rounded-full p-2 ".concat((null==n?void 0:n.emoji)===e?"bg-gray-200/80 dark:bg-gray-700/80":m===e?"bg-gray-100/80 dark:bg-gray-600/80":""),"data-emoji":e,animate:{scale:m===e?1.6:1},transition:{type:"spring",stiffness:300,damping:20},children:[(0,s.jsx)("span",{className:"text-xl",children:e}),(null==n?void 0:n.emoji)===e&&(0,s.jsx)(_.P.div,{className:"absolute -bottom-0.5 left-1/2 w-1 h-1 bg-green-500 rounded-full",initial:{opacity:0},animate:{opacity:1},layoutId:"selectedDot",style:{translateX:"-50%"}})]},e))})})})})},"emoji-menu")}var q=n(4357),J=n(3717),H=n(4126);function Z(e){let{theme:t,anchor:n,onReply:r,onCopy:i,onEdit:l,onClose:o,onDelete:c}=e,d=n.querySelector("#message-bubble"),u=d.classList.contains("items-end"),m=null!==d.querySelector("#image-message-container"),x=[{icon:(0,s.jsx)(z.A,{className:"h-4 w-4"}),text:"Reply",onClick:r},{icon:(0,s.jsx)(q.A,{className:"h-4 w-4"}),text:"Copy",onClick:i},...u&&!m?[{icon:(0,s.jsx)(J.A,{className:"h-4 w-4"}),text:"Edit",onClick:l}]:[],...u?[{icon:(0,s.jsx)(H.A,{className:"h-4 w-4"}),text:"Delete",onClick:c}]:[]],[h,p]=(0,a.useState)({top:0,left:0}),[f,g]=(0,a.useState)(null),b=(0,a.useRef)(null),y=(0,a.createRef)();return(0,a.useEffect)(()=>{b.current=f},[f]),(0,a.useLayoutEffect)(()=>{if(!n||!y.current)return;let e=n.querySelector("#message-bubble"),t=document.querySelector("#chat-container"),s=e.getBoundingClientRect(),r=y.current.getBoundingClientRect(),a=s.bottom+10;if(a+r.height>t.clientHeight/2){a=s.top-r.height-10;let e=document.querySelector("#emoji-abs-container");e&&(e.style.top="".concat(a-r.height,"px"),a-=e.offsetHeight+24)}a+=window.scrollY;let i=s.right-r.width-24;u||(i=s.left),p({top:a,left:i})},[n,u]),(0,a.useEffect)(()=>{let e=e=>{if(!y.current)return;let t=y.current.querySelectorAll("button"),n=null;t.forEach((t,s)=>{let r=t.getBoundingClientRect();e.clientX>=r.left&&e.clientX<=r.right&&e.clientY>=r.top&&e.clientY<=r.bottom&&(n=s)}),g(n)},t=e=>{if(null!==b.current&&y.current){let e=y.current.querySelectorAll("button")[b.current];e&&e.click()}};window.addEventListener("pointermove",e),window.addEventListener("pointerup",t);let n=new PointerEvent("pointerdown",{bubbles:!0});return window.dispatchEvent(n),()=>{window.removeEventListener("pointermove",e),window.removeEventListener("pointerup",t)}},[]),(0,s.jsx)(_.P.div,{ref:y,id:"context-menu",className:"absolute flex flex-col rounded-3xl w-[200px] overflow-clip",style:{background:(null==t?void 0:t.chatBackground)||"linear-gradient(180deg, #ffffff, #ffffff)",top:h.top,left:h.left},initial:{opacity:0,scale:.9,transition:{type:"spring",stiffness:300,damping:20}},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9,transition:{duration:.15}},children:x.map((e,t)=>(0,s.jsx)(V,{icon:e.icon,text:e.text,onClick:()=>{e.onClick(),o()},active:f===t},t))})}function V(e){let{icon:t,text:n,onClick:r,active:a}=e;return(0,s.jsx)("div",{children:(0,s.jsxs)("button",{onClick:r,className:"flex items-center justify-start w-full px-6 py-4 text-sm text-black hover:bg-gray-200 ".concat(a?"bg-gray-200":""),children:[(0,s.jsx)("p",{className:"mr-auto",children:n}),t]})})}let Q=e=>{var t,n,r,a;let{open:i,message:l,messageDiv:o,user:c,onReact:d,onClose:u,onCopy:m,onEdit:x,onReply:h,onDelete:p}=e;return(0,s.jsx)(Y.N,{children:i&&(0,s.jsxs)("div",{id:"emoji-overlay-main",className:"overflow-visible absolute left-0 top-0 select-none",children:[(0,s.jsx)(_.P.div,{layout:!0,initial:{opacity:0},animate:{opacity:.5},exit:{opacity:0},className:"fixed inset-0 bg-black z-30",onClick:u},"emoji-overlay"),(0,s.jsxs)("div",{className:"relative z-40 w-full",children:[(0,s.jsx)(X,{isUserMessage:l.sender===c.id,preselectedEmoji:(null==(n=l.reactions)||null==(t=n.find(e=>e.user_id===c.id))?void 0:t.emoji)!=null?{emoji:null==(a=l.reactions)||null==(r=a.find(e=>e.user_id===c.id))?void 0:r.emoji}:void 0,messageDiv:o,message:l,onReact:d,onClose:u},"emoji-menu"),(0,s.jsx)(Z,{onCopy:()=>m(l.id),onEdit:()=>x(l.id),onReply:()=>h(l.id),onDelete:()=>p(l.id),onClose:u,theme:N,anchor:o},"context-menu")]},"context-container")]},"emoji-overlay-main")})},K=()=>(0,s.jsx)(_.P.div,{className:"flex justify-start",children:(0,s.jsxs)("div",{className:"flex mb-2 mx-4 max-w-[100%] rounded-3xl px-4 py-4 bg-gray-100 text-gray-800 relative",children:[(0,s.jsx)("div",{className:"h-2 w-2 bg-gray-800 rounded-full animate-bounce [animation-delay:-0.3s]"}),(0,s.jsx)("div",{className:"h-2 w-2 mx-1 bg-gray-800 rounded-full animate-bounce [animation-delay:-0.15s]"}),(0,s.jsx)("div",{className:"h-2 w-2 bg-gray-800 rounded-full animate-bounce"})]})},"typing-motiondiv"),$=(e,t)=>Math.random()*(t-e)+e,ee=e=>{let{a:t,d:n}=e,r=Math.cos(t)*n,a=Math.sin(t)*n,i=$(2,4),l=$(0,2),o=$(.8,1.2);return(0,s.jsx)(_.P.div,{className:"absolute bg-white rounded-full",style:{width:10,height:10,left:"50%",top:"50%",translateX:"-50%",translateY:"-50%"},initial:{x:0,y:0,scale:0},animate:{x:r,y:a,scale:o},transition:{duration:i,delay:l,repeat:1/0,repeatType:"reverse",ease:"easeInOut"}})},et=()=>{let e=Array.from({length:5}).map((e,t)=>({id:t,angle:t/5*2*Math.PI,distance:$(80,120)})),t={initial:{scale:0,opacity:1},animate:e=>({scale:1,opacity:0,transition:{delay:.7*e,duration:2.1,repeat:1/0,ease:"circOut"}})};return(0,s.jsxs)(_.P.div,{className:"absolute inset-0 flex flex-col items-center justify-center w-full h-full bg-green-500 overflow-hidden z-10",variants:{hidden:{opacity:0,scale:.95},visible:{opacity:1,scale:1,transition:{duration:.4,ease:"easeOut"}},exit:{opacity:0,scale:.95,transition:{duration:.3,ease:"easeIn"}}},initial:"hidden",animate:"visible",exit:"exit",children:[(0,s.jsxs)("div",{className:"relative w-64 h-64 flex items-center justify-center",children:[(0,s.jsx)(Y.N,{children:[0,1,2].map(e=>(0,s.jsx)(_.P.div,{className:"absolute w-full h-full rounded-full border-2 border-white/50",variants:t,initial:"initial",animate:"animate",custom:e},e))}),(0,s.jsx)(_.P.div,{className:"relative w-24 h-24 bg-white rounded-full flex items-center justify-center shadow-lg",animate:{scale:[1,1.1,1]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:(0,s.jsx)("svg",{className:"w-12 h-12 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8s-9-3.582-9-8 4.03-8 9-8 9 3.582 9 8z"})})}),(0,s.jsx)("div",{className:"absolute w-full h-full",children:e.map(e=>(0,s.jsx)(ee,{a:e.angle,d:e.distance},e.id))})]}),(0,s.jsx)(_.P.p,{className:"mt-8 text-2xl font-semibold text-white tracking-wider",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.5,ease:"easeOut"},children:"Finding a match..."})]})};function en(e){let{messages:t,goBack:n,sendMessage:r,onStartTyping:i,onEditMessage:l,isStrangerTyping:o,endChat:d,newChat:u,onReact:x,peerId:h,status:p}=e,[f,g]=(0,a.useState)(""),[b,y]=(0,a.useState)(!1),v=(0,a.useRef)(null),j=(0,a.useRef)(!1),[w,k]=(0,a.useState)({open:!1}),C=(0,a.useRef)(!1),S=function(e){let[t,n]=(0,a.useState)([]);return(0,a.useEffect)(()=>{if(!e||0===e.length)return void n([]);let t=null,s=[];for(let n=0;n<e.length;n++){let r=e[n],a=new Date(r.created_at).getTime(),i=!1;isNaN(a)?console.warn("Invalid date encountered for message:",r.id):"system"!==r.sender&&"typing"!==r.id&&"filler"!==r.id&&(null===t||a-t>3e5)&&(i=!0,t=a),s.push({...r,showTime:i,hasPrevious:!1,hasNext:!1})}s=s.map(e=>{let t=e.replyingTo;if(t&&"string"==typeof t){let n=s.find(e=>e.id===t);if(n)return{...e,replyingTo:n}}return e});for(let e=0;e<s.length;e++){let t=s[e],n=s[e-1],r=s[e+1];if(!t)continue;t.hasPrevious=!!n&&n.sender===t.sender,t.hasNext=!!r&&r.sender===t.sender,t.showTime&&n&&(t.hasPrevious=!1,n.hasNext=!1),t.reactions&&t.reactions.length>0&&r&&(t.hasNext=!1,r.sender===t.sender&&(r.hasPrevious=!1)),t.replyingTo&&n&&(t.hasPrevious=!1,n.sender===t.sender&&(n.hasNext=!1)),t.replyingTo&&r&&(t.hasNext=!1,r.sender===t.sender&&(r.hasPrevious=!1)),n&&n.replyingTo&&(t.hasPrevious=!1,n.hasNext=!1);let a=s[e+1];a&&("system"===a.sender||"typing"===a.id||"filler"===a.id)&&(t.hasNext=!1)}let r=null,a=s.findIndex(e=>"typing"===e.id);-1!==a&&(r=s.splice(a,1)[0]);let i=new Set,l=s.filter(e=>!i.has(e.id)&&(i.add(e.id),!0));r&&l.push(r),n(l)},[e]),t}(t),[E,I]=(0,a.useState)(null),_=e=>{if(!e){k({open:!1}),C.current=!1;return}let t=document.querySelector('[data-message-id="'.concat(null==e?void 0:e.id,'"]'));t&&(C.current=!0,k({open:!0,message:e,messageDiv:t}))};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Q,{open:w.open,message:w.message,messageDiv:w.messageDiv,user:{id:h},onReact:x,onReply:e=>{let n=t.find(t=>t.id===e);n&&I({message:n,type:"replying",title:"Replying",description:n.content})},onEdit:e=>{let n=t.find(t=>t.id===e);n&&(g(n.content),I({message:n,type:"editing",title:"Editing",description:n.content}))},onCopy:e=>{let n=t.find(t=>t.id===e);n&&(navigator.clipboard.writeText(n.content).then(()=>{console.log("Message copied to clipboard")}).catch(e=>{console.error("Failed to copy message: ",e)}),_(null))},onDelete:e=>{t.find(t=>t.id===e)&&(console.log("Delete message with ID: ".concat(e)),_(null))},onClose:()=>_(null)}),(0,s.jsxs)("div",{id:"chat-container",className:"w-full max-w-md mx-auto h-[100dvh] flex flex-col bg-white/70 backdrop-blur-xl sm:rounded-[2rem] shadow-2xl overflow-hidden",children:[(0,s.jsxs)("div",{className:"p-4 bg-white/60 border-b border-gray-200/80 flex items-center shrink-0",children:["connected"!==p&&(0,s.jsx)(m,{variant:"outline",size:"sm",onClick:n,className:"rounded-full mr-2",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,s.jsx)("polyline",{points:"15 18 9 12 15 6"})})}),(0,s.jsxs)("div",{className:"text-left mr-auto ml-2",children:[(0,s.jsx)("p",{className:"text-xs font-medium text-gray-500",children:"Status"}),(0,s.jsx)("p",{className:"text-sm font-semibold text-green-600",children:p.charAt(0).toUpperCase()+p.slice(1)})]}),"connected"===p&&(0,s.jsx)(m,{variant:b?"destructive":"outline",size:"sm",onClick:()=>{b?(d(),y(!1)):y(!0)},className:"rounded-full",children:b?"Confirm?":"End Chat"}),"connected"!==p&&(0,s.jsx)(m,{variant:"default",size:"sm",onClick:u,className:"bg-green-600 rounded-full hover:bg-green-700",children:"New Chat"})]}),(0,s.jsxs)("div",{className:"p-2 text-center text-xs text-gray-500 bg-white/60 border-b border-gray-200/80 shrink-0",children:["not all features are implemented, still in early stages ",(0,s.jsx)("br",{})," ","-@tyronscott_"]}),(0,s.jsxs)("div",{ref:v,className:"flex-grow overflow-y-auto overflow-x-hidden py-4 flex flex-col-reverse",children:[o&&(0,s.jsx)(K,{}),"finding_match"!==p&&"connecting"!==p&&[...S].reverse().map((e,n)=>"system"===e.sender||"system"===e.type?(0,s.jsx)("div",{className:"text-center my-2",children:(0,s.jsx)("span",{className:"text-xs text-gray-500 bg-gray-100 rounded-full px-3 py-1",children:e.content})},n):(0,s.jsx)(U,{index:n,message:e,user:{id:h},isLast:0===n,onSwipe:e=>{let n=t.find(t=>t.id===e);n&&I({message:n,type:"replying",title:"Replying",description:n.content})},onStartedSwipe:()=>{},onEndedSwipe:()=>{},onReact:x,onOpenEmojiMenu:()=>_(e),onResendMessage:()=>{},isEmojiMenuOpen:j,theme:N,animate:!1,secondVisibleElement:null},n)),(0,s.jsx)(Y.N,{children:("waiting_for_match"===p||"finding_match"===p||"connecting"===p)&&(0,s.jsx)(et,{})})]}),E&&(0,s.jsx)("div",{className:"flex items-start gap-2 px-3 py-2 bg-gray-100 border-l-4 mb-2 relative",children:(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-xs font-semibold text-green-700",children:"replying"===E.type?"Replying to":"Editing"}),(0,s.jsx)("button",{type:"button",className:"ml-auto text-gray-400 hover:text-gray-600","aria-label":"Cancel",onClick:()=>I(null),children:(0,s.jsxs)("svg",{width:"18",height:"18",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:[(0,s.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,s.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,s.jsx)("div",{className:"text-xs text-gray-700 truncate max-w-xs",children:E.description})]})}),(0,s.jsx)("div",{className:"p-4 bg-white/60 border-t border-gray-200/80 shrink-0",children:(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault();let t=f.trim();if(t){var n;let e=null==E||null==(n=E.message)?void 0:n.id;if(e&&(null==E?void 0:E.type)==="editing"){null==l||l(e,t),I(null),g("");return}r(t,e),g(""),e&&I(null)}},className:"flex space-x-3",children:[(0,s.jsx)(c,{disabled:"connected"!==p,type:"text",value:f,onChange:e=>{g(e.target.value),i()},placeholder:"Type a message...",className:"text-[16px] flex-grow p-3 border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500 bg-white/80",autoComplete:"off",required:!0}),(0,s.jsx)(m,{type:"submit",disabled:!f.trim()||"connected"!==p,className:"bg-green-500 text-white font-bold w-12 h-12 rounded-full hover:bg-green-600 flex items-center justify-center shadow-lg",children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("line",{x1:"12",y1:"19",x2:"12",y2:"5"}),(0,s.jsx)("polyline",{points:"5 12 12 5 19 12"})]})})]})})]})]})}var es=n(1368);let er=()=>{let[e,t]=(0,a.useState)("intro"),[n,s]=(0,a.useState)("initializing"),[r,i]=(0,a.useState)([]),[l,o]=(0,a.useState)(""),[c,d]=(0,a.useState)(""),[u,m]=(0,a.useState)(!1),x=(0,a.useRef)(null),h=(0,a.useRef)(null),p=(0,a.useRef)(!1);(0,a.useEffect)(()=>(o((0,es.A)()),s("ready"),()=>{var e,t;console.log("Cleaning up useAnimochat hook."),null==(e=h.current)||e.close(),null==(t=x.current)||t.close()}),[]);let f=(e,t,n)=>{console.log("Handling reaction:",{messageId:e,emoji:t,userId:n}),i(s=>s.map(s=>{let r;if(s.id!==e||"system"===s.type)return s;let a=s.reactions||[],i=a.findIndex(e=>e.user_id===n);return i>-1?t?(r=[...a])[i]={user_id:n,emoji:t,message_id:e}:r=a.filter((e,t)=>t!==i):r=t?[...a,{user_id:n,emoji:t,message_id:e}]:a,{...s,reactions:r}}))},g=(0,a.useCallback)(e=>{x.current&&x.current.readyState===WebSocket.OPEN?x.current.send(JSON.stringify(e)):console.error("Cannot send packet, WebSocket connection is not open.")},[]),b=(0,a.useCallback)(()=>{p.current||(p.current=!0,g({type:"typing",content:!0,sender:l}),setTimeout(()=>{p.current=!1,g({type:"typing",content:!1,sender:l})},3e3))},[l,g]),y=(0,a.useCallback)(async(e,t)=>{l&&(f(e,t||null,l),g({type:"reaction",sender:l,content:{message_id:e,emoji:t||null,user_id:l}}))},[l,g]),v=(0,a.useCallback)((e,t)=>{t&&e&&l&&(i(n=>n.map(n=>n.id===e?{...n,content:t,edited:!0}:n)),g({type:"edit_message",content:{message_id:e,new_content:t,user_id:l},sender:l}))},[l,g]),j=(0,a.useCallback)((e,t)=>{if(!l||!c)return;let n={id:"msg_".concat(Date.now()),session_id:c,created_at:new Date().toISOString(),content:e,replyingTo:t,sender:l};g({type:"message",content:n,sender:l}),i(e=>[...e,n])},[l,c,g]),w=(0,a.useCallback)(()=>{var e,t;null==(e=x.current)||e.close(),x.current=null,null==(t=h.current)||t.close(),h.current=null,s("disconnected"),d("")},[]),N=(0,a.useCallback)(e=>{if(!l){console.error("User ID not set yet. Cannot start matchmaking."),s("error");return}t("chat"),s("finding_match");let n=e.join(","),r="".concat("http://localhost:3005","/matchmaking?userId=").concat(l,"&interest=").concat(n);console.log("Connecting to matchmaking server: ".concat(r));let a=new EventSource(r);h.current=a,a.onmessage=e=>{let t=JSON.parse(e.data);if(console.log("Matchmaking update:",t),"MATCHED"===t.state&&t.chatId){console.log("Match found with user ".concat(t.matchedUserId,"! ChatID: ").concat(t.chatId)),s("connecting"),a.close(),d(t.chatId);let e=t.chatServerUrl,n="".concat(e,"?userId=").concat(l,"&chatId=").concat(t.chatId);console.log("Connecting to WebSocket server: ".concat(n));let r=new WebSocket(n);x.current=r,r.onopen=()=>{console.log("WebSocket connection established."),s("connected"),i([{id:"system_".concat(Date.now()),session_id:t.chatId,created_at:new Date().toISOString(),type:"system",content:"You matched on ".concat(t.interest||"a common interest","."),sender:"system"}])},r.onmessage=async e=>{let n,s=e.data,r=n=s instanceof Blob?JSON.parse(await s.text()):"string"==typeof s?JSON.parse(s):s;if(console.log("Received packet:",n),r.sender!==l)switch(r.type){case"STATUS":let a={id:"system_".concat(Date.now()),session_id:t.chatId,created_at:new Date().toISOString(),type:"system",content:r.message,sender:"system"};i(e=>[...e,a]);break;case"message":i(e=>[...e,r.content]);break;case"reaction":let{message_id:o,emoji:c,user_id:d}=r.content;f(o,c,d);break;case"typing":m(r.content);break;case"edit_message":let{message_id:u,new_content:x,user_id:h}=r.content;i(e=>e.map(e=>e.id===u&&e.sender===h?{...e,content:x,edited:!0}:e))}},r.onclose=()=>{console.log("WebSocket connection closed."),s("disconnected");let e={id:"system_".concat(Date.now()),session_id:t.chatId,created_at:new Date().toISOString(),type:"system",content:"The connection has been closed.",sender:"system"};i(t=>[...t,e])},r.onerror=e=>{console.error("WebSocket error:",e),s("error")}}else"WAITING"===t.state&&(console.log("Waiting for a match..."),s("waiting_for_match"))},a.onerror=e=>{console.error("EventSource failed:",e),s("error"),a.close()}},[l]);return{screen:e,status:n,messages:r,userId:l,isStrangerTyping:u,handleGetStarted:()=>t("matchmaking"),startMatchmaking:N,sendMessage:j,disconnect:w,onReact:y,editMessage:v,onStartTyping:b}};function ea(){let{screen:e,userId:t,status:n,messages:i,startMatchmaking:l,disconnect:o,editMessage:c,sendMessage:d,onReact:u,onStartTyping:m,handleGetStarted:x,isStrangerTyping:h}=er(),[p,f]=(0,a.useState)(new Set),g=e=>{0!==e.size&&l(Array.from(e))};return(0,s.jsx)("div",{className:"h-full overflow-y-auto overflow-x-hidden",children:(0,s.jsxs)("main",{className:"container h-full mx-auto flex flex-col ".concat("chat"===e?"p-0":"px-4 py-8 md:py-16"),children:["chat"!==e&&(0,s.jsx)(r,{}),(0,s.jsx)("div",{className:"flex-grow flex flex-col justify-center items-center",children:(0,s.jsx)(Y.N,{mode:"sync",children:(()=>{switch(e){case"chat":return(0,s.jsx)("div",{className:"h-full w-full flex items-center justify-center sm:p-4",children:(0,s.jsx)(en,{goBack:()=>{x()},onEditMessage:c,onStartTyping:m,isStrangerTyping:h,onReact:u,messages:i,sendMessage:d,newChat:()=>{g(p)},endChat:o,peerId:t,status:n})});case"matchmaking":return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"max-w-3xl mx-auto relative w-full",children:(0,s.jsxs)("div",{className:"text-center mb-12",children:[(0,s.jsx)("h2",{className:"text-4xl md:text-6xl font-bold bg-gradient-to-r from-green-600 to-green-400 bg-clip-text text-transparent",children:"Choose Your Interests"}),(0,s.jsx)("p",{className:"text-gray-600 text-lg my-8",children:"Find someone to chat with based on what you like."})]})}),(0,s.jsx)(w,{interests:p,onInterestsChange:f,onFindMatch:g,isConnecting:!1,status:n})]});default:return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"max-w-3xl mx-auto relative w-full",children:(0,s.jsxs)("div",{className:"text-center mb-12",children:[(0,s.jsxs)("h2",{className:"text-4xl md:text-6xl font-bold bg-gradient-to-r from-green-600 to-green-400 bg-clip-text text-transparent",children:["Real-time",(0,s.jsx)("br",{}),"Anonymous Chat"]}),(0,s.jsx)("p",{className:"text-gray-600 text-lg my-8",children:"Connect with students anonymously and securely."})]})}),(0,s.jsxs)("div",{className:"max-w-md mx-auto text-sm space-y-6 text-center",children:[(0,s.jsx)("div",{className:"text-yellow-700 bg-yellow-50 p-4 rounded-2xl border border-yellow-200 font-medium",children:"Maintenance !"}),(0,s.jsxs)("div",{className:"text-yellow-700 bg-yellow-50 p-4 rounded-2xl border border-yellow-200 font-medium text-left",children:[(0,s.jsx)("p",{children:"we're migrating into a new server architecture. please wait while we polish things up. the site should be back up in under an hour."}),(0,s.jsx)("br",{}),(0,s.jsx)("p",{children:"the peer to peer chat we're not reliable as we expected and there's too many edge cases."}),(0,s.jsx)("br",{}),(0,s.jsx)("p",{children:"-ts"})]})]})]})}})()})}),"chat"!==e&&(0,s.jsxs)("footer",{className:"text-xs text-gray-500 text-center py-4 shrink-0",children:[(0,s.jsxs)("h3",{className:"py-4",children:["Created by developers from"," ",(0,s.jsx)("span",{className:"text-green-700 font-semibold",children:"De La Salle Lipa"})]}),t&&(0,s.jsxs)("p",{className:"font-mono text-gray-400 text-[10px] mt-2",children:["Your User ID: ",t]})]})]})})}},6379:(e,t,n)=>{Promise.resolve().then(n.bind(n,5001))},7351:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[817,135,441,684,358],()=>t(6379)),_N_E=e.O()}]);