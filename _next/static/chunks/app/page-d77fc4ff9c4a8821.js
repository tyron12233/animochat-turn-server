(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3287:()=>{},5181:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>ee});var r=n(5155);function s(){return(0,r.jsxs)("div",{className:"fixed inset-0 overflow-hidden pointer-events-none z-5",children:[(0,r.jsx)("div",{className:"absolute top-1/4 left-1/4 w-24 h-24 bg-gradient-to-r from-green-100 to-green-50 rounded-full opacity-50 animate-float mix-blend-multiply"}),(0,r.jsx)("div",{className:"absolute top-1/3 right-32 w-48 h-48 bg-green-100 rounded-full opacity-20 animate-blob animation-delay-2000"}),(0,r.jsx)("div",{className:"absolute top-2/3 left-16 w-16 h-16 bg-green-50 rotate-45 opacity-30 animate-float animation-delay-3000"}),(0,r.jsx)("div",{className:"absolute bottom-32 right-1/4",children:(0,r.jsx)("div",{className:"w-32 h-32 border-4 border-green-100 rounded-full animate-pulse opacity-30"})}),(0,r.jsx)("div",{className:"absolute inset-0 opacity-10",children:(0,r.jsx)("div",{className:"h-full w-full bg-[linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] bg-[size:24px_24px]"})}),(0,r.jsx)("div",{className:"absolute top-0 left-0 w-1/3 h-full animate-line",children:(0,r.jsx)("div",{className:"w-px h-full bg-gradient-to-b from-transparent via-green-100 to-transparent"})})]})}var a=n(2115),i=n(2596),l=n(9688);function o(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,l.QP)((0,i.$)(t))}let c=a.forwardRef((e,t)=>{let{className:n,type:s,...a}=e;return(0,r.jsx)("input",{type:s,className:o("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),ref:t,...a})});c.displayName="Input";var d=n(4624);let u=(0,n(2085).F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function m(e){let{className:t,variant:n,size:s,asChild:a=!1,...i}=e,l=a?d.DX:"button";return(0,r.jsx)(l,{"data-slot":"button",className:o(u({variant:n,size:s,className:t})),...i})}var x=n(4416),h=n(5736);let p=(0,n(4982).UU)("https://wkafplnaexyyuobfufxa.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndrYWZwbG5hZXh5eXVvYmZ1ZnhhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0NjYwODEsImV4cCI6MjA2MTA0MjA4MX0.Sp9g2aWN24QoymYPoYJbxInnFNMautc26uJ1ba6Dvdc"),f=e=>{let{text:t,onRemove:n}=e;return(0,r.jsxs)("div",{className:"tag inline-flex items-center bg-green-600 text-white py-1 px-3 rounded-full m-1 font-medium text-sm transition-all duration-200 animate-in fade-in-50",children:[(0,r.jsx)("span",{children:t}),(0,r.jsx)("button",{onClick:()=>n(t),className:"ml-2 bg-black/10 hover:bg-black/30 rounded-full w-5 h-5 flex items-center justify-center transition-colors","aria-label":"Remove ".concat(t),children:(0,r.jsx)(x.A,{size:14})})]})},g=()=>(0,r.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),b=e=>{let{isOpen:t,onClose:n,onSubmit:s}=e,[i,l]=(0,a.useState)(""),[o,c]=(0,a.useState)(!1),[d,u]=(0,a.useState)(null),[p,f]=(0,a.useState)(!1),b=(0,a.useRef)(null);if((0,a.useEffect)(()=>{let e=e=>{"Escape"===e.key&&n()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[n]),(0,a.useEffect)(()=>{if(t){var e;null==(e=b.current)||e.focus(),l(""),c(!1),u(null),f(!1)}},[t]),!t)return null;let y=async e=>{if(e.preventDefault(),!i.trim())return void u("Feedback cannot be empty.");c(!0),u(null);try{await s(i),f(!0),setTimeout(()=>{n()},2e3)}catch(e){u("Failed to submit feedback. Please try again."),console.error(e)}finally{c(!1)}};return(0,r.jsx)("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center animate-in fade-in-50","aria-modal":"true",role:"dialog",children:(0,r.jsxs)("div",{ref:b,tabIndex:-1,className:"bg-white rounded-2xl shadow-2xl w-full max-w-md m-4 p-8 relative transform transition-all duration-300 scale-95 animate-in slide-in-from-bottom-10",children:[(0,r.jsx)("button",{onClick:n,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Close dialog",children:(0,r.jsx)(x.A,{size:24})}),(0,r.jsxs)("div",{className:"flex flex-col items-center text-center",children:[(0,r.jsx)("div",{className:"bg-green-100 p-3 rounded-full mb-4",children:(0,r.jsx)(h.A,{className:"text-green-600",size:32})}),(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Got a suggestion?"}),(0,r.jsx)("p",{className:"text-gray-500 mb-6",children:"We'd love to hear your ideas for new features or improvements."})]}),p?(0,r.jsx)("div",{className:"text-center p-4 bg-green-50 border border-green-200 rounded-lg",children:(0,r.jsx)("p",{className:"font-semibold text-green-700",children:"Thank you! Your feedback has been submitted."})}):(0,r.jsxs)("form",{onSubmit:y,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"feedback-content",className:"sr-only",children:"Your suggestion"}),(0,r.jsx)("textarea",{id:"feedback-content",value:i,onChange:e=>l(e.target.value),placeholder:"Type your suggestion here...",className:"w-full h-32 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors",required:!0})]}),d&&(0,r.jsx)("p",{className:"text-red-600 text-sm text-center",children:d}),(0,r.jsxs)(m,{type:"submit",disabled:o,className:"w-full rounded-full py-3 bg-green-600 hover:bg-green-700 text-white font-bold text-base disabled:bg-gray-400 disabled:cursor-wait flex items-center justify-center",children:[o&&(0,r.jsx)(g,{}),o?"Submitting...":"Submit Feedback"]})]})]})})};function y(e){let{interests:t,onInterestsChange:n,onFindMatch:s,isConnecting:i,status:l}=e,[o,d]=(0,a.useState)(""),[u,x]=(0,a.useState)([]),[y,v]=(0,a.useState)(!0),[j,w]=(0,a.useState)(null),[N,k]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{v(!0);try{let e=await fetch("".concat("https://animochat-turn-server.onrender.com","/interests/popular"));if(!e.ok)throw Error("HTTP error! Status: ".concat(e.status));let t=await e.json();x(t)}catch(e){console.error("Failed to fetch popular interests:",e),w("Could not load topics.")}finally{v(!1)}})()},[]);let C=e=>{let r=e.trim().toUpperCase();r&&!t.has(r)&&n(new Set(t).add(r)),d("")},S=e=>{let r=new Set(t);r.delete(e),n(r)},E=async e=>{let{error:t}=await p.from("suggestions").insert([{content:e}]);if(t)throw console.error("Error submitting feedback to Supabase:",t),t};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"w-[350px] max-w-full mx-auto",children:[(0,r.jsx)("div",{className:"flex flex-wrap justify-center gap-2 min-h-[36px] mb-4",children:Array.from(t).map(e=>(0,r.jsx)(f,{text:e,onRemove:S},e))}),(0,r.jsx)(c,{id:"interest-input",type:"text",value:o,onChange:e=>d(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),C(o))},className:"rounded-full py-6 px-6 focus-visible:border-green-500 focus-visible:ring-green-500 ring-offset-1 text-center",placeholder:"Type an interest & press Enter",maxLength:26})]}),(0,r.jsxs)("div",{className:"mt-8 text-center",children:[(0,r.jsx)("h3",{className:"text-sm font-bold text-gray-500 uppercase tracking-wider mb-4",children:"Popular Topics"}),(0,r.jsx)("div",{className:"flex flex-wrap justify-center gap-2 max-w-md mx-auto",children:y?(0,r.jsx)("p",{className:"text-sm text-gray-400",children:"Loading topics..."}):j?(0,r.jsx)("p",{className:"text-sm text-red-500",children:j}):0===u.length?(0,r.jsx)("p",{className:"text-sm text-gray-400",children:"No active topics."}):u.map(e=>{let{interest:t,count:n}=e;return(0,r.jsxs)("button",{onClick:()=>C(t),className:"bg-green-100 text-green-800 text-xs font-semibold px-3 py-1.5 rounded-full hover:bg-green-200 hover:scale-105 transition-all duration-200",children:[(0,r.jsx)("span",{children:t}),(0,r.jsx)("span",{className:"bg-green-200 text-green-900 text-[10px] font-bold px-1.5 py-0.5 rounded-full ml-2",children:n})]},t)})})]}),(0,r.jsx)("div",{className:"mt-12 w-[350px] max-w-full mx-auto",children:(0,r.jsx)(m,{onClick:()=>{let e=new Set(t);o.trim()&&!e.has(o.trim().toUpperCase())&&n(e=new Set(e).add(o.trim().toUpperCase())),s(e)},disabled:i||0===t.size&&!o.trim(),className:"w-full rounded-full py-6 bg-green-600 hover:bg-green-700 text-white font-bold text-base disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center",children:i?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g,{}),l]}):"Find Match"})}),(0,r.jsx)("div",{className:"text-center mt-6",children:(0,r.jsxs)(m,{variant:"secondary",className:"text-gray-500 hover:text-green-600 transition-colors",onClick:()=>k(!0),children:[(0,r.jsx)(h.A,{size:16,className:"mr-2"}),"We'd love to hear your feedback"]})}),(0,r.jsx)(b,{isOpen:N,onClose:()=>k(!1),onSubmit:E})]})}let v={id:"default",name:"Default Chat Theme",accentColor:"#16a34a",userBubbleGradient:"linear-gradient(90deg, #16a34a, #16a34a)",userTextColor:"#ffffff",otherBubbleGradient:"linear-gradient(90deg, #f3f4f6, #f3f4f6)",otherTextColor:"#1F2937",otherAnimated:!1,userAnimated:!1,chatBackground:"linear-gradient(180deg, #ffffff, #ffffff)"};var j=n(3319);function w(e){if(e.includes("linear-gradient")){let t=e.match(/#([0-9A-F]{6}|[0-9A-F]{3})/gi);if(t)return t.reduce((e,t)=>{let n="#"===t.charAt(0)?t.substring(1,7):t,r=parseInt(n.substring(0,2),16);return e+.299*r+.587*parseInt(n.substring(2,4),16)+.114*parseInt(n.substring(4,6),16)},0)/t.length>186?"#000000":"#ffffff"}let t="#"===e.charAt(0)?e.substring(1,7):e,n=parseInt(t.substring(0,2),16);return .299*n+.587*parseInt(t.substring(2,4),16)+.114*parseInt(t.substring(4,6),16)>186?"#000000":"#ffffff"}n(7351),n(3287);var N=n(892),k=n(8619),C=n(8829),S=n(7859),E=n(9424);function T(e){let{visible:t,isUserMessage:n,reply:s,onOpenEmojiMenu:a,theme:i,isDeleted:l=!1}=e;return(0,r.jsxs)("div",{className:"flex flex-row h-full min-h-full justify-center space-x-1 ".concat(t?"visible":"invisible"),children:[(0,r.jsx)("div",{className:"".concat(n?"mr-1 mt-1":"ml-2 mt-1"," h-[2rem] rounded-full transition-colors p-2 cursor-pointer hover:opacity-100 opacity-80"),style:{background:n?i.userBubbleGradient:i.otherBubbleGradient,color:n?i.userTextColor:i.otherTextColor},onClick:s,children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",strokeWidth:"2",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})}),!l&&(0,r.jsx)("div",{className:"mt-1 h-[2rem] opacity-80 rounded-full transition-colors p-2 cursor-pointer hover:opacity-100",onClick:a,style:{background:n?i.userBubbleGradient:i.otherBubbleGradient},children:(0,r.jsx)(E.A,{className:"w-4 h-4",style:{color:n?i.userTextColor:i.otherTextColor},fill:"none",strokeWidth:"2",stroke:"currentColor",viewBox:"0 0 24 24"})}),n&&(0,r.jsx)("div",{className:"w-1"})]},"actions")}var _=n(6766);function I(e){let{message:t,isUserMessage:n,theme:s}=e;return t?"image"===t.type?(0,r.jsx)(P,{message:t,isUserMessage:n,theme:s}):(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("div",{className:"rounded-tl-3xl rounded-tr-3xl rounded-b-3xl px-3 pt-2 text-sm opacity-[0.65] pb-[32px] -mb-[32px] -z-20",style:{background:n?s.userBubbleGradient:s.otherBubbleGradient,color:n?s.userTextColor:s.otherTextColor},children:(0,r.jsx)("p",{className:"break-words whitespace-pre-wrap",children:"deleted"===t.type?"Deleted message.":t.content})})}):null}function P(e){let{message:t,isUserMessage:n,theme:s}=e;return(0,r.jsx)("div",{className:"pb-[32px] -mb-[32px] rounded-tl-3xl rounded-tr-3xl rounded-b-3xl",children:(0,r.jsx)(_.default,{src:t.content,alt:"image",className:"rounded-tl-3xl rounded-tr-3xl rounded-b-3xl object-contain mb-1",width:80,height:100})})}function A(e){let{message:t,user:n,theme:s}=e,a=t.reactions;if(!a||0===a.length)return null;let i=a.length,l=Array.from(new Set(a.map(e=>e.emoji))),o=a.find(e=>e.user_id===n.id);return(0,r.jsx)(S.P.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},exit:{opacity:0,scale:0},transition:{duration:.2,ease:"easeOut"},className:"flex justify-end",children:(0,r.jsx)("div",{className:"self-end text-xs text-black relative rounded-full mt-auto bg-gray-200 border-2 border-white p-1.5 -top-2",children:(0,r.jsxs)("div",{className:"flex justify-center",children:[l.map((e,t)=>(0,r.jsx)("div",{className:"text-center",children:e},t)),(0,r.jsx)("p",{className:"pl-1",children:(0,r.jsx)("span",{style:{color:o?s.accentColor:"black"},children:i})})]})})})}var M=n(4032),R=n(9597);function z(e){var t,n,s;let{message:i,user:l,hovered:c,reply:d,animate:u=!1,onOpenEmojiMenu:m,onResendMessage:x,theme:h=v,advertisementMessageId:p,onLinkClick:f,onReact:g}=e,b=i.sender===l.id,y=(n=i.hasPrevious,s=i.hasNext,b?"rounded-tl-3xl rounded-bl-3xl ".concat(n?"rounded-tr-sm":"rounded-tr-3xl"," ").concat(s?"rounded-br-sm":"rounded-br-3xl"):"rounded-tr-3xl rounded-br-3xl ".concat(n?"rounded-tl-sm":"rounded-tl-3xl"," ").concat(s?"rounded-bl-sm":"rounded-bl-3xl")),j="sending"===i.status,N="error"===i.status,E=null!=(t=i.edited)&&t,_=i.content,P=function(e){let t=e.trim();if(!t)return!1;let n=t.replace(/\s+/g,""),r=RegExp("(\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F)","gu"),s=n.match(r);return!!s&&s.join("")===n}(_)&&3>=function(e){let t=e.trim().replace(/\s+/g,""),n=RegExp("(\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F)","gu"),r=t.match(n);return r?r.length:0}(_),A=(0,k.d)(0),R=(0,C.G)(A,b?[0,-30,-40,-50]:[0,30,40,50],[0,.5,.8,1]),z=function(e){let{delay:t=500}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(0,a.useRef)(null),r=(0,a.useRef)(!1),s=(0,a.useCallback)(()=>{null!==n.current&&(clearTimeout(n.current),n.current=null)},[]),i=(0,a.useCallback)(s=>{r.current=!1,n.current=window.setTimeout(()=>{e(s)},t)},[e,t]),l=(0,a.useCallback)(e=>{r.current=!0,s()},[s]);return{onTouchStart:i,onTouchMove:l,onTouchEnd:(0,a.useCallback)(e=>{r.current||e.stopPropagation(),s()},[s]),onTouchCancel:(0,a.useCallback)(e=>{s()},[s])}}(e=>{if("deleted"===i.type)return;m();let t=new TouchEvent("pointerup",{bubbles:!0,cancelable:!0,composed:!0});e.target.dispatchEvent(t)});return(0,r.jsxs)("div",{className:"relative flex w-full items-center ".concat(b?"justify-end":"justify-start"),children:[(0,r.jsx)(S.P.div,{className:o("absolute p-2.5 rounded-full",b?"right-0":"left-0"),style:{background:"".concat(h.accentColor,"15"),scale:R},children:(0,r.jsx)(M.A,{className:o("w-4 h-4"),style:{color:h.accentColor}})}),!N&&b&&(0,r.jsx)("p",{className:"opacity-50 text-[0.70rem] self-end pr-2 pb-2 overflow-clip -mr-[80px] ".concat(p!==i.id||c?"invisible":"visible"),style:{color:w(h.chatBackground)},children:"AnimoChat.com"}),b&&(0,r.jsx)(T,{isUserMessage:i.sender===l.id,visible:c,theme:h,reply:d,onOpenEmojiMenu:m,isDeleted:"deleted"===i.type}),N&&b&&(0,r.jsxs)("p",{className:"opacity-50 text-[0.70rem] self-end pr-2 pb-2 overflow-clip text-red-800",children:["Error sending message."," ",(0,r.jsx)("span",{className:"underline cursor-pointer",onClick:()=>x(i),children:"Retry"})]}),(0,r.jsxs)(S.P.div,{id:"message-bubble",dragSnapToOrigin:!0,dragTransition:{bounceDamping:13},drag:"x",dragConstraints:{left:0,right:0},onDrag:(e,t)=>{if((!b||!(t.offset.x>0))&&(b||!(t.offset.x<0))){if(document.querySelector("#emoji-overlay-main")){if(A.set(0),e instanceof TouchEvent){var n;let t=new TouchEvent("touchstart",{bubbles:!0,cancelable:!0,composed:!0,touches:[e.touches[0]]});null==(n=document)||n.dispatchEvent(t)}return}A.set(t.offset.x)}},onDragEnd:(e,t)=>{(b&&t.offset.x<-50||!b&&t.offset.x>50)&&!document.querySelector("#emoji-overlay-main")&&d(),A.set(0)},whileTap:{scale:.8},style:{x:A,originX:+!!b,WebkitTapHighlightColor:"transparent"},onDoubleClick:()=>{g("❤️")},..."deleted"!==i.type&&{onContextMenu:e=>{e.preventDefault(),e.stopPropagation(),m()}},...z,initial:!!u&&{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",duration:.4},className:"max-w-[75%] mb-0.5 flex flex-col ".concat(b?"items-end":"items-start"," ").concat(j?"opacity-50":""),children:[E&&(0,r.jsx)("p",{className:"text-[0.70rem] px-2 text-gray-500",children:"Edited"}),i.replyingTo&&(0,r.jsx)(I,{message:i.replyingTo,isUserMessage:b,theme:h}),(null===i.type||void 0===i.type||"text"===i.type||"deleted"===i.type)&&(0,r.jsx)(F,{isLargeEmojiMessage:P,message:i,user:l,theme:h,isUserMessage:b,roundedCorners:y,onLinkClick:f}),"image"===i.type&&(0,r.jsx)(D,{user:l,message:i,roundedCorners:y,isUserMessage:b,theme:h})]},i.id+"-bubble"),!b&&(0,r.jsx)(T,{visible:c,theme:h,isUserMessage:!1,reply:d,onOpenEmojiMenu:m}),!b&&(0,r.jsx)("p",{className:"opacity-50 text-[0.70rem] self-end pl-2 pb-2 -ml-[70px] ".concat(p!==i.id||c?"invisible":"visible"),style:{color:w(h.chatBackground)},children:"AnimoChat.com"})]},i.id)}function D(e){let{user:t,message:n,roundedCorners:s,isUserMessage:i,theme:l}=e,[o,c]=(0,a.useState)(!1),d="rounded-3xl ".concat(s," ").concat(i?"rounded-tr-3xl":"rounded-tl-3xl");return(0,r.jsxs)("div",{id:"image-message-container",onClick:()=>c(!0),style:{cursor:"pointer"},children:[(0,r.jsxs)("div",{className:d,style:{overflow:"hidden",position:"relative",border:"2px solid transparent"},children:[(0,r.jsx)(R.A8,{src:n.content,children:(0,r.jsx)(_.default,{width:Math.min(.6*window.innerWidth,300),height:Math.min(.6*window.innerWidth,300),className:d,src:n.content,alt:"Image",style:{filter:o?"none":"blur(8px)",transition:"filter 0.3s ease-in-out",maxWidth:"100%",objectFit:"contain",backgroundColor:l.chatBackground},sizes:"(max-width: 768px) 70vw, 400px"})},n.id),!o&&(0,r.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:l.userTextColor,backgroundColor:"rgba(0, 0, 0, 0.4)",padding:"4px 8px",borderRadius:"0.25rem",pointerEvents:"none",fontSize:"0.85rem"},children:"(tap to reveal)"})]}),(0,r.jsx)(A,{message:n,user:t,theme:l})]})}function F(e){let{message:t,user:n,theme:s,isUserMessage:a,roundedCorners:i,isLargeEmojiMessage:l,onLinkClick:o}=e,c="deleted"===t.type;return(0,r.jsx)(r.Fragment,{children:l?(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"px-2 py-2",children:[(0,r.jsx)("p",{className:"text-5xl",children:t.content}),(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)(A,{message:t,user:n,theme:s})})]})}):(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsxs)("div",{className:"relative group",children:[(0,r.jsx)("div",{className:"".concat(i," animate-gradient-x"),style:{background:a?s.userBubbleGradient:s.otherBubbleGradient,backgroundSize:"200% 100%",color:a?s.userTextColor:s.otherTextColor}}),(0,r.jsx)("div",{className:"".concat(i," relative max-w-full break-words px-3 py-2 ").concat(!a&&s.otherAnimated||a&&s.userAnimated?"bg-white opacity-70":""),style:{wordBreak:"break-word",overflowWrap:"break-word",color:a?s.userTextColor:s.otherTextColor},children:(0,r.jsx)("p",{className:"break-words whitespace-pre-wrap",children:(0,r.jsx)(N.A,{options:{attributes:{target:"_blank",rel:"noopener noreferrer",className:"underline"},render:e=>{let{attributes:t,content:n}=e;return(0,r.jsx)("a",{...t,onClick:e=>{o?o(e):e.stopPropagation()},children:n})}},children:c?(0,r.jsx)("span",{className:"italic",children:"Message has been deleted."}):t.content})})})]}),(0,r.jsx)(A,{message:t,user:n,theme:s})]})})}function L(e){let{message:t,user:n,onSwipe:s,onReact:i,onStartedSwipe:l,onEndedSwipe:o,animate:c=!1,theme:d=v,advertisementMessageId:u,onOpenEmojiMenu:m=()=>{},onResendMessage:x=()=>{},isEmojiMenuOpen:h,onLinkClick:p}=e,[f,g]=(0,a.useState)(!1),[b,y]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{y("ontouchstart"in window||navigator.maxTouchPoints>0)},[]),(0,r.jsx)("div",{"data-message-id":"message-"+t.id,className:"relative px-4 select-none",onMouseEnter:()=>!b&&g(!0),onMouseLeave:()=>!b&&g(!1),children:(0,r.jsx)("div",{children:(0,r.jsx)(z,{onLinkClick:p,animate:c,message:t,user:n,hovered:f,reply:()=>s(t.id),onOpenEmojiMenu:()=>m(t),onReact:e=>i(t.id,e),onResendMessage:x,theme:d,advertisementMessageId:u},t.id+"-bubble")},"parent-message-bubble flex flex-col")})}function B(e){let{index:t,message:n,user:s,animate:a=!1,isLast:i=!1,onSwipe:l,onStartedSwipe:o,onEndedSwipe:c,onReact:d,onOpenEmojiMenu:u,onResendMessage:m,isEmojiMenuOpen:x,theme:h,secondVisibleElement:p,onLinkClick:f}=e;if("system"===n.sender)return(0,r.jsx)("div",{className:"flex justify-center py-4 px-4 text-center",children:(0,r.jsx)("p",{className:"text-xs text-gray-500",children:n.content})},n.id+"_system");let g=t%5==0?n.id:null;return(0,r.jsxs)("div",{"data-is-message":"true","data-message-id":n.id,className:"max-w-full w-full select-none",children:[n.showTime&&(0,r.jsx)("div",{className:"flex justify-center py-4",children:(0,r.jsx)("p",{className:"text-xs text-gray-500 font-normal",children:n.created_at&&(0,j.GP)(new Date(n.created_at),"h:mm a")})},n.id+"_time"),(0,r.jsx)(L,{advertisementMessageId:g,message:n,animate:a,user:s,onSwipe:l,onStartedSwipe:o,onEndedSwipe:c,onReact:d,onOpenEmojiMenu:u,onResendMessage:m,theme:h,isEmojiMenuOpen:x,onLinkClick:f},n.id+"_message"),(i||!n.hasNext)&&(0,r.jsx)("div",{className:"h-1"},n.id+"_bottom")]},"parent_message_"+n.id)}var O=n(760);let G=["❤️","\uD83D\uDE06","\uD83D\uDE2E","\uD83D\uDE22","\uD83D\uDE2D","\uD83D\uDE21","\uD83D\uDC4D"];function Y(e){let{isUserMessage:t,preselectedEmoji:n,message:s,messageDiv:i,onReact:l,onClose:o}=e,c=(0,a.useRef)(null),[d,u]=(0,a.useState)({top:0,left:0}),[m,x]=(0,a.useState)(null),h=(0,a.useRef)(null);return(0,a.useLayoutEffect)(()=>{let e=i.querySelector("#message-bubble");if(e.style.position="relative",e.style.zIndex="30",e&&c.current){let t=e.getBoundingClientRect(),n=c.current,r=n.offsetHeight,s=t.top+window.scrollY-r-10,a=t.right-n.offsetWidth-16;e.classList.contains("items-end")||(a=t.left-16),u({top:s,left:a})}return()=>{e.style.zIndex="0"}},[i]),(0,a.useEffect)(()=>{let e=c.current;if(!e)return;let t=t=>{if(0!==t.button)return;try{e.setPointerCapture(t.pointerId)}catch(e){}h.current=t.pointerId;let n=document.elementFromPoint(t.clientX,t.clientY);if(n){let e=n.closest("[data-emoji]");if(e)return void x(e.getAttribute("data-emoji"))}x(null)},r=t=>{if(h.current!==t.pointerId||!e)return;let n=document.elementFromPoint(t.clientX,t.clientY);if(n){let e=n.closest("[data-emoji]");if(e)return void x(e.getAttribute("data-emoji"))}x(null)},a=t=>{if(h.current===t.pointerId){if(m){let e=(null==n?void 0:n.emoji)===m?null:m;l(s.id,e)}o();try{e.releasePointerCapture(t.pointerId)}catch(e){}h.current=null}};return e.addEventListener("pointerdown",t),window.addEventListener("pointermove",r),window.addEventListener("pointerup",a),()=>{e.removeEventListener("pointerdown",t),window.removeEventListener("pointermove",r),window.removeEventListener("pointerup",a)}},[m,l,o,n,s.id]),(0,r.jsx)(S.P.div,{layout:!0,className:"absolute top-0 left-0 w-screen h-screen",initial:{userSelect:"none",zIndex:100,opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:(0,r.jsx)("div",{id:"emoji-abs-container",className:"absolute border-box flex z-50 w-full md:w-fit px-4",style:{position:"absolute",top:d.top,left:d.left},children:(0,r.jsx)(S.P.div,{ref:c,id:"emoji-container-wrapper",className:"w-full backdrop-blur-md bg-gray-100 py-2 px-5 dark:bg-gray-800/80 shadow-lg rounded-full border border-gray-200 dark:border-gray-700",initial:{scale:.8,opacity:0,y:10},animate:{scale:1,opacity:1,y:0,transition:{type:"spring",stiffness:300,damping:20}},exit:{scale:.8,opacity:0,y:10,transition:{duration:.15}},children:(0,r.jsx)("div",{id:"emoji-container",className:"flex justify-between",children:(0,r.jsx)(O.N,{children:G.map(e=>(0,r.jsxs)(S.P.div,{className:"relative z-10 cursor-pointer rounded-full p-2 ".concat((null==n?void 0:n.emoji)===e?"bg-gray-200/80 dark:bg-gray-700/80":m===e?"bg-gray-100/80 dark:bg-gray-600/80":""),"data-emoji":e,animate:{scale:m===e?1.6:1},transition:{type:"spring",stiffness:300,damping:20},children:[(0,r.jsx)("span",{className:"text-xl",children:e}),(null==n?void 0:n.emoji)===e&&(0,r.jsx)(S.P.div,{className:"absolute -bottom-0.5 left-1/2 w-1 h-1 bg-green-500 rounded-full",initial:{opacity:0},animate:{opacity:1},layoutId:"selectedDot",style:{translateX:"-50%"}})]},e))})})})})},"emoji-menu")}var U=n(4357),W=n(3717),q=n(4126);function X(e){let{theme:t,anchor:n,onReply:s,onCopy:i,onEdit:l,onClose:o,onDelete:c}=e,d=n.querySelector("#message-bubble"),u=d.classList.contains("items-end"),m=null!==d.querySelector("#image-message-container"),x=[{icon:(0,r.jsx)(M.A,{className:"h-4 w-4"}),text:"Reply",onClick:s},{icon:(0,r.jsx)(U.A,{className:"h-4 w-4"}),text:"Copy",onClick:i},...u&&!m?[{icon:(0,r.jsx)(W.A,{className:"h-4 w-4"}),text:"Edit",onClick:l}]:[],...u?[{icon:(0,r.jsx)(q.A,{className:"h-4 w-4"}),text:"Delete",onClick:c}]:[]],[h,p]=(0,a.useState)({top:0,left:0}),[f,g]=(0,a.useState)(null),b=(0,a.useRef)(null),y=(0,a.createRef)();return(0,a.useEffect)(()=>{b.current=f},[f]),(0,a.useLayoutEffect)(()=>{if(!n||!y.current)return;let e=n.querySelector("#message-bubble"),t=document.querySelector("#chat-container"),r=e.getBoundingClientRect(),s=y.current.getBoundingClientRect(),a=r.bottom+10;if(a+s.height>t.clientHeight/2){a=r.top-s.height-10;let e=document.querySelector("#emoji-abs-container");e&&(e.style.top="".concat(a-s.height,"px"),a-=e.offsetHeight+24)}a+=window.scrollY;let i=r.right-s.width-24;u||(i=r.left),p({top:a,left:i})},[n,u]),(0,a.useEffect)(()=>{let e=e=>{if(!y.current)return;let t=y.current.querySelectorAll("button"),n=null;t.forEach((t,r)=>{let s=t.getBoundingClientRect();e.clientX>=s.left&&e.clientX<=s.right&&e.clientY>=s.top&&e.clientY<=s.bottom&&(n=r)}),g(n)},t=e=>{if(null!==b.current&&y.current){let e=y.current.querySelectorAll("button")[b.current];e&&e.click()}};window.addEventListener("pointermove",e),window.addEventListener("pointerup",t);let n=new PointerEvent("pointerdown",{bubbles:!0});return window.dispatchEvent(n),()=>{window.removeEventListener("pointermove",e),window.removeEventListener("pointerup",t)}},[]),(0,r.jsx)(S.P.div,{ref:y,id:"context-menu",className:"absolute flex flex-col rounded-3xl w-[200px] overflow-clip",style:{background:(null==t?void 0:t.chatBackground)||"linear-gradient(180deg, #ffffff, #ffffff)",top:h.top,left:h.left},initial:{opacity:0,scale:.9,transition:{type:"spring",stiffness:300,damping:20}},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9,transition:{duration:.15}},children:x.map((e,t)=>(0,r.jsx)(J,{icon:e.icon,text:e.text,onClick:()=>{e.onClick(),o()},active:f===t},t))})}function J(e){let{icon:t,text:n,onClick:s,active:a}=e;return(0,r.jsx)("div",{children:(0,r.jsxs)("button",{onClick:s,className:"flex items-center justify-start w-full px-6 py-4 text-sm text-black hover:bg-gray-200 ".concat(a?"bg-gray-200":""),children:[(0,r.jsx)("p",{className:"mr-auto",children:n}),t]})})}let H=e=>{var t,n,s,a;let{open:i,message:l,messageDiv:o,user:c,onReact:d,onClose:u,onCopy:m,onEdit:x,onReply:h,onDelete:p}=e;return(0,r.jsx)(O.N,{children:i&&(0,r.jsxs)("div",{id:"emoji-overlay-main",className:"overflow-visible absolute left-0 top-0 select-none",children:[(0,r.jsx)(S.P.div,{layout:!0,initial:{opacity:0},animate:{opacity:.5},exit:{opacity:0},className:"fixed inset-0 bg-black z-30",onClick:u},"emoji-overlay"),(0,r.jsxs)("div",{className:"relative z-40 w-full",children:[(0,r.jsx)(Y,{isUserMessage:l.sender===c.id,preselectedEmoji:(null==(n=l.reactions)||null==(t=n.find(e=>e.user_id===c.id))?void 0:t.emoji)!=null?{emoji:null==(a=l.reactions)||null==(s=a.find(e=>e.user_id===c.id))?void 0:s.emoji}:void 0,messageDiv:o,message:l,onReact:d,onClose:u},"emoji-menu"),(0,r.jsx)(X,{onCopy:()=>m(l.id),onEdit:()=>x(l.id),onReply:()=>h(l.id),onDelete:()=>p(l.id),onClose:u,theme:v,anchor:o},"context-menu")]},"context-container")]},"emoji-overlay-main")})},Z=()=>(0,r.jsx)(S.P.div,{className:"flex justify-start",children:(0,r.jsxs)("div",{className:"flex mb-2 mx-4 max-w-[100%] rounded-3xl px-4 py-4 bg-gray-100 text-gray-800 relative",children:[(0,r.jsx)("div",{className:"h-2 w-2 bg-gray-800 rounded-full animate-bounce [animation-delay:-0.3s]"}),(0,r.jsx)("div",{className:"h-2 w-2 mx-1 bg-gray-800 rounded-full animate-bounce [animation-delay:-0.15s]"}),(0,r.jsx)("div",{className:"h-2 w-2 bg-gray-800 rounded-full animate-bounce"})]})},"typing-motiondiv");function V(e){let{messages:t,goBack:n,sendMessage:s,onStartTyping:i,isStrangerTyping:l,endChat:o,newChat:d,onReact:u,peerId:x,status:h}=e,[p,f]=(0,a.useState)(""),[g,b]=(0,a.useState)(!1),y=(0,a.useRef)(null),j=(0,a.useRef)(!1),[w,N]=(0,a.useState)({open:!1}),k=(0,a.useRef)(!1),C=function(e){let[t,n]=(0,a.useState)([]);return(0,a.useEffect)(()=>{if(!e||0===e.length)return void n([]);let t=null,r=[];for(let n=0;n<e.length;n++){let s=e[n],a=new Date(s.created_at).getTime(),i=!1;isNaN(a)?console.warn("Invalid date encountered for message:",s.id):"system"!==s.sender&&"typing"!==s.id&&"filler"!==s.id&&(null===t||a-t>3e5)&&(i=!0,t=a),r.push({...s,showTime:i,hasPrevious:!1,hasNext:!1})}for(let e=0;e<r.length;e++){let t=r[e],n=r[e-1],s=r[e+1];t.hasPrevious=!!n&&n.sender===t.sender,t.hasNext=!!s&&s.sender===t.sender,t.showTime&&n&&(t.hasPrevious=!1,n.hasNext=!1),t.reactions&&t.reactions.length>0&&s&&(t.hasNext=!1,s.sender===t.sender&&(s.hasPrevious=!1)),t.replyingTo&&n&&(t.hasPrevious=!1,n.sender===t.sender&&(n.hasNext=!1)),t.replyingTo&&s&&(t.hasNext=!1,s.sender===t.sender&&(s.hasPrevious=!1)),n&&n.replyingTo&&(t.hasPrevious=!1,n.hasNext=!1);let a=r[e+1];a&&("system"===a.sender||"typing"===a.id||"filler"===a.id)&&(t.hasNext=!1)}let s=null,a=r.findIndex(e=>"typing"===e.id);-1!==a&&(s=r.splice(a,1)[0]);let i=new Set,l=r.filter(e=>!i.has(e.id)&&(i.add(e.id),!0));s&&l.push(s),n(l)},[e]),t}(t),S=e=>{if(!e){N({open:!1}),k.current=!1;return}let t=document.querySelector('[data-message-id="'.concat(null==e?void 0:e.id,'"]'));t&&(k.current=!0,N({open:!0,message:e,messageDiv:t}))};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(H,{open:w.open,message:w.message,messageDiv:w.messageDiv,user:{id:x},onReact:u,onReply:()=>{},onEdit:()=>{},onCopy:()=>{},onDelete:()=>{},onClose:()=>S(null)}),(0,r.jsxs)("div",{id:"chat-container",className:"w-full max-w-md mx-auto h-[100dvh] flex flex-col bg-white/70 backdrop-blur-xl sm:rounded-[2rem] shadow-2xl overflow-hidden",children:[(0,r.jsxs)("div",{className:"p-4 bg-white/60 border-b border-gray-200/80 flex items-center shrink-0",children:["connected"!==h&&(0,r.jsx)(m,{variant:"outline",size:"sm",onClick:n,className:"rounded-full mr-2",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,r.jsx)("polyline",{points:"15 18 9 12 15 6"})})}),(0,r.jsxs)("div",{className:"text-left mr-auto ml-2",children:[(0,r.jsx)("p",{className:"text-xs font-medium text-gray-500",children:"Status"}),(0,r.jsx)("p",{className:"text-sm font-semibold text-green-600",children:h.charAt(0).toUpperCase()+h.slice(1)})]}),"connected"===h&&(0,r.jsx)(m,{variant:g?"destructive":"outline",size:"sm",onClick:()=>{g?(o(),b(!1)):b(!0)},className:"rounded-full",children:g?"Confirm?":"End Chat"}),"connected"!==h&&(0,r.jsx)(m,{variant:"outline",size:"sm",onClick:d,className:"rounded-full",children:"New Chat"})]}),(0,r.jsxs)("div",{className:"p-2 text-center text-xs text-gray-500 bg-white/60 border-b border-gray-200/80 shrink-0",children:["not all features are implemented, still in early stages ",(0,r.jsx)("br",{})," -@tyronscott_"]}),(0,r.jsxs)("div",{ref:y,className:"flex-grow overflow-y-auto py-4 flex flex-col-reverse",children:[l&&(0,r.jsx)(Z,{}),"finding_match"!==h&&[...C].reverse().map((e,t)=>"system"===e.sender||"system"===e.type?(0,r.jsx)("div",{className:"text-center my-2",children:(0,r.jsx)("span",{className:"text-xs text-gray-500 bg-gray-100 rounded-full px-3 py-1",children:e.content})},t):(0,r.jsx)(B,{index:t,message:e,user:{id:x},isLast:0===t,onSwipe:()=>{},onStartedSwipe:()=>{},onEndedSwipe:()=>{},onReact:u,onOpenEmojiMenu:()=>S(e),onResendMessage:()=>{},isEmojiMenuOpen:j,theme:v,animate:!1,secondVisibleElement:null},t)),"finding_match"===h&&(0,r.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,r.jsx)("p",{className:"text-gray-500",children:"Finding a match..."})})]}),(0,r.jsx)("div",{className:"p-4 bg-white/60 border-t border-gray-200/80 shrink-0",children:(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault();let t=p.trim();t&&(s(t),f(""))},className:"flex space-x-3",children:[(0,r.jsx)(c,{disabled:"connected"!==h,type:"text",value:p,onChange:e=>{f(e.target.value),i()},placeholder:"Type a message...",className:"text-[16px] flex-grow p-3 border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500 bg-white/80",autoComplete:"off",required:!0}),(0,r.jsx)(m,{type:"submit",disabled:!p.trim()||"connected"!==h,className:"bg-green-500 text-white font-bold w-12 h-12 rounded-full hover:bg-green-600 flex items-center justify-center shadow-lg",children:(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("line",{x1:"12",y1:"19",x2:"12",y2:"5"}),(0,r.jsx)("polyline",{points:"5 12 12 5 19 12"})]})})]})})]})]})}var Q=n(5723),K=n(1368);let $=()=>{let[e,t]=(0,a.useState)("intro"),[n,r]=(0,a.useState)(""),[s,i]=(0,a.useState)(null),[l,o]=(0,a.useState)("initializing"),[c,d]=(0,a.useState)(!1),[u,m]=(0,a.useState)([]),x=(0,a.useRef)(null),h=(0,a.useRef)(null),[p,f]=(0,a.useState)(!1),g=(0,a.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ready";s&&s.close(),h.current&&h.current.close(),i(null),m([]),t("matchmaking"),o(e),d(!1)},[s]),b=(0,a.useCallback)(()=>{if(!x.current){let e=new Q.xM({config:{iceTransportPolicy:"relay",iceServers:[{urls:"turn:relay1.expressturn.com:3480",username:"000000002066065602",credential:"AlQhdlmP9HdGw+NC1+Zs9vtvHQU="},{url:"stun:stun.l.google.com:19302"}]}});x.current=e,e.on("open",e=>{r(e),o("ready"),d(!1)}),e.on("connection",e=>{console.log("New connection"),i(e),t("chat"),d(!1),o("connecting")}),e.on("error",e=>{console.error("PeerJS error:",e),g("error")})}},[g]),y=(0,a.useCallback)((e,t,n)=>{m(r=>r.map(r=>{let s;if(r.id!==e||"system"===r.type)return r;let a=r.reactions||[],i=a.findIndex(e=>e.user_id===n);return i>-1?t?(s=[...a])[i]={user_id:n,emoji:t,message_id:e}:s=a.filter((e,t)=>t!==i):s=t?[...a,{user_id:n,emoji:t,message_id:e}]:a,{...r,reactions:s}}))},[]),v=(0,a.useCallback)(e=>{if(!n||0===e.length||!x.current)return;m([]),o("finding_match"),d(!0);let r=e.join(","),s=new EventSource("".concat("https://animochat-turn-server.onrender.com","/matchmaking?userId=").concat(n,"&interest=").concat(r));h.current=s,s.onopen=()=>o("waiting_for_match"),s.onmessage=e=>{try{let n=JSON.parse(e.data);if("MATCHED"===n.state&&x.current){o("connecting");let e=x.current.connect(n.matchedUserId,{metadata:{interest:n.interest}});i(e),t("chat"),d(!1),s.close()}}catch(e){console.error("Failed to parse matchmaking data:",e)}},s.onerror=()=>{console.error("Matchmaking EventSource error."),g("error")}},[n,g]),j=async(e,t)=>{y(e,t||null,n),s&&s.open&&s.send({type:"reaction",sender:n,content:{message_id:e,emoji:t||null,user_id:n}})},w=(0,a.useRef)(!1);return(0,a.useEffect)(()=>{if("connected"==l&&s&&x.current){var e;let t=(null==(e=s.metadata)?void 0:e.interest)||"an unknown topic";m([{id:(0,K.A)(),content:"Connected with a stranger on: ".concat(t),type:"system",sender:"system",created_at:new Date().toISOString(),session_id:"1"}])}if("connecting"===l){let e=setTimeout(()=>{if(s&&s.open){let e={id:(0,K.A)(),content:"The other peer did not respond to the handshake. They might be using an older version of the app.",type:"system",sender:"system",created_at:new Date().toISOString(),session_id:"1"};m(t=>[...t,e]),o("disconnected"),s.close(),i(null),d(!1),console.warn("Handshake response timeout. Closing connection.")}},7e3);return()=>clearTimeout(e)}},[l]),(0,a.useEffect)(()=>{s&&(s.on("open",()=>{let e={type:"handshake",content:"hi",sender:n};s.send(e),console.log("Sent handshake packet:",e)}),s.on("data",e=>{let t;try{t="string"==typeof e?JSON.parse(e):e}catch(t){console.error("Failed to parse incoming data:",e);return}if(console.log("Received packet:",t),"handshake"===t.type){"hi"===t.content&&s.send({type:"handshake_response",content:"hello",sender:n}),o("connected");return}if("handshake_response"===t.type&&"hello"===t.content)return void o("connected");if("typing"===t.type)return void f(t.content);if("message"===t.type){let e=t.content;m(t=>[...t,e])}else if("reaction"===t.type){let{messageId:e,emoji:n,userId:r}=t.content;y(e,n,r)}}),s.on("close",()=>{if(!x.current)return;let e={id:(0,K.A)(),content:"Connection closed by the other peer.",type:"system",sender:"system",created_at:new Date().toISOString(),session_id:"1"};m(t=>[...t,e]),o("disconnected"),d(!1)}))},[s,g,y]),{screen:e,peerId:n,status:l,isConnecting:c,isStrangerTyping:p,conn:s,messages:u,handleGetStarted:()=>{t("matchmaking"),x.current||(d(!0),b())},startMatchmaking:v,endChat:()=>{o("disconnected"),m(e=>[...e,{id:(0,K.A)(),content:"You have ended the chat.",type:"system",sender:"system",timestamp:new Date().toISOString(),session_id:"1",created_at:new Date().toISOString()}]),s&&(s.close(),i(null)),h.current&&(h.current.close(),h.current=null),d(!1)},sendMessage:e=>{if(w.current=!1,s&&s.open&&s.send({type:"typing",content:!1,sender:n}),s&&s.open&&e){let t={id:(0,K.A)(),content:e,sender:n,session_id:"1",created_at:new Date().toISOString()};s.send({type:"message",content:t,sender:n}),m(e=>[...e,t])}},onReact:j,onStartTyping:()=>{w.current||(w.current=!0,s&&s.open&&s.send({type:"typing",content:!0,sender:n}),setTimeout(()=>{w.current=!1,s&&s.open&&s.send({type:"typing",content:!1,sender:n})},3e3))}}};function ee(){let{screen:e,peerId:t,status:n,isConnecting:i,isStrangerTyping:l,messages:o,handleGetStarted:c,startMatchmaking:d,endChat:u,sendMessage:x,onReact:h,onStartTyping:p}=$(),[f,g]=(0,a.useState)(new Set),b=e=>{0!==e.size&&d(Array.from(e))};return(0,r.jsx)("div",{className:"h-full overflow-y-auto overflow-x-hidden",children:(0,r.jsxs)("main",{className:"container h-full mx-auto flex flex-col ".concat("chat"===e?"p-0":"px-4 py-8 md:py-16"),children:["chat"!==e&&(0,r.jsx)(s,{}),(0,r.jsx)("div",{className:"flex-grow flex flex-col justify-center items-center",children:(()=>{switch(e){case"chat":return(0,r.jsx)("div",{className:"h-full w-full flex items-center justify-center sm:p-4",children:(0,r.jsx)(V,{goBack:()=>{c()},onStartTyping:p,isStrangerTyping:l,onReact:h,messages:o,sendMessage:x,newChat:()=>{b(f)},endChat:u,peerId:t,status:n})});case"matchmaking":return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"max-w-3xl mx-auto relative w-full",children:(0,r.jsxs)("div",{className:"text-center mb-12",children:[(0,r.jsx)("h2",{className:"text-4xl md:text-6xl font-bold bg-gradient-to-r from-green-600 to-green-400 bg-clip-text text-transparent",children:"Choose Your Interests"}),(0,r.jsx)("p",{className:"text-gray-600 text-lg my-8",children:"Find someone to chat with based on what you like."})]})}),(0,r.jsx)(y,{interests:f,onInterestsChange:g,onFindMatch:b,isConnecting:i,status:n})]});default:return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"max-w-3xl mx-auto relative w-full",children:(0,r.jsxs)("div",{className:"text-center mb-12",children:[(0,r.jsxs)("h2",{className:"text-4xl md:text-6xl font-bold bg-gradient-to-r from-green-600 to-green-400 bg-clip-text text-transparent",children:["Real-time",(0,r.jsx)("br",{}),"Anonymous Chat"]}),(0,r.jsx)("p",{className:"text-gray-600 text-lg my-8",children:"Connect with students anonymously and securely."})]})}),(0,r.jsxs)("div",{className:"max-w-md mx-auto text-sm space-y-6 text-center",children:[(0,r.jsxs)("details",{className:"text-gray-500 bg-gray-50/80 p-3 rounded-2xl border border-gray-200",children:[(0,r.jsx)("summary",{className:"cursor-pointer font-medium hover:text-green-600",children:"What is Peer-to-Peer (P2P) Chat?"}),(0,r.jsx)("p",{className:"mt-2 text-left",children:'Peer-to-Peer chat means your messages go directly to the other user without passing through a central server. This provides better privacy and can be faster. Our server only helps to "introduce" two users to each other.'})]}),(0,r.jsx)("div",{className:"text-red-700 bg-red-50 p-4 rounded-2xl border border-red-200 font-medium",children:(0,r.jsx)("p",{children:"This is a test version of AnimoChat. Not all features are implemented, and you may encounter bugs."})})]}),(0,r.jsx)("div",{className:"text-center mt-12",children:(0,r.jsx)(m,{onClick:c,disabled:i,size:"lg",className:"rounded-full py-7 px-8 bg-green-500 hover:bg-green-600 text-white font-bold text-lg",children:i?"Initializing...":"Get Started"})})]})}})()}),"chat"!==e&&(0,r.jsxs)("footer",{className:"text-xs text-gray-500 text-center py-4 shrink-0",children:[(0,r.jsxs)("h3",{className:"py-4",children:["Created by developers from"," ",(0,r.jsx)("span",{className:"text-green-700 font-semibold",children:"De La Salle Lipa"})]}),t&&(0,r.jsxs)("p",{className:"font-mono text-gray-400 text-[10px] mt-2",children:["Your Peer ID: ",t]})]})]})})}},6379:(e,t,n)=>{Promise.resolve().then(n.bind(n,5181))},7351:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[817,230,441,684,358],()=>t(6379)),_N_E=e.O()}]);