(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3287:()=>{},5181:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>ee});var s=n(5155);function r(){return(0,s.jsxs)("div",{className:"fixed inset-0 overflow-hidden pointer-events-none z-5",children:[(0,s.jsx)("div",{className:"absolute top-1/4 left-1/4 w-24 h-24 bg-gradient-to-r from-green-100 to-green-50 rounded-full opacity-50 animate-float mix-blend-multiply"}),(0,s.jsx)("div",{className:"absolute top-1/3 right-32 w-48 h-48 bg-green-100 rounded-full opacity-20 animate-blob animation-delay-2000"}),(0,s.jsx)("div",{className:"absolute top-2/3 left-16 w-16 h-16 bg-green-50 rotate-45 opacity-30 animate-float animation-delay-3000"}),(0,s.jsx)("div",{className:"absolute bottom-32 right-1/4",children:(0,s.jsx)("div",{className:"w-32 h-32 border-4 border-green-100 rounded-full animate-pulse opacity-30"})}),(0,s.jsx)("div",{className:"absolute inset-0 opacity-10",children:(0,s.jsx)("div",{className:"h-full w-full bg-[linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] bg-[size:24px_24px]"})}),(0,s.jsx)("div",{className:"absolute top-0 left-0 w-1/3 h-full animate-line",children:(0,s.jsx)("div",{className:"w-px h-full bg-gradient-to-b from-transparent via-green-100 to-transparent"})})]})}var i=n(2115),a=n(2596),l=n(9688);function o(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,l.QP)((0,a.$)(t))}let c=i.forwardRef((e,t)=>{let{className:n,type:r,...i}=e;return(0,s.jsx)("input",{type:r,className:o("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),ref:t,...i})});c.displayName="Input";var d=n(4624);let u=(0,n(2085).F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function m(e){let{className:t,variant:n,size:r,asChild:i=!1,...a}=e,l=i?d.DX:"button";return(0,s.jsx)(l,{"data-slot":"button",className:o(u({variant:n,size:r,className:t})),...a})}var x=n(4416),p=n(5736);let h=(0,n(4982).UU)("https://wkafplnaexyyuobfufxa.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndrYWZwbG5hZXh5eXVvYmZ1ZnhhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0NjYwODEsImV4cCI6MjA2MTA0MjA4MX0.Sp9g2aWN24QoymYPoYJbxInnFNMautc26uJ1ba6Dvdc"),g=e=>{let{text:t,onRemove:n}=e;return(0,s.jsxs)("div",{className:"tag inline-flex items-center bg-green-600 text-white py-1 px-3 rounded-full m-1 font-medium text-sm transition-all duration-200 animate-in fade-in-50",children:[(0,s.jsx)("span",{children:t}),(0,s.jsx)("button",{onClick:()=>n(t),className:"ml-2 bg-black/10 hover:bg-black/30 rounded-full w-5 h-5 flex items-center justify-center transition-colors","aria-label":"Remove ".concat(t),children:(0,s.jsx)(x.A,{size:14})})]})},f=()=>(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),b=e=>{let{isOpen:t,onClose:n,onSubmit:r}=e,[a,l]=(0,i.useState)(""),[o,c]=(0,i.useState)(!1),[d,u]=(0,i.useState)(null),[h,g]=(0,i.useState)(!1),b=(0,i.useRef)(null);if((0,i.useEffect)(()=>{let e=e=>{"Escape"===e.key&&n()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[n]),(0,i.useEffect)(()=>{if(t){var e;null==(e=b.current)||e.focus(),l(""),c(!1),u(null),g(!1)}},[t]),!t)return null;let y=async e=>{if(e.preventDefault(),!a.trim())return void u("Feedback cannot be empty.");c(!0),u(null);try{await r(a),g(!0),setTimeout(()=>{n()},2e3)}catch(e){u("Failed to submit feedback. Please try again."),console.error(e)}finally{c(!1)}};return(0,s.jsx)("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center animate-in fade-in-50","aria-modal":"true",role:"dialog",children:(0,s.jsxs)("div",{ref:b,tabIndex:-1,className:"bg-white rounded-2xl shadow-2xl w-full max-w-md m-4 p-8 relative transform transition-all duration-300 scale-95 animate-in slide-in-from-bottom-10",children:[(0,s.jsx)("button",{onClick:n,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Close dialog",children:(0,s.jsx)(x.A,{size:24})}),(0,s.jsxs)("div",{className:"flex flex-col items-center text-center",children:[(0,s.jsx)("div",{className:"bg-green-100 p-3 rounded-full mb-4",children:(0,s.jsx)(p.A,{className:"text-green-600",size:32})}),(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Got a suggestion?"}),(0,s.jsx)("p",{className:"text-gray-500 mb-6",children:"We'd love to hear your ideas for new features or improvements."})]}),h?(0,s.jsx)("div",{className:"text-center p-4 bg-green-50 border border-green-200 rounded-lg",children:(0,s.jsx)("p",{className:"font-semibold text-green-700",children:"Thank you! Your feedback has been submitted."})}):(0,s.jsxs)("form",{onSubmit:y,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"feedback-content",className:"sr-only",children:"Your suggestion"}),(0,s.jsx)("textarea",{id:"feedback-content",value:a,onChange:e=>l(e.target.value),placeholder:"Type your suggestion here...",className:"w-full h-32 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors",required:!0})]}),d&&(0,s.jsx)("p",{className:"text-red-600 text-sm text-center",children:d}),(0,s.jsxs)(m,{type:"submit",disabled:o,className:"w-full rounded-full py-3 bg-green-600 hover:bg-green-700 text-white font-bold text-base disabled:bg-gray-400 disabled:cursor-wait flex items-center justify-center",children:[o&&(0,s.jsx)(f,{}),o?"Submitting...":"Submit Feedback"]})]})]})})};function y(e){let{interests:t,onInterestsChange:n,onFindMatch:r,isConnecting:a,status:l}=e,[o,d]=(0,i.useState)(""),[u,x]=(0,i.useState)([]),[y,v]=(0,i.useState)(!0),[j,w]=(0,i.useState)(null),[N,k]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(async()=>{v(!0);try{let e=await fetch("".concat("https://animochat-turn-server.onrender.com","/interests/popular"));if(!e.ok)throw Error("HTTP error! Status: ".concat(e.status));let t=await e.json();x(t)}catch(e){console.error("Failed to fetch popular interests:",e),w("Could not load topics.")}finally{v(!1)}})()},[]);let C=e=>{let s=e.trim().toUpperCase();s&&!t.has(s)&&n(new Set(t).add(s)),d("")},S=e=>{let s=new Set(t);s.delete(e),n(s)},E=async e=>{let{error:t}=await h.from("suggestions").insert([{content:e}]);if(t)throw console.error("Error submitting feedback to Supabase:",t),t};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"w-[350px] max-w-full mx-auto",children:[(0,s.jsx)("div",{className:"flex flex-wrap justify-center gap-2 min-h-[36px] mb-4",children:Array.from(t).map(e=>(0,s.jsx)(g,{text:e,onRemove:S},e))}),(0,s.jsx)(c,{id:"interest-input",type:"text",value:o,onChange:e=>d(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),C(o))},className:"rounded-full py-6 px-6 focus-visible:border-green-500 focus-visible:ring-green-500 ring-offset-1 text-center",placeholder:"Type an interest & press Enter",maxLength:26})]}),(0,s.jsxs)("div",{className:"mt-8 text-center",children:[(0,s.jsx)("h3",{className:"text-sm font-bold text-gray-500 uppercase tracking-wider mb-4",children:"Popular Topics"}),(0,s.jsx)("div",{className:"flex flex-wrap justify-center gap-2 max-w-md mx-auto",children:y?(0,s.jsx)("p",{className:"text-sm text-gray-400",children:"Loading topics..."}):j?(0,s.jsx)("p",{className:"text-sm text-red-500",children:j}):0===u.length?(0,s.jsx)("p",{className:"text-sm text-gray-400",children:"No active topics."}):u.map(e=>{let{interest:t,count:n}=e;return(0,s.jsxs)("button",{onClick:()=>C(t),className:"bg-green-100 text-green-800 text-xs font-semibold px-3 py-1.5 rounded-full hover:bg-green-200 hover:scale-105 transition-all duration-200",children:[(0,s.jsx)("span",{children:t}),(0,s.jsx)("span",{className:"bg-green-200 text-green-900 text-[10px] font-bold px-1.5 py-0.5 rounded-full ml-2",children:n})]},t)})})]}),(0,s.jsx)("div",{className:"mt-12 w-[350px] max-w-full mx-auto",children:(0,s.jsx)(m,{onClick:()=>{let e=new Set(t);o.trim()&&!e.has(o.trim().toUpperCase())&&n(e=new Set(e).add(o.trim().toUpperCase())),r(e)},disabled:a||0===t.size&&!o.trim(),className:"w-full rounded-full py-6 bg-green-600 hover:bg-green-700 text-white font-bold text-base disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center",children:a?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f,{}),l]}):"Find Match"})}),(0,s.jsx)("div",{className:"text-center mt-6",children:(0,s.jsxs)(m,{variant:"secondary",className:"text-gray-500 hover:text-green-600 transition-colors",onClick:()=>k(!0),children:[(0,s.jsx)(p.A,{size:16,className:"mr-2"}),"We'd love to hear your feedback"]})}),(0,s.jsx)(b,{isOpen:N,onClose:()=>k(!1),onSubmit:E})]})}let v={id:"default",name:"Default Chat Theme",accentColor:"#16a34a",userBubbleGradient:"linear-gradient(90deg, #16a34a, #16a34a)",userTextColor:"#ffffff",otherBubbleGradient:"linear-gradient(90deg, #f3f4f6, #f3f4f6)",otherTextColor:"#1F2937",otherAnimated:!1,userAnimated:!1,chatBackground:"linear-gradient(180deg, #ffffff, #ffffff)"};var j=n(3319);function w(e){if(e.includes("linear-gradient")){let t=e.match(/#([0-9A-F]{6}|[0-9A-F]{3})/gi);if(t)return t.reduce((e,t)=>{let n="#"===t.charAt(0)?t.substring(1,7):t,s=parseInt(n.substring(0,2),16);return e+.299*s+.587*parseInt(n.substring(2,4),16)+.114*parseInt(n.substring(4,6),16)},0)/t.length>186?"#000000":"#ffffff"}let t="#"===e.charAt(0)?e.substring(1,7):e,n=parseInt(t.substring(0,2),16);return .299*n+.587*parseInt(t.substring(2,4),16)+.114*parseInt(t.substring(4,6),16)>186?"#000000":"#ffffff"}n(7351),n(3287);var N=n(892),k=n(8619),C=n(8829),S=n(7859),E=n(9424);function _(e){let{visible:t,isUserMessage:n,reply:r,onOpenEmojiMenu:i,theme:a,isDeleted:l=!1}=e;return(0,s.jsxs)("div",{className:"flex flex-row h-full min-h-full justify-center space-x-1 ".concat(t?"visible":"invisible"),children:[(0,s.jsx)("div",{className:"".concat(n?"mr-1 mt-1":"ml-2 mt-1"," h-[2rem] rounded-full transition-colors p-2 cursor-pointer hover:opacity-100 opacity-80"),style:{background:n?a.userBubbleGradient:a.otherBubbleGradient,color:n?a.userTextColor:a.otherTextColor},onClick:r,children:(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",strokeWidth:"2",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})}),!l&&(0,s.jsx)("div",{className:"mt-1 h-[2rem] opacity-80 rounded-full transition-colors p-2 cursor-pointer hover:opacity-100",onClick:i,style:{background:n?a.userBubbleGradient:a.otherBubbleGradient},children:(0,s.jsx)(E.A,{className:"w-4 h-4",style:{color:n?a.userTextColor:a.otherTextColor},fill:"none",strokeWidth:"2",stroke:"currentColor",viewBox:"0 0 24 24"})}),n&&(0,s.jsx)("div",{className:"w-1"})]},"actions")}var T=n(6766);function I(e){let{message:t,isUserMessage:n,theme:r}=e;return t?"image"===t.type?(0,s.jsx)(P,{message:t,isUserMessage:n,theme:r}):(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{className:"rounded-tl-3xl rounded-tr-3xl rounded-b-3xl px-3 pt-2 text-sm opacity-[0.65] pb-[32px] -mb-[32px] -z-20",style:{background:n?r.userBubbleGradient:r.otherBubbleGradient,color:n?r.userTextColor:r.otherTextColor},children:(0,s.jsx)("p",{className:"break-words whitespace-pre-wrap",children:"deleted"===t.type?"Deleted message.":t.content})})}):null}function P(e){let{message:t,isUserMessage:n,theme:r}=e;return(0,s.jsx)("div",{className:"pb-[32px] -mb-[32px] rounded-tl-3xl rounded-tr-3xl rounded-b-3xl",children:(0,s.jsx)(T.default,{src:t.content,alt:"image",className:"rounded-tl-3xl rounded-tr-3xl rounded-b-3xl object-contain mb-1",width:80,height:100})})}function M(e){let{message:t,user:n,theme:r}=e,i=t.reactions;if(!i||0===i.length)return null;let a=i.length,l=Array.from(new Set(i.map(e=>e.emoji))),o=i.find(e=>e.user_id===n.id);return(0,s.jsx)(S.P.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},exit:{opacity:0,scale:0},transition:{duration:.2,ease:"easeOut"},className:"flex justify-end",children:(0,s.jsx)("div",{className:"self-end text-xs text-black relative rounded-full mt-auto bg-gray-200 border-2 border-white p-1.5 -top-2",children:(0,s.jsxs)("div",{className:"flex justify-center",children:[l.map((e,t)=>(0,s.jsx)("div",{className:"text-center",children:e},t)),(0,s.jsx)("p",{className:"pl-1",children:(0,s.jsx)("span",{style:{color:o?r.accentColor:"black"},children:a})})]})})})}var A=n(4032),R=n(9597);function D(e){var t,n,r;let{message:a,user:l,hovered:c,reply:d,animate:u=!1,onOpenEmojiMenu:m,onResendMessage:x,theme:p=v,advertisementMessageId:h,onLinkClick:g,onReact:f}=e,b=a.sender===l.id,y=(n=a.hasPrevious,r=a.hasNext,b?"rounded-tl-3xl rounded-bl-3xl ".concat(n?"rounded-tr-sm":"rounded-tr-3xl"," ").concat(r?"rounded-br-sm":"rounded-br-3xl"):"rounded-tr-3xl rounded-br-3xl ".concat(n?"rounded-tl-sm":"rounded-tl-3xl"," ").concat(r?"rounded-bl-sm":"rounded-bl-3xl")),j="sending"===a.status,N="error"===a.status,E=null!=(t=a.edited)&&t,T=a.content,P=function(e){let t=e.trim();if(!t)return!1;let n=t.replace(/\s+/g,""),s=RegExp("(\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F)","gu"),r=n.match(s);return!!r&&r.join("")===n}(T)&&3>=function(e){let t=e.trim().replace(/\s+/g,""),n=RegExp("(\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F)","gu"),s=t.match(n);return s?s.length:0}(T),M=(0,k.d)(0),R=(0,C.G)(M,b?[0,-30,-40,-50]:[0,30,40,50],[0,.5,.8,1]),D=function(e){let{delay:t=500}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(0,i.useRef)(null),s=(0,i.useRef)(!1),r=(0,i.useCallback)(()=>{null!==n.current&&(clearTimeout(n.current),n.current=null)},[]),a=(0,i.useCallback)(r=>{s.current=!1,n.current=window.setTimeout(()=>{e(r)},t)},[e,t]),l=(0,i.useCallback)(e=>{s.current=!0,r()},[r]);return{onTouchStart:a,onTouchMove:l,onTouchEnd:(0,i.useCallback)(e=>{s.current||e.stopPropagation(),r()},[r]),onTouchCancel:(0,i.useCallback)(e=>{r()},[r])}}(e=>{if("deleted"===a.type)return;m();let t=new TouchEvent("pointerup",{bubbles:!0,cancelable:!0,composed:!0});e.target.dispatchEvent(t)});return(0,s.jsxs)("div",{className:"relative flex w-full items-center ".concat(b?"justify-end":"justify-start"),children:[(0,s.jsx)(S.P.div,{className:o("absolute p-2.5 rounded-full",b?"right-0":"left-0"),style:{background:"".concat(p.accentColor,"15"),scale:R},children:(0,s.jsx)(A.A,{className:o("w-4 h-4"),style:{color:p.accentColor}})}),!N&&b&&(0,s.jsx)("p",{className:"opacity-50 text-[0.70rem] self-end pr-2 pb-2 overflow-clip -mr-[80px] ".concat(h!==a.id||c?"invisible":"visible"),style:{color:w(p.chatBackground)},children:"AnimoChat.com"}),b&&(0,s.jsx)(_,{isUserMessage:a.sender===l.id,visible:c,theme:p,reply:d,onOpenEmojiMenu:m,isDeleted:"deleted"===a.type}),N&&b&&(0,s.jsxs)("p",{className:"opacity-50 text-[0.70rem] self-end pr-2 pb-2 overflow-clip text-red-800",children:["Error sending message."," ",(0,s.jsx)("span",{className:"underline cursor-pointer",onClick:()=>x(a),children:"Retry"})]}),(0,s.jsxs)(S.P.div,{id:"message-bubble",dragSnapToOrigin:!0,dragTransition:{bounceDamping:13},drag:"x",dragConstraints:{left:0,right:0},onDrag:(e,t)=>{if((!b||!(t.offset.x>0))&&(b||!(t.offset.x<0))){if(document.querySelector("#emoji-overlay-main")){if(M.set(0),e instanceof TouchEvent){var n;let t=new TouchEvent("touchstart",{bubbles:!0,cancelable:!0,composed:!0,touches:[e.touches[0]]});null==(n=document)||n.dispatchEvent(t)}return}M.set(t.offset.x)}},onDragEnd:(e,t)=>{(b&&t.offset.x<-50||!b&&t.offset.x>50)&&!document.querySelector("#emoji-overlay-main")&&d(),M.set(0)},whileTap:{scale:.8},style:{x:M,originX:+!!b,WebkitTapHighlightColor:"transparent"},onDoubleClick:()=>{f("❤️")},..."deleted"!==a.type&&{onContextMenu:e=>{e.preventDefault(),e.stopPropagation(),m()}},...D,initial:!!u&&{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",duration:.4},className:"max-w-[75%] mb-0.5 flex flex-col ".concat(b?"items-end":"items-start"," ").concat(j?"opacity-50":""),children:[E&&(0,s.jsx)("p",{className:"text-[0.70rem] px-2 text-gray-500",children:"Edited"}),a.replyingTo&&(0,s.jsx)(I,{message:a.replyingTo,isUserMessage:b,theme:p}),(null===a.type||void 0===a.type||"text"===a.type||"deleted"===a.type)&&(0,s.jsx)(F,{isLargeEmojiMessage:P,message:a,user:l,theme:p,isUserMessage:b,roundedCorners:y,onLinkClick:g}),"image"===a.type&&(0,s.jsx)(z,{user:l,message:a,roundedCorners:y,isUserMessage:b,theme:p})]},a.id+"-bubble"),!b&&(0,s.jsx)(_,{visible:c,theme:p,isUserMessage:!1,reply:d,onOpenEmojiMenu:m}),!b&&(0,s.jsx)("p",{className:"opacity-50 text-[0.70rem] self-end pl-2 pb-2 -ml-[70px] ".concat(h!==a.id||c?"invisible":"visible"),style:{color:w(p.chatBackground)},children:"AnimoChat.com"})]},a.id)}function z(e){let{user:t,message:n,roundedCorners:r,isUserMessage:a,theme:l}=e,[o,c]=(0,i.useState)(!1),d="rounded-3xl ".concat(r," ").concat(a?"rounded-tr-3xl":"rounded-tl-3xl");return(0,s.jsxs)("div",{id:"image-message-container",onClick:()=>c(!0),style:{cursor:"pointer"},children:[(0,s.jsxs)("div",{className:d,style:{overflow:"hidden",position:"relative",border:"2px solid transparent"},children:[(0,s.jsx)(R.A8,{src:n.content,children:(0,s.jsx)(T.default,{width:Math.min(.6*window.innerWidth,300),height:Math.min(.6*window.innerWidth,300),className:d,src:n.content,alt:"Image",style:{filter:o?"none":"blur(8px)",transition:"filter 0.3s ease-in-out",maxWidth:"100%",objectFit:"contain",backgroundColor:l.chatBackground},sizes:"(max-width: 768px) 70vw, 400px"})},n.id),!o&&(0,s.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:l.userTextColor,backgroundColor:"rgba(0, 0, 0, 0.4)",padding:"4px 8px",borderRadius:"0.25rem",pointerEvents:"none",fontSize:"0.85rem"},children:"(tap to reveal)"})]}),(0,s.jsx)(M,{message:n,user:t,theme:l})]})}function F(e){let{message:t,user:n,theme:r,isUserMessage:i,roundedCorners:a,isLargeEmojiMessage:l,onLinkClick:o}=e,c="deleted"===t.type;return(0,s.jsx)(s.Fragment,{children:l?(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"px-2 py-2",children:[(0,s.jsx)("p",{className:"text-5xl",children:t.content}),(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)(M,{message:t,user:n,theme:r})})]})}):(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsxs)("div",{className:"relative group",children:[(0,s.jsx)("div",{className:"".concat(a," animate-gradient-x"),style:{background:i?r.userBubbleGradient:r.otherBubbleGradient,backgroundSize:"200% 100%",color:i?r.userTextColor:r.otherTextColor}}),(0,s.jsx)("div",{className:"".concat(a," relative max-w-full break-words px-3 py-2 ").concat(!i&&r.otherAnimated||i&&r.userAnimated?"bg-white opacity-70":""),style:{wordBreak:"break-word",overflowWrap:"break-word",color:i?r.userTextColor:r.otherTextColor},children:(0,s.jsx)("p",{className:"break-words whitespace-pre-wrap",children:(0,s.jsx)(N.A,{options:{attributes:{target:"_blank",rel:"noopener noreferrer",className:"underline"},render:e=>{let{attributes:t,content:n}=e;return(0,s.jsx)("a",{...t,onClick:e=>{o?o(e):e.stopPropagation()},children:n})}},children:c?(0,s.jsx)("span",{className:"italic",children:"Message has been deleted."}):t.content})})})]}),(0,s.jsx)(M,{message:t,user:n,theme:r})]})})}function L(e){let{message:t,user:n,onSwipe:r,onReact:a,onStartedSwipe:l,onEndedSwipe:o,animate:c=!1,theme:d=v,advertisementMessageId:u,onOpenEmojiMenu:m=()=>{},onResendMessage:x=()=>{},isEmojiMenuOpen:p,onLinkClick:h}=e,[g,f]=(0,i.useState)(!1),[b,y]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{y("ontouchstart"in window||navigator.maxTouchPoints>0)},[]),(0,s.jsx)("div",{"data-message-id":"message-"+t.id,className:"relative px-4 select-none",onMouseEnter:()=>!b&&f(!0),onMouseLeave:()=>!b&&f(!1),children:(0,s.jsx)("div",{children:(0,s.jsx)(D,{onLinkClick:h,animate:c,message:t,user:n,hovered:g,reply:()=>r(t.id),onOpenEmojiMenu:()=>m(t),onReact:e=>a(t.id,e),onResendMessage:x,theme:d,advertisementMessageId:u},t.id+"-bubble")},"parent-message-bubble flex flex-col")})}function B(e){let{index:t,message:n,user:r,animate:i=!1,isLast:a=!1,onSwipe:l,onStartedSwipe:o,onEndedSwipe:c,onReact:d,onOpenEmojiMenu:u,onResendMessage:m,isEmojiMenuOpen:x,theme:p,secondVisibleElement:h,onLinkClick:g}=e;if("system"===n.sender)return(0,s.jsx)("div",{className:"flex justify-center py-4 px-4 text-center",children:(0,s.jsx)("p",{className:"text-xs text-gray-500",children:n.content})},n.id+"_system");let f=t%5==0?n.id:null;return(0,s.jsxs)("div",{"data-is-message":"true","data-message-id":n.id,className:"max-w-full w-full select-none",children:[n.showTime&&(0,s.jsx)("div",{className:"flex justify-center py-4",children:(0,s.jsx)("p",{className:"text-xs text-gray-500 font-normal",children:n.created_at&&(0,j.GP)(new Date(n.created_at),"h:mm a")})},n.id+"_time"),(0,s.jsx)(L,{advertisementMessageId:f,message:n,animate:i,user:r,onSwipe:l,onStartedSwipe:o,onEndedSwipe:c,onReact:d,onOpenEmojiMenu:u,onResendMessage:m,theme:p,isEmojiMenuOpen:x,onLinkClick:g},n.id+"_message"),(a||!n.hasNext)&&(0,s.jsx)("div",{className:"h-1"},n.id+"_bottom")]},"parent_message_"+n.id)}var O=n(760);let G=["❤️","\uD83D\uDE06","\uD83D\uDE2E","\uD83D\uDE22","\uD83D\uDE2D","\uD83D\uDE21","\uD83D\uDC4D"];function Y(e){let{isUserMessage:t,preselectedEmoji:n,message:r,messageDiv:a,onReact:l,onClose:o}=e,c=(0,i.useRef)(null),[d,u]=(0,i.useState)({top:0,left:0}),[m,x]=(0,i.useState)(null),p=(0,i.useRef)(null);return(0,i.useLayoutEffect)(()=>{let e=a.querySelector("#message-bubble");if(e.style.position="relative",e.style.zIndex="30",e&&c.current){let t=e.getBoundingClientRect(),n=c.current,s=n.offsetHeight,r=t.top+window.scrollY-s-10,i=t.right-n.offsetWidth-16;e.classList.contains("items-end")||(i=t.left-16),u({top:r,left:i})}return()=>{e.style.zIndex="0"}},[a]),(0,i.useEffect)(()=>{let e=c.current;if(!e)return;let t=t=>{if(0!==t.button)return;try{e.setPointerCapture(t.pointerId)}catch(e){}p.current=t.pointerId;let n=document.elementFromPoint(t.clientX,t.clientY);if(n){let e=n.closest("[data-emoji]");if(e)return void x(e.getAttribute("data-emoji"))}x(null)},s=t=>{if(p.current!==t.pointerId||!e)return;let n=document.elementFromPoint(t.clientX,t.clientY);if(n){let e=n.closest("[data-emoji]");if(e)return void x(e.getAttribute("data-emoji"))}x(null)},i=t=>{if(p.current===t.pointerId){if(m){let e=(null==n?void 0:n.emoji)===m?null:m;l(r.id,e)}o();try{e.releasePointerCapture(t.pointerId)}catch(e){}p.current=null}};return e.addEventListener("pointerdown",t),window.addEventListener("pointermove",s),window.addEventListener("pointerup",i),()=>{e.removeEventListener("pointerdown",t),window.removeEventListener("pointermove",s),window.removeEventListener("pointerup",i)}},[m,l,o,n,r.id]),(0,s.jsx)(S.P.div,{layout:!0,className:"absolute top-0 left-0 w-screen h-screen",initial:{userSelect:"none",zIndex:100,opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:(0,s.jsx)("div",{id:"emoji-abs-container",className:"absolute border-box flex z-50 w-full md:w-fit px-4",style:{position:"absolute",top:d.top,left:d.left},children:(0,s.jsx)(S.P.div,{ref:c,id:"emoji-container-wrapper",className:"w-full backdrop-blur-md bg-gray-100 py-2 px-5 dark:bg-gray-800/80 shadow-lg rounded-full border border-gray-200 dark:border-gray-700",initial:{scale:.8,opacity:0,y:10},animate:{scale:1,opacity:1,y:0,transition:{type:"spring",stiffness:300,damping:20}},exit:{scale:.8,opacity:0,y:10,transition:{duration:.15}},children:(0,s.jsx)("div",{id:"emoji-container",className:"flex justify-between",children:(0,s.jsx)(O.N,{children:G.map(e=>(0,s.jsxs)(S.P.div,{className:"relative z-10 cursor-pointer rounded-full p-2 ".concat((null==n?void 0:n.emoji)===e?"bg-gray-200/80 dark:bg-gray-700/80":m===e?"bg-gray-100/80 dark:bg-gray-600/80":""),"data-emoji":e,animate:{scale:m===e?1.6:1},transition:{type:"spring",stiffness:300,damping:20},children:[(0,s.jsx)("span",{className:"text-xl",children:e}),(null==n?void 0:n.emoji)===e&&(0,s.jsx)(S.P.div,{className:"absolute -bottom-0.5 left-1/2 w-1 h-1 bg-green-500 rounded-full",initial:{opacity:0},animate:{opacity:1},layoutId:"selectedDot",style:{translateX:"-50%"}})]},e))})})})})},"emoji-menu")}var U=n(4357),W=n(3717),q=n(4126);function X(e){let{theme:t,anchor:n,onReply:r,onCopy:a,onEdit:l,onClose:o,onDelete:c}=e,d=n.querySelector("#message-bubble"),u=d.classList.contains("items-end"),m=null!==d.querySelector("#image-message-container"),x=[{icon:(0,s.jsx)(A.A,{className:"h-4 w-4"}),text:"Reply",onClick:r},{icon:(0,s.jsx)(U.A,{className:"h-4 w-4"}),text:"Copy",onClick:a},...u&&!m?[{icon:(0,s.jsx)(W.A,{className:"h-4 w-4"}),text:"Edit",onClick:l}]:[],...u?[{icon:(0,s.jsx)(q.A,{className:"h-4 w-4"}),text:"Delete",onClick:c}]:[]],[p,h]=(0,i.useState)({top:0,left:0}),[g,f]=(0,i.useState)(null),b=(0,i.useRef)(null),y=(0,i.createRef)();return(0,i.useEffect)(()=>{b.current=g},[g]),(0,i.useLayoutEffect)(()=>{if(!n||!y.current)return;let e=n.querySelector("#message-bubble"),t=document.querySelector("#chat-container"),s=e.getBoundingClientRect(),r=y.current.getBoundingClientRect(),i=s.bottom+10;if(i+r.height>t.clientHeight/2){i=s.top-r.height-10;let e=document.querySelector("#emoji-abs-container");e&&(e.style.top="".concat(i-r.height,"px"),i-=e.offsetHeight+24)}i+=window.scrollY;let a=s.right-r.width-24;u||(a=s.left),h({top:i,left:a})},[n,u]),(0,i.useEffect)(()=>{let e=e=>{if(!y.current)return;let t=y.current.querySelectorAll("button"),n=null;t.forEach((t,s)=>{let r=t.getBoundingClientRect();e.clientX>=r.left&&e.clientX<=r.right&&e.clientY>=r.top&&e.clientY<=r.bottom&&(n=s)}),f(n)},t=e=>{if(null!==b.current&&y.current){let e=y.current.querySelectorAll("button")[b.current];e&&e.click()}};window.addEventListener("pointermove",e),window.addEventListener("pointerup",t);let n=new PointerEvent("pointerdown",{bubbles:!0});return window.dispatchEvent(n),()=>{window.removeEventListener("pointermove",e),window.removeEventListener("pointerup",t)}},[]),(0,s.jsx)(S.P.div,{ref:y,id:"context-menu",className:"absolute flex flex-col rounded-3xl w-[200px] overflow-clip",style:{background:(null==t?void 0:t.chatBackground)||"linear-gradient(180deg, #ffffff, #ffffff)",top:p.top,left:p.left},initial:{opacity:0,scale:.9,transition:{type:"spring",stiffness:300,damping:20}},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9,transition:{duration:.15}},children:x.map((e,t)=>(0,s.jsx)(J,{icon:e.icon,text:e.text,onClick:()=>{e.onClick(),o()},active:g===t},t))})}function J(e){let{icon:t,text:n,onClick:r,active:i}=e;return(0,s.jsx)("div",{children:(0,s.jsxs)("button",{onClick:r,className:"flex items-center justify-start w-full px-6 py-4 text-sm text-black hover:bg-gray-200 ".concat(i?"bg-gray-200":""),children:[(0,s.jsx)("p",{className:"mr-auto",children:n}),t]})})}let H=e=>{var t,n,r,i;let{open:a,message:l,messageDiv:o,user:c,onReact:d,onClose:u,onCopy:m,onEdit:x,onReply:p,onDelete:h}=e;return(0,s.jsx)(O.N,{children:a&&(0,s.jsxs)("div",{id:"emoji-overlay-main",className:"overflow-visible absolute left-0 top-0 select-none",children:[(0,s.jsx)(S.P.div,{layout:!0,initial:{opacity:0},animate:{opacity:.5},exit:{opacity:0},className:"fixed inset-0 bg-black z-30",onClick:u},"emoji-overlay"),(0,s.jsxs)("div",{className:"relative z-40 w-full",children:[(0,s.jsx)(Y,{isUserMessage:l.sender===c.id,preselectedEmoji:(null==(n=l.reactions)||null==(t=n.find(e=>e.user_id===c.id))?void 0:t.emoji)!=null?{emoji:null==(i=l.reactions)||null==(r=i.find(e=>e.user_id===c.id))?void 0:r.emoji}:void 0,messageDiv:o,message:l,onReact:d,onClose:u},"emoji-menu"),(0,s.jsx)(X,{onCopy:()=>m(l.id),onEdit:()=>x(l.id),onReply:()=>p(l.id),onDelete:()=>h(l.id),onClose:u,theme:v,anchor:o},"context-menu")]},"context-container")]},"emoji-overlay-main")})},Z=()=>(0,s.jsx)(S.P.div,{className:"flex justify-start",children:(0,s.jsxs)("div",{className:"flex mb-2 mx-4 max-w-[100%] rounded-3xl px-4 py-4 bg-gray-100 text-gray-800 relative",children:[(0,s.jsx)("div",{className:"h-2 w-2 bg-gray-800 rounded-full animate-bounce [animation-delay:-0.3s]"}),(0,s.jsx)("div",{className:"h-2 w-2 mx-1 bg-gray-800 rounded-full animate-bounce [animation-delay:-0.15s]"}),(0,s.jsx)("div",{className:"h-2 w-2 bg-gray-800 rounded-full animate-bounce"})]})},"typing-motiondiv");function V(e){let{messages:t,goBack:n,sendMessage:r,onStartTyping:a,onEditMessage:l,isStrangerTyping:o,endChat:d,newChat:u,onReact:x,peerId:p,status:h}=e,[g,f]=(0,i.useState)(""),[b,y]=(0,i.useState)(!1),j=(0,i.useRef)(null),w=(0,i.useRef)(!1),[N,k]=(0,i.useState)({open:!1}),C=(0,i.useRef)(!1),S=function(e){let[t,n]=(0,i.useState)([]);return(0,i.useEffect)(()=>{if(!e||0===e.length)return void n([]);let t=null,s=[];for(let n=0;n<e.length;n++){let r=e[n],i=new Date(r.created_at).getTime(),a=!1;isNaN(i)?console.warn("Invalid date encountered for message:",r.id):"system"!==r.sender&&"typing"!==r.id&&"filler"!==r.id&&(null===t||i-t>3e5)&&(a=!0,t=i),s.push({...r,showTime:a,hasPrevious:!1,hasNext:!1})}s=s.map(e=>{let t=e.replyingTo;if(t&&"string"==typeof t){let n=s.find(e=>e.id===t);if(n)return{...e,replyingTo:n}}return e});for(let e=0;e<s.length;e++){let t=s[e],n=s[e-1],r=s[e+1];if(!t)continue;t.hasPrevious=!!n&&n.sender===t.sender,t.hasNext=!!r&&r.sender===t.sender,t.showTime&&n&&(t.hasPrevious=!1,n.hasNext=!1),t.reactions&&t.reactions.length>0&&r&&(t.hasNext=!1,r.sender===t.sender&&(r.hasPrevious=!1)),t.replyingTo&&n&&(t.hasPrevious=!1,n.sender===t.sender&&(n.hasNext=!1)),t.replyingTo&&r&&(t.hasNext=!1,r.sender===t.sender&&(r.hasPrevious=!1)),n&&n.replyingTo&&(t.hasPrevious=!1,n.hasNext=!1);let i=s[e+1];i&&("system"===i.sender||"typing"===i.id||"filler"===i.id)&&(t.hasNext=!1)}let r=null,i=s.findIndex(e=>"typing"===e.id);-1!==i&&(r=s.splice(i,1)[0]);let a=new Set,l=s.filter(e=>!a.has(e.id)&&(a.add(e.id),!0));r&&l.push(r),n(l)},[e]),t}(t),[E,_]=(0,i.useState)(null),T=e=>{if(!e){k({open:!1}),C.current=!1;return}let t=document.querySelector('[data-message-id="'.concat(null==e?void 0:e.id,'"]'));t&&(C.current=!0,k({open:!0,message:e,messageDiv:t}))};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(H,{open:N.open,message:N.message,messageDiv:N.messageDiv,user:{id:p},onReact:x,onReply:e=>{let n=t.find(t=>t.id===e);n&&_({message:n,type:"replying",title:"Replying",description:n.content})},onEdit:e=>{let n=t.find(t=>t.id===e);n&&(f(n.content),_({message:n,type:"editing",title:"Editing",description:n.content}))},onCopy:e=>{let n=t.find(t=>t.id===e);n&&(navigator.clipboard.writeText(n.content).then(()=>{console.log("Message copied to clipboard")}).catch(e=>{console.error("Failed to copy message: ",e)}),T(null))},onDelete:e=>{t.find(t=>t.id===e)&&(console.log("Delete message with ID: ".concat(e)),T(null))},onClose:()=>T(null)}),(0,s.jsxs)("div",{id:"chat-container",className:"w-full max-w-md mx-auto h-[100dvh] flex flex-col bg-white/70 backdrop-blur-xl sm:rounded-[2rem] shadow-2xl overflow-hidden",children:[(0,s.jsxs)("div",{className:"p-4 bg-white/60 border-b border-gray-200/80 flex items-center shrink-0",children:["connected"!==h&&(0,s.jsx)(m,{variant:"outline",size:"sm",onClick:n,className:"rounded-full mr-2",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,s.jsx)("polyline",{points:"15 18 9 12 15 6"})})}),(0,s.jsxs)("div",{className:"text-left mr-auto ml-2",children:[(0,s.jsx)("p",{className:"text-xs font-medium text-gray-500",children:"Status"}),(0,s.jsx)("p",{className:"text-sm font-semibold text-green-600",children:h.charAt(0).toUpperCase()+h.slice(1)})]}),"connected"===h&&(0,s.jsx)(m,{variant:b?"destructive":"outline",size:"sm",onClick:()=>{b?(d(),y(!1)):y(!0)},className:"rounded-full",children:b?"Confirm?":"End Chat"}),"connected"!==h&&(0,s.jsx)(m,{variant:"outline",size:"sm",onClick:u,className:"rounded-full",children:"New Chat"})]}),(0,s.jsxs)("div",{className:"p-2 text-center text-xs text-gray-500 bg-white/60 border-b border-gray-200/80 shrink-0",children:["not all features are implemented, still in early stages ",(0,s.jsx)("br",{})," ","-@tyronscott_"]}),(0,s.jsxs)("div",{ref:j,className:"flex-grow overflow-y-auto overflow-x-hidden py-4 flex flex-col-reverse",children:[o&&(0,s.jsx)(Z,{}),"finding_match"!==h&&"connecting"!==h&&[...S].reverse().map((e,n)=>"system"===e.sender||"system"===e.type?(0,s.jsx)("div",{className:"text-center my-2",children:(0,s.jsx)("span",{className:"text-xs text-gray-500 bg-gray-100 rounded-full px-3 py-1",children:e.content})},n):(0,s.jsx)(B,{index:n,message:e,user:{id:p},isLast:0===n,onSwipe:e=>{let n=t.find(t=>t.id===e);n&&_({message:n,type:"replying",title:"Replying",description:n.content})},onStartedSwipe:()=>{},onEndedSwipe:()=>{},onReact:x,onOpenEmojiMenu:()=>T(e),onResendMessage:()=>{},isEmojiMenuOpen:w,theme:v,animate:!1,secondVisibleElement:null},n)),"connecting"===h&&(0,s.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,s.jsx)("span",{className:"ml-4 text-gray-500 text-sm",children:"Connecting..."})}),"finding_match"===h&&(0,s.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,s.jsx)("p",{className:"text-gray-500",children:"Finding a match..."})})]}),E&&(0,s.jsx)("div",{className:"flex items-start gap-2 px-3 py-2 bg-gray-100 border-l-4 mb-2 relative",children:(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-xs font-semibold text-green-700",children:"replying"===E.type?"Replying to":"Editing"}),(0,s.jsx)("button",{type:"button",className:"ml-auto text-gray-400 hover:text-gray-600","aria-label":"Cancel",onClick:()=>_(null),children:(0,s.jsxs)("svg",{width:"18",height:"18",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:[(0,s.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,s.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,s.jsx)("div",{className:"text-xs text-gray-700 truncate max-w-xs",children:E.description})]})}),(0,s.jsx)("div",{className:"p-4 bg-white/60 border-t border-gray-200/80 shrink-0",children:(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault();let t=g.trim();if(t){var n;let e=null==E||null==(n=E.message)?void 0:n.id;if(e&&(null==E?void 0:E.type)==="editing"){null==l||l(e,t),_(null),f("");return}r(t,e),f(""),e&&_(null)}},className:"flex space-x-3",children:[(0,s.jsx)(c,{disabled:"connected"!==h,type:"text",value:g,onChange:e=>{f(e.target.value),a()},placeholder:"Type a message...",className:"text-[16px] flex-grow p-3 border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500 bg-white/80",autoComplete:"off",required:!0}),(0,s.jsx)(m,{type:"submit",disabled:!g.trim()||"connected"!==h,className:"bg-green-500 text-white font-bold w-12 h-12 rounded-full hover:bg-green-600 flex items-center justify-center shadow-lg",children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("line",{x1:"12",y1:"19",x2:"12",y2:"5"}),(0,s.jsx)("polyline",{points:"5 12 12 5 19 12"})]})})]})})]})]})}var Q=n(5723),K=n(1368);let $=()=>{let[e,t]=(0,i.useState)("intro"),[n,s]=(0,i.useState)(""),[r,a]=(0,i.useState)(null),[l,o]=(0,i.useState)("initializing"),[c,d]=(0,i.useState)(!1),[u,m]=(0,i.useState)([]),x=(0,i.useRef)(null),p=(0,i.useRef)(null),[h,g]=(0,i.useState)(!1),f=(0,i.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ready";r&&r.close(),p.current&&p.current.close(),a(null),m([]),t("matchmaking"),o(e),d(!1)},[r]),b=(0,i.useCallback)(()=>{if(!x.current){let e=new Q.xM({config:{iceTransportPolicy:"relay",iceServers:[{urls:"turn:relay1.expressturn.com:3480",username:"000000002066065602",credential:"AlQhdlmP9HdGw+NC1+Zs9vtvHQU="},{url:"stun:stun.l.google.com:19302"}]}});x.current=e,e.on("open",e=>{s(e),o("ready"),d(!1)}),e.on("connection",e=>{console.log("New connection"),a(e),t("chat"),d(!1),o("connecting")}),e.on("error",e=>{console.error("PeerJS error:",e),f("error")})}},[f]),y=(e,t,n)=>{console.log("Handling reaction:",{messageId:e,emoji:t,userId:n}),m(s=>s.map(s=>{let r;if(s.id!==e||"system"===s.type)return s;let i=s.reactions||[],a=i.findIndex(e=>e.user_id===n);return a>-1?t?(r=[...i])[a]={user_id:n,emoji:t,message_id:e}:r=i.filter((e,t)=>t!==a):r=t?[...i,{user_id:n,emoji:t,message_id:e}]:i,{...s,reactions:r}}))},v=(0,i.useCallback)(e=>{if(!n||0===e.length||!x.current)return;m([]),o("finding_match"),d(!0);let s=e.join(","),r=new EventSource("".concat("https://animochat-turn-server.onrender.com","/matchmaking?userId=").concat(n,"&interest=").concat(s));p.current=r,r.onopen=()=>o("waiting_for_match"),r.onmessage=e=>{try{let n=JSON.parse(e.data);if("MATCHED"===n.state&&x.current){o("connecting");let e=x.current.connect(n.matchedUserId,{metadata:{interest:n.interest}});a(e),t("chat"),d(!1),r.close()}}catch(e){console.error("Failed to parse matchmaking data:",e)}},r.onerror=()=>{console.error("Matchmaking EventSource error."),f("error")}},[n,f]),j=async(e,t)=>{y(e,t||null,n),r&&r.open&&await r.send({type:"reaction",sender:n,content:{message_id:e,emoji:t||null,user_id:n}})},w=(0,i.useRef)(!1);return(0,i.useEffect)(()=>{if("connected"==l&&r&&x.current){var e;let t=(null==(e=r.metadata)?void 0:e.interest)||"an unknown topic";m([{id:(0,K.A)(),content:"Connected with a stranger on: ".concat(t),type:"system",sender:"system",created_at:new Date().toISOString(),session_id:"1"}])}if("connecting"===l){let e=setTimeout(()=>{if(r&&r.open){let e={id:(0,K.A)(),content:"The other peer did not respond to the handshake. They might be using an older version of the app.",type:"system",sender:"system",created_at:new Date().toISOString(),session_id:"1"};m(t=>[...t,e]),o("disconnected"),r.close(),a(null),d(!1),console.warn("Handshake response timeout. Closing connection.")}},7e3);return()=>clearTimeout(e)}},[l]),(0,i.useEffect)(()=>{r&&(r.on("open",()=>{let e={type:"handshake",content:"hi",sender:n};r.send(e),console.log("Sent handshake packet:",e)}),r.on("data",e=>{let t;try{t="string"==typeof e?JSON.parse(e):e}catch(t){console.error("Failed to parse incoming data:",e);return}if(console.log("Received packet:",t),"reaction"===t.type){let{message_id:e,emoji:n,user_id:s}=t.content;y(e,n,s)}if("handshake"===t.type){"hi"===t.content&&r.send({type:"handshake_response",content:"hello",sender:n}),o("connected");return}if("handshake_response"===t.type&&"hello"===t.content)return void o("connected");if("typing"===t.type)return void g(t.content);if("edit_message"===t.type){let{message_id:e,new_content:n,user_id:s}=t.content;m(t=>t.map(t=>t.id===e&&t.sender===s?{...t,content:n,edited:!0}:t));return}if("message"===t.type){let e=t.content;m(t=>[...t,e]);return}}),r.on("close",()=>{if(!x.current||!r)return;let e={id:(0,K.A)(),content:"Connection closed by the other peer.",type:"system",sender:"system",created_at:new Date().toISOString(),session_id:"1"};m(t=>[...t,e]),o("disconnected"),d(!1),a(null)}))},[r,f,y]),{screen:e,peerId:n,status:l,isConnecting:c,isStrangerTyping:h,conn:r,messages:u,handleGetStarted:()=>{t("matchmaking"),x.current||(d(!0),b())},startMatchmaking:v,endChat:()=>{o("disconnected"),m(e=>[...e,{id:(0,K.A)(),content:"You have ended the chat.",type:"system",sender:"system",timestamp:new Date().toISOString(),session_id:"1",created_at:new Date().toISOString()}]),r&&(r.close(),a(null)),p.current&&(p.current.close(),p.current=null),d(!1)},editMessage:(e,t)=>{t&&e&&(w.current=!1,r&&r.open&&r.send({type:"typing",content:!1,sender:n}),m(n=>n.map(n=>n.id===e?{...n,content:t,edited:!0}:n)),r&&r.open&&r.send({type:"edit_message",content:{message_id:e,new_content:t,user_id:n},sender:n}))},sendMessage:(e,t)=>{if(console.log("Sending message:",e,"Replying to:",t),w.current=!1,r&&r.open&&r.send({type:"typing",content:!1,sender:n}),r&&r.open&&e){let s={id:(0,K.A)(),content:e,sender:n,session_id:"1",replyingTo:t,created_at:new Date().toISOString()};r.send({type:"message",content:s,sender:n}),m(e=>[...e,s])}},onReact:j,onStartTyping:()=>{w.current||(w.current=!0,r&&r.open&&r.send({type:"typing",content:!0,sender:n}),setTimeout(()=>{w.current=!1,r&&r.open&&r.send({type:"typing",content:!1,sender:n})},3e3))}}};function ee(){let{screen:e,peerId:t,status:n,isConnecting:a,isStrangerTyping:l,messages:o,handleGetStarted:c,startMatchmaking:d,endChat:u,editMessage:x,sendMessage:p,onReact:h,onStartTyping:g}=$(),[f,b]=(0,i.useState)(new Set),v=e=>{0!==e.size&&d(Array.from(e))};return(0,s.jsx)("div",{className:"h-full overflow-y-auto overflow-x-hidden",children:(0,s.jsxs)("main",{className:"container h-full mx-auto flex flex-col ".concat("chat"===e?"p-0":"px-4 py-8 md:py-16"),children:["chat"!==e&&(0,s.jsx)(r,{}),(0,s.jsx)("div",{className:"flex-grow flex flex-col justify-center items-center",children:(()=>{switch(e){case"chat":return(0,s.jsx)("div",{className:"h-full w-full flex items-center justify-center sm:p-4",children:(0,s.jsx)(V,{goBack:()=>{c()},onEditMessage:x,onStartTyping:g,isStrangerTyping:l,onReact:h,messages:o,sendMessage:p,newChat:()=>{v(f)},endChat:u,peerId:t,status:n})});case"matchmaking":return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"max-w-3xl mx-auto relative w-full",children:(0,s.jsxs)("div",{className:"text-center mb-12",children:[(0,s.jsx)("h2",{className:"text-4xl md:text-6xl font-bold bg-gradient-to-r from-green-600 to-green-400 bg-clip-text text-transparent",children:"Choose Your Interests"}),(0,s.jsx)("p",{className:"text-gray-600 text-lg my-8",children:"Find someone to chat with based on what you like."})]})}),(0,s.jsx)(y,{interests:f,onInterestsChange:b,onFindMatch:v,isConnecting:a,status:n})]});default:return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"max-w-3xl mx-auto relative w-full",children:(0,s.jsxs)("div",{className:"text-center mb-12",children:[(0,s.jsxs)("h2",{className:"text-4xl md:text-6xl font-bold bg-gradient-to-r from-green-600 to-green-400 bg-clip-text text-transparent",children:["Real-time",(0,s.jsx)("br",{}),"Anonymous Chat"]}),(0,s.jsx)("p",{className:"text-gray-600 text-lg my-8",children:"Connect with students anonymously and securely."})]})}),(0,s.jsxs)("div",{className:"max-w-md mx-auto text-sm space-y-6 text-center",children:[(0,s.jsxs)("details",{className:"text-gray-500 bg-gray-50/80 p-3 rounded-2xl border border-gray-200",children:[(0,s.jsx)("summary",{className:"cursor-pointer font-medium hover:text-green-600",children:"What is Peer-to-Peer (P2P) Chat?"}),(0,s.jsx)("p",{className:"mt-2 text-left",children:'Peer-to-Peer chat means your messages go directly to the other user without passing through a central server. This provides better privacy and can be faster. Our server only helps to "introduce" two users to each other.'})]}),(0,s.jsx)("div",{className:"text-red-700 bg-red-50 p-4 rounded-2xl border border-red-200 font-medium",children:(0,s.jsx)("p",{children:"This is a test version of AnimoChat. Not all features are implemented, and you may encounter bugs."})})]}),(0,s.jsx)("div",{className:"text-center mt-12",children:(0,s.jsx)(m,{onClick:c,disabled:a,size:"lg",className:"rounded-full py-7 px-8 bg-green-500 hover:bg-green-600 text-white font-bold text-lg",children:a?"Initializing...":"Get Started"})})]})}})()}),"chat"!==e&&(0,s.jsxs)("footer",{className:"text-xs text-gray-500 text-center py-4 shrink-0",children:[(0,s.jsxs)("h3",{className:"py-4",children:["Created by developers from"," ",(0,s.jsx)("span",{className:"text-green-700 font-semibold",children:"De La Salle Lipa"})]}),t&&(0,s.jsxs)("p",{className:"font-mono text-gray-400 text-[10px] mt-2",children:["Your Peer ID: ",t]})]})]})})}},6379:(e,t,n)=>{Promise.resolve().then(n.bind(n,5181))},7351:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[817,230,441,684,358],()=>t(6379)),_N_E=e.O()}]);