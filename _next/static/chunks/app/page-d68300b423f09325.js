(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2975:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>V});var r=n(5155);function s(){return(0,r.jsxs)("div",{className:"fixed inset-0 overflow-hidden pointer-events-none z-5",children:[(0,r.jsx)("div",{className:"absolute top-1/4 left-1/4 w-24 h-24 bg-gradient-to-r from-green-100 to-green-50 rounded-full opacity-50 animate-float mix-blend-multiply"}),(0,r.jsx)("div",{className:"absolute top-1/3 right-32 w-48 h-48 bg-green-100 rounded-full opacity-20 animate-blob animation-delay-2000"}),(0,r.jsx)("div",{className:"absolute top-2/3 left-16 w-16 h-16 bg-green-50 rotate-45 opacity-30 animate-float animation-delay-3000"}),(0,r.jsx)("div",{className:"absolute bottom-32 right-1/4",children:(0,r.jsx)("div",{className:"w-32 h-32 border-4 border-green-100 rounded-full animate-pulse opacity-30"})}),(0,r.jsx)("div",{className:"absolute inset-0 opacity-10",children:(0,r.jsx)("div",{className:"h-full w-full bg-[linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] bg-[size:24px_24px]"})}),(0,r.jsx)("div",{className:"absolute top-0 left-0 w-1/3 h-full animate-line",children:(0,r.jsx)("div",{className:"w-px h-full bg-gradient-to-b from-transparent via-green-100 to-transparent"})})]})}var a=n(2115),i=n(2596),l=n(9688);function o(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,l.QP)((0,i.$)(t))}let c=a.forwardRef((e,t)=>{let{className:n,type:s,...a}=e;return(0,r.jsx)("input",{type:s,className:o("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),ref:t,...a})});c.displayName="Input";var d=n(4624);let u=(0,n(2085).F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function m(e){let{className:t,variant:n,size:s,asChild:a=!1,...i}=e,l=a?d.DX:"button";return(0,r.jsx)(l,{"data-slot":"button",className:o(u({variant:n,size:s,className:t})),...i})}var x=n(4416);let h=e=>{let{text:t,onRemove:n}=e;return(0,r.jsxs)("div",{className:"tag inline-flex items-center bg-green-600 text-white py-1 px-3 rounded-full m-1 font-medium text-sm transition-all duration-200 animate-in fade-in-50",children:[(0,r.jsx)("span",{children:t}),(0,r.jsx)("button",{onClick:()=>n(t),className:"ml-2 bg-black/10 hover:bg-black/30 rounded-full w-5 h-5 flex items-center justify-center transition-colors","aria-label":"Remove ".concat(t),children:(0,r.jsx)(x.A,{size:14})})]})},p=()=>(0,r.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]});function f(e){let{interests:t,onInterestsChange:n,onFindMatch:s,isConnecting:i,status:l}=e,[o,d]=(0,a.useState)(""),[u,x]=(0,a.useState)([]),[f,g]=(0,a.useState)(!0),[b,y]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{g(!0);try{let e=await fetch("".concat("https://animochat-turn-server.onrender.com","/interests/popular"));if(!e.ok)throw Error("HTTP error! Status: ".concat(e.status));let t=await e.json();x(t)}catch(e){console.error("Failed to fetch popular interests:",e),y("Could not load topics.")}finally{g(!1)}})()},[]);let v=e=>{let r=e.trim().toUpperCase();r&&!t.has(r)&&n(new Set(t).add(r)),d("")},j=e=>{let r=new Set(t);r.delete(e),n(r)};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"w-[350px] max-w-full mx-auto",children:[(0,r.jsx)("div",{className:"flex flex-wrap justify-center gap-2 min-h-[36px] mb-4",children:Array.from(t).map(e=>(0,r.jsx)(h,{text:e,onRemove:j},e))}),(0,r.jsx)(c,{id:"interest-input",type:"text",value:o,onChange:e=>d(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),v(o))},className:"rounded-full py-6 px-6 focus-visible:border-green-500 focus-visible:ring-green-500 ring-offset-1 text-center",placeholder:"Type an interest & press Enter",maxLength:26})]}),(0,r.jsxs)("div",{className:"mt-8 text-center",children:[(0,r.jsx)("h3",{className:"text-sm font-bold text-gray-500 uppercase tracking-wider mb-4",children:"Popular Topics"}),(0,r.jsx)("div",{className:"flex flex-wrap justify-center gap-2 max-w-md mx-auto",children:f?(0,r.jsx)("p",{className:"text-sm text-gray-400",children:"Loading topics..."}):b?(0,r.jsx)("p",{className:"text-sm text-red-500",children:b}):0===u.length?(0,r.jsx)("p",{className:"text-sm text-gray-400",children:"No active topics."}):u.map(e=>{let{interest:t,count:n}=e;return(0,r.jsxs)("button",{onClick:()=>v(t),className:"bg-green-100 text-green-800 text-xs font-semibold px-3 py-1.5 rounded-full hover:bg-green-200 hover:scale-105 transition-all duration-200",children:[(0,r.jsx)("span",{children:t}),(0,r.jsx)("span",{className:"bg-green-200 text-green-900 text-[10px] font-bold px-1.5 py-0.5 rounded-full ml-2",children:n})]},t)})})]}),(0,r.jsx)("div",{className:"mt-12 w-[350px] max-w-full mx-auto",children:(0,r.jsx)(m,{onClick:()=>{let e=new Set(t);o.trim()&&!e.has(o.trim().toUpperCase())&&n(e=new Set(e).add(o.trim().toUpperCase())),s(e)},disabled:i||0===t.size&&!o.trim(),className:"w-full rounded-full py-6 bg-green-600 hover:bg-green-700 text-white font-bold text-base disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center",children:i?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p,{}),l]}):"Find Match"})})]})}let g={id:"default",name:"Default Chat Theme",accentColor:"#16a34a",userBubbleGradient:"linear-gradient(90deg, #16a34a, #16a34a)",userTextColor:"#ffffff",otherBubbleGradient:"linear-gradient(90deg, #f3f4f6, #f3f4f6)",otherTextColor:"#1F2937",otherAnimated:!1,userAnimated:!1,chatBackground:"linear-gradient(180deg, #ffffff, #ffffff)"};var b=n(3319);function y(e){if(e.includes("linear-gradient")){let t=e.match(/#([0-9A-F]{6}|[0-9A-F]{3})/gi);if(t)return t.reduce((e,t)=>{let n="#"===t.charAt(0)?t.substring(1,7):t,r=parseInt(n.substring(0,2),16);return e+.299*r+.587*parseInt(n.substring(2,4),16)+.114*parseInt(n.substring(4,6),16)},0)/t.length>186?"#000000":"#ffffff"}let t="#"===e.charAt(0)?e.substring(1,7):e,n=parseInt(t.substring(0,2),16);return .299*n+.587*parseInt(t.substring(2,4),16)+.114*parseInt(t.substring(4,6),16)>186?"#000000":"#ffffff"}n(7351),n(3287);var v=n(892),j=n(8619),w=n(8829),N=n(7859),k=n(9424);function C(e){let{visible:t,isUserMessage:n,reply:s,onOpenEmojiMenu:a,theme:i,isDeleted:l=!1}=e;return(0,r.jsxs)("div",{className:"flex flex-row h-full min-h-full justify-center space-x-1 ".concat(t?"visible":"invisible"),children:[(0,r.jsx)("div",{className:"".concat(n?"mr-1 mt-1":"ml-2 mt-1"," h-[2rem] rounded-full transition-colors p-2 cursor-pointer hover:opacity-100 opacity-80"),style:{background:n?i.userBubbleGradient:i.otherBubbleGradient,color:n?i.userTextColor:i.otherTextColor},onClick:s,children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",strokeWidth:"2",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})}),!l&&(0,r.jsx)("div",{className:"mt-1 h-[2rem] opacity-80 rounded-full transition-colors p-2 cursor-pointer hover:opacity-100",onClick:a,style:{background:n?i.userBubbleGradient:i.otherBubbleGradient},children:(0,r.jsx)(k.A,{className:"w-4 h-4",style:{color:n?i.userTextColor:i.otherTextColor},fill:"none",strokeWidth:"2",stroke:"currentColor",viewBox:"0 0 24 24"})}),n&&(0,r.jsx)("div",{className:"w-1"})]},"actions")}var S=n(6766);function E(e){let{message:t,isUserMessage:n,theme:s}=e;return t?"image"===t.type?(0,r.jsx)(_,{message:t,isUserMessage:n,theme:s}):(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("div",{className:"rounded-tl-3xl rounded-tr-3xl rounded-b-3xl px-3 pt-2 text-sm opacity-[0.65] pb-[32px] -mb-[32px] -z-20",style:{background:n?s.userBubbleGradient:s.otherBubbleGradient,color:n?s.userTextColor:s.otherTextColor},children:(0,r.jsx)("p",{className:"break-words whitespace-pre-wrap",children:"deleted"===t.type?"Deleted message.":t.content})})}):null}function _(e){let{message:t,isUserMessage:n,theme:s}=e;return(0,r.jsx)("div",{className:"pb-[32px] -mb-[32px] rounded-tl-3xl rounded-tr-3xl rounded-b-3xl",children:(0,r.jsx)(S.default,{src:t.content,alt:"image",className:"rounded-tl-3xl rounded-tr-3xl rounded-b-3xl object-contain mb-1",width:80,height:100})})}function T(e){let{message:t,user:n,theme:s}=e,a=t.reactions;if(!a||0===a.length)return null;let i=a.length,l=Array.from(new Set(a.map(e=>e.emoji))),o=a.find(e=>e.user_id===n.id);return(0,r.jsx)(N.P.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},exit:{opacity:0,scale:0},transition:{duration:.2,ease:"easeOut"},className:"flex justify-end",children:(0,r.jsx)("div",{className:"self-end text-xs text-black relative rounded-full mt-auto bg-gray-200 border-2 border-white p-1.5 -top-2",children:(0,r.jsxs)("div",{className:"flex justify-center",children:[l.map((e,t)=>(0,r.jsx)("div",{className:"text-center",children:e},t)),(0,r.jsx)("p",{className:"pl-1",children:(0,r.jsx)("span",{style:{color:o?s.accentColor:"black"},children:i})})]})})})}var P=n(4032),R=n(9597);function A(e){var t,n,s;let{message:i,user:l,hovered:c,reply:d,animate:u=!1,onOpenEmojiMenu:m,onResendMessage:x,theme:h=g,advertisementMessageId:p,onLinkClick:f,onReact:b}=e,v=i.sender===l.id,k=(n=i.hasPrevious,s=i.hasNext,v?"rounded-tl-3xl rounded-bl-3xl ".concat(n?"rounded-tr-sm":"rounded-tr-3xl"," ").concat(s?"rounded-br-sm":"rounded-br-3xl"):"rounded-tr-3xl rounded-br-3xl ".concat(n?"rounded-tl-sm":"rounded-tl-3xl"," ").concat(s?"rounded-bl-sm":"rounded-bl-3xl")),S="sending"===i.status,_="error"===i.status,T=null!=(t=i.edited)&&t,R=i.content,A=function(e){let t=e.trim();if(!t)return!1;let n=t.replace(/\s+/g,""),r=RegExp("(\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F)","gu"),s=n.match(r);return!!s&&s.join("")===n}(R)&&3>=function(e){let t=e.trim().replace(/\s+/g,""),n=RegExp("(\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F)","gu"),r=t.match(n);return r?r.length:0}(R),D=(0,j.d)(0),F=(0,w.G)(D,v?[0,-30,-40,-50]:[0,30,40,50],[0,.5,.8,1]),z=function(e){let{delay:t=500}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(0,a.useRef)(null),r=(0,a.useRef)(!1),s=(0,a.useCallback)(()=>{null!==n.current&&(clearTimeout(n.current),n.current=null)},[]),i=(0,a.useCallback)(s=>{r.current=!1,n.current=window.setTimeout(()=>{e(s)},t)},[e,t]),l=(0,a.useCallback)(e=>{r.current=!0,s()},[s]);return{onTouchStart:i,onTouchMove:l,onTouchEnd:(0,a.useCallback)(e=>{r.current||e.stopPropagation(),s()},[s]),onTouchCancel:(0,a.useCallback)(e=>{s()},[s])}}(e=>{if("deleted"===i.type)return;m();let t=new TouchEvent("pointerup",{bubbles:!0,cancelable:!0,composed:!0});e.target.dispatchEvent(t)});return(0,r.jsxs)("div",{className:"relative flex w-full items-center ".concat(v?"justify-end":"justify-start"),children:[(0,r.jsx)(N.P.div,{className:o("absolute p-2.5 rounded-full",v?"right-0":"left-0"),style:{background:"".concat(h.accentColor,"15"),scale:F},children:(0,r.jsx)(P.A,{className:o("w-4 h-4"),style:{color:h.accentColor}})}),!_&&v&&(0,r.jsx)("p",{className:"opacity-50 text-[0.70rem] self-end pr-2 pb-2 overflow-clip -mr-[80px] ".concat(p!==i.id||c?"invisible":"visible"),style:{color:y(h.chatBackground)},children:"AnimoChat.com"}),v&&(0,r.jsx)(C,{isUserMessage:i.sender===l.id,visible:c,theme:h,reply:d,onOpenEmojiMenu:m,isDeleted:"deleted"===i.type}),_&&v&&(0,r.jsxs)("p",{className:"opacity-50 text-[0.70rem] self-end pr-2 pb-2 overflow-clip text-red-800",children:["Error sending message."," ",(0,r.jsx)("span",{className:"underline cursor-pointer",onClick:()=>x(i),children:"Retry"})]}),(0,r.jsxs)(N.P.div,{id:"message-bubble",dragSnapToOrigin:!0,dragTransition:{bounceDamping:13},drag:"x",dragConstraints:{left:0,right:0},onDrag:(e,t)=>{if((!v||!(t.offset.x>0))&&(v||!(t.offset.x<0))){if(document.querySelector("#emoji-overlay-main")){if(D.set(0),e instanceof TouchEvent){var n;let t=new TouchEvent("touchstart",{bubbles:!0,cancelable:!0,composed:!0,touches:[e.touches[0]]});null==(n=document)||n.dispatchEvent(t)}return}D.set(t.offset.x)}},onDragEnd:(e,t)=>{(v&&t.offset.x<-50||!v&&t.offset.x>50)&&!document.querySelector("#emoji-overlay-main")&&d(),D.set(0)},whileTap:{scale:.8},style:{x:D,originX:+!!v,WebkitTapHighlightColor:"transparent"},onDoubleClick:()=>{b("❤️")},..."deleted"!==i.type&&{onContextMenu:e=>{e.preventDefault(),e.stopPropagation(),m()}},...z,initial:!!u&&{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",duration:.4},className:"max-w-[75%] mb-0.5 flex flex-col ".concat(v?"items-end":"items-start"," ").concat(S?"opacity-50":""),children:[T&&(0,r.jsx)("p",{className:"text-[0.70rem] px-2 text-gray-500",children:"Edited"}),i.replyingTo&&(0,r.jsx)(E,{message:i.replyingTo,isUserMessage:v,theme:h}),(null===i.type||void 0===i.type||"text"===i.type||"deleted"===i.type)&&(0,r.jsx)(I,{isLargeEmojiMessage:A,message:i,user:l,theme:h,isUserMessage:v,roundedCorners:k,onLinkClick:f}),"image"===i.type&&(0,r.jsx)(M,{user:l,message:i,roundedCorners:k,isUserMessage:v,theme:h})]},i.id+"-bubble"),!v&&(0,r.jsx)(C,{visible:c,theme:h,isUserMessage:!1,reply:d,onOpenEmojiMenu:m}),!v&&(0,r.jsx)("p",{className:"opacity-50 text-[0.70rem] self-end pl-2 pb-2 -ml-[70px] ".concat(p!==i.id||c?"invisible":"visible"),style:{color:y(h.chatBackground)},children:"AnimoChat.com"})]},i.id)}function M(e){let{user:t,message:n,roundedCorners:s,isUserMessage:i,theme:l}=e,[o,c]=(0,a.useState)(!1),d="rounded-3xl ".concat(s," ").concat(i?"rounded-tr-3xl":"rounded-tl-3xl");return(0,r.jsxs)("div",{id:"image-message-container",onClick:()=>c(!0),style:{cursor:"pointer"},children:[(0,r.jsxs)("div",{className:d,style:{overflow:"hidden",position:"relative",border:"2px solid transparent"},children:[(0,r.jsx)(R.A8,{src:n.content,children:(0,r.jsx)(S.default,{width:Math.min(.6*window.innerWidth,300),height:Math.min(.6*window.innerWidth,300),className:d,src:n.content,alt:"Image",style:{filter:o?"none":"blur(8px)",transition:"filter 0.3s ease-in-out",maxWidth:"100%",objectFit:"contain",backgroundColor:l.chatBackground},sizes:"(max-width: 768px) 70vw, 400px"})},n.id),!o&&(0,r.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:l.userTextColor,backgroundColor:"rgba(0, 0, 0, 0.4)",padding:"4px 8px",borderRadius:"0.25rem",pointerEvents:"none",fontSize:"0.85rem"},children:"(tap to reveal)"})]}),(0,r.jsx)(T,{message:n,user:t,theme:l})]})}function I(e){let{message:t,user:n,theme:s,isUserMessage:a,roundedCorners:i,isLargeEmojiMessage:l,onLinkClick:o}=e,c="deleted"===t.type;return(0,r.jsx)(r.Fragment,{children:l?(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"px-2 py-2",children:[(0,r.jsx)("p",{className:"text-5xl",children:t.content}),(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)(T,{message:t,user:n,theme:s})})]})}):(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsxs)("div",{className:"relative group",children:[(0,r.jsx)("div",{className:"".concat(i," animate-gradient-x"),style:{background:a?s.userBubbleGradient:s.otherBubbleGradient,backgroundSize:"200% 100%",color:a?s.userTextColor:s.otherTextColor}}),(0,r.jsx)("div",{className:"".concat(i," relative max-w-full break-words px-3 py-2 ").concat(!a&&s.otherAnimated||a&&s.userAnimated?"bg-white opacity-70":""),style:{wordBreak:"break-word",overflowWrap:"break-word",color:a?s.userTextColor:s.otherTextColor},children:(0,r.jsx)("p",{className:"break-words whitespace-pre-wrap",children:(0,r.jsx)(v.A,{options:{attributes:{target:"_blank",rel:"noopener noreferrer",className:"underline"},render:e=>{let{attributes:t,content:n}=e;return(0,r.jsx)("a",{...t,onClick:e=>{o?o(e):e.stopPropagation()},children:n})}},children:c?(0,r.jsx)("span",{className:"italic",children:"Message has been deleted."}):t.content})})})]}),(0,r.jsx)(T,{message:t,user:n,theme:s})]})})}function D(e){let{message:t,user:n,onSwipe:s,onReact:i,onStartedSwipe:l,onEndedSwipe:o,animate:c=!1,theme:d=g,advertisementMessageId:u,onOpenEmojiMenu:m=()=>{},onResendMessage:x=()=>{},isEmojiMenuOpen:h,onLinkClick:p}=e,[f,b]=(0,a.useState)(!1),[y,v]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{v("ontouchstart"in window||navigator.maxTouchPoints>0)},[]),(0,r.jsx)("div",{"data-message-id":"message-"+t.id,className:"relative px-4 select-none",onMouseEnter:()=>!y&&b(!0),onMouseLeave:()=>!y&&b(!1),children:(0,r.jsx)("div",{children:(0,r.jsx)(A,{onLinkClick:p,animate:c,message:t,user:n,hovered:f,reply:()=>s(t.id),onOpenEmojiMenu:()=>m(t),onReact:e=>i(t.id,e),onResendMessage:x,theme:d,advertisementMessageId:u},t.id+"-bubble")},"parent-message-bubble flex flex-col")})}function F(e){let{index:t,message:n,user:s,animate:a=!1,isLast:i=!1,onSwipe:l,onStartedSwipe:o,onEndedSwipe:c,onReact:d,onOpenEmojiMenu:u,onResendMessage:m,isEmojiMenuOpen:x,theme:h,secondVisibleElement:p,onLinkClick:f}=e;if("system"===n.sender)return(0,r.jsx)("div",{className:"flex justify-center py-4 px-4 text-center",children:(0,r.jsx)("p",{className:"text-xs text-gray-500",children:n.content})},n.id+"_system");let g=t%5==0?n.id:null;return(0,r.jsxs)("div",{"data-is-message":"true","data-message-id":n.id,className:"max-w-full w-full select-none",children:[n.showTime&&(0,r.jsx)("div",{className:"flex justify-center py-4",children:(0,r.jsx)("p",{className:"text-xs text-gray-500 font-normal",children:n.created_at&&(0,b.GP)(new Date(n.created_at),"h:mm a")})},n.id+"_time"),(0,r.jsx)(D,{advertisementMessageId:g,message:n,animate:a,user:s,onSwipe:l,onStartedSwipe:o,onEndedSwipe:c,onReact:d,onOpenEmojiMenu:u,onResendMessage:m,theme:h,isEmojiMenuOpen:x,onLinkClick:f},n.id+"_message"),(i||!n.hasNext)&&(0,r.jsx)("div",{className:"h-1"},n.id+"_bottom")]},"parent_message_"+n.id)}var z=n(760);let B=["❤️","\uD83D\uDE06","\uD83D\uDE2E","\uD83D\uDE22","\uD83D\uDE2D","\uD83D\uDE21","\uD83D\uDC4D"];function L(e){let{isUserMessage:t,preselectedEmoji:n,message:s,messageDiv:i,onReact:l,onClose:o}=e,c=(0,a.useRef)(null),[d,u]=(0,a.useState)({top:0,left:0}),[m,x]=(0,a.useState)(null);return(0,a.useLayoutEffect)(()=>{let e=i.querySelector("#message-bubble");if(e.style.position="relative",e.style.zIndex="30",e&&c.current){let t=e.getBoundingClientRect(),n=c.current,r=n.offsetHeight,s=t.top;s+=window.scrollY,s-=r+10;let a=t.right-n.offsetWidth-16;e.classList.contains("items-end")||(a=t.left-16),u({top:s,left:a})}return()=>{e.style.zIndex="0"}},[i]),(0,a.useEffect)(()=>{let e=e=>{if(!c.current)return;let t=document.elementFromPoint(e.clientX,e.clientY);if(t){let e=t.closest("[data-emoji]");if(e)return void x(e.getAttribute("data-emoji"))}x(null)},t=e=>{console.log("Pointer up event:",e),m&&(l(s.id,(null==n?void 0:n.emoji)===m?null:m),o())};return window.addEventListener("pointermove",e),window.addEventListener("pointerup",t),()=>{window.removeEventListener("pointermove",e),window.removeEventListener("pointerup",t)}},[m,l,o,n,s.id]),(0,a.useEffect)(()=>{if(c.current){let e=new PointerEvent("pointerdown",{bubbles:!0,cancelable:!0});c.current.dispatchEvent(e)}},[]),(0,r.jsx)(N.P.div,{layout:!0,className:"absolute top-0 left-0 w-screen h-screen",initial:{userSelect:"none",zIndex:100,opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:(0,r.jsx)("div",{id:"emoji-abs-container",className:"absolute border-box flex z-50 w-full md:w-fit px-4",style:{position:"absolute",top:d.top,left:d.left},children:(0,r.jsx)(N.P.div,{ref:c,id:"emoji-container-wrapper",className:"w-full backdrop-blur-md bg-gray-100 py-2 px-5 dark:bg-gray-800/80 shadow-lg rounded-full border border-gray-200 dark:border-gray-700",initial:{scale:.8,opacity:0,y:10},animate:{scale:1,opacity:1,y:0,transition:{type:"spring",stiffness:300,damping:20}},exit:{scale:.8,opacity:0,y:10,transition:{duration:.15}},children:(0,r.jsx)("div",{id:"emoji-container",className:"flex justify-between",children:(0,r.jsx)(z.N,{children:B.map(e=>(0,r.jsxs)(N.P.div,{className:"relative z-10 cursor-pointer rounded-full p-2 ".concat((null==n?void 0:n.emoji)===e?"bg-gray-200/80 dark:bg-gray-700/80":m===e?"bg-gray-100/80 dark:bg-gray-600/80":""),"data-emoji":e,animate:{scale:m===e?1.6:1},transition:{type:"spring",stiffness:300,damping:20},children:[(0,r.jsx)("span",{className:"text-xl",children:e}),(null==n?void 0:n.emoji)===e&&(0,r.jsx)(N.P.div,{className:"absolute -bottom-0.5 left-1/2 w-1 h-1 bg-green-500 rounded-full",initial:{opacity:0},animate:{opacity:1},layoutId:"selectedDot",style:{translateX:"-50%"}})]},e))})})})})},"emoji-menu")}var O=n(4357),G=n(3717),q=n(4126);function W(e){let{theme:t,anchor:n,onReply:s,onCopy:i,onEdit:l,onClose:o,onDelete:c}=e,d=n.querySelector("#message-bubble"),u=d.classList.contains("items-end"),m=null!==d.querySelector("#image-message-container"),x=[{icon:(0,r.jsx)(P.A,{className:"h-4 w-4"}),text:"Reply",onClick:s},{icon:(0,r.jsx)(O.A,{className:"h-4 w-4"}),text:"Copy",onClick:i},...u&&!m?[{icon:(0,r.jsx)(G.A,{className:"h-4 w-4"}),text:"Edit",onClick:l}]:[],...u?[{icon:(0,r.jsx)(q.A,{className:"h-4 w-4"}),text:"Delete",onClick:c}]:[]],[h,p]=(0,a.useState)({top:0,left:0}),[f,g]=(0,a.useState)(null),b=(0,a.useRef)(null),y=(0,a.createRef)();return(0,a.useEffect)(()=>{b.current=f},[f]),(0,a.useLayoutEffect)(()=>{if(!n||!y.current)return;let e=n.querySelector("#message-bubble"),t=document.querySelector("#chat-container"),r=e.getBoundingClientRect(),s=y.current.getBoundingClientRect(),a=r.bottom+10;if(a+s.height>t.clientHeight/2){a=r.top-s.height-10;let e=document.querySelector("#emoji-abs-container");e&&(e.style.top="".concat(a-s.height,"px"),a-=e.offsetHeight+24)}a+=window.scrollY;let i=r.right-s.width-24;u||(i=r.left),p({top:a,left:i})},[n,u]),(0,a.useEffect)(()=>{let e=e=>{if(!y.current)return;let t=y.current.querySelectorAll("button"),n=null;t.forEach((t,r)=>{let s=t.getBoundingClientRect();e.clientX>=s.left&&e.clientX<=s.right&&e.clientY>=s.top&&e.clientY<=s.bottom&&(n=r)}),g(n)},t=e=>{if(null!==b.current&&y.current){let e=y.current.querySelectorAll("button")[b.current];e&&e.click()}};window.addEventListener("pointermove",e),window.addEventListener("pointerup",t);let n=new PointerEvent("pointerdown",{bubbles:!0});return window.dispatchEvent(n),()=>{window.removeEventListener("pointermove",e),window.removeEventListener("pointerup",t)}},[]),(0,r.jsx)(N.P.div,{ref:y,id:"context-menu",className:"absolute flex flex-col rounded-3xl w-[200px] overflow-clip",style:{background:(null==t?void 0:t.chatBackground)||"linear-gradient(180deg, #ffffff, #ffffff)",top:h.top,left:h.left},initial:{opacity:0,scale:.9,transition:{type:"spring",stiffness:300,damping:20}},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9,transition:{duration:.15}},children:x.map((e,t)=>(0,r.jsx)(U,{icon:e.icon,text:e.text,onClick:()=>{e.onClick(),o()},active:f===t},t))})}function U(e){let{icon:t,text:n,onClick:s,active:a}=e;return(0,r.jsx)("div",{children:(0,r.jsxs)("button",{onClick:s,className:"flex items-center justify-start w-full px-6 py-4 text-sm text-black hover:bg-gray-200 ".concat(a?"bg-gray-200":""),children:[(0,r.jsx)("p",{className:"mr-auto",children:n}),t]})})}let Y=e=>{var t;let{open:n,message:s,messageDiv:a,user:i,onReact:l,onClose:o,onCopy:c,onEdit:d,onReply:u,onDelete:m}=e;return(0,r.jsx)(z.N,{children:n&&(0,r.jsxs)("div",{id:"emoji-overlay-main",className:"overflow-visible absolute left-0 top-0 select-none",children:[(0,r.jsx)(N.P.div,{layout:!0,initial:{opacity:0},animate:{opacity:.5},exit:{opacity:0},className:"fixed inset-0 bg-black z-30",onClick:o},"emoji-overlay"),(0,r.jsxs)("div",{className:"relative z-40 w-full",children:[(0,r.jsx)(L,{isUserMessage:s.sender===i.id,preselectedEmoji:null==(t=s.reactions)?void 0:t.find(e=>e.user_id===i.id),messageDiv:a,message:s,onReact:l,onClose:o},"emoji-menu"),(0,r.jsx)(W,{onCopy:()=>c(s.id),onEdit:()=>d(s.id),onReply:()=>u(s.id),onDelete:()=>m(s.id),onClose:o,theme:g,anchor:a},"context-menu")]},"context-container")]},"emoji-overlay-main")})};function H(e){let{messages:t,sendMessage:n,endChat:s,onReact:i,peerId:l,status:o}=e,[d,u]=(0,a.useState)(""),x=(0,a.useRef)(null),h=(0,a.useRef)(!1),[p,f]=(0,a.useState)({open:!1}),b=(0,a.useRef)(!1),y=function(e){let[t,n]=(0,a.useState)([]);return(0,a.useEffect)(()=>{if(!e||0===e.length)return void n([]);let t=null,r=[];for(let n=0;n<e.length;n++){let s=e[n],a=new Date(s.created_at).getTime(),i=!1;isNaN(a)?console.warn("Invalid date encountered for message:",s.id):"system"!==s.sender&&"typing"!==s.id&&"filler"!==s.id&&(null===t||a-t>3e5)&&(i=!0,t=a),r.push({...s,showTime:i,hasPrevious:!1,hasNext:!1})}for(let e=0;e<r.length;e++){let t=r[e],n=r[e-1],s=r[e+1];t.hasPrevious=!!n&&n.sender===t.sender,t.hasNext=!!s&&s.sender===t.sender,t.showTime&&n&&(t.hasPrevious=!1,n.hasNext=!1),t.reactions&&t.reactions.length>0&&s&&(t.hasNext=!1,s.sender===t.sender&&(s.hasPrevious=!1)),t.replyingTo&&n&&(t.hasPrevious=!1,n.sender===t.sender&&(n.hasNext=!1)),t.replyingTo&&s&&(t.hasNext=!1,s.sender===t.sender&&(s.hasPrevious=!1)),n&&n.replyingTo&&(t.hasPrevious=!1,n.hasNext=!1);let a=r[e+1];a&&("system"===a.sender||"typing"===a.id||"filler"===a.id)&&(t.hasNext=!1)}let s=null,a=r.findIndex(e=>"typing"===e.id);-1!==a&&(s=r.splice(a,1)[0]);let i=new Set,l=r.filter(e=>!i.has(e.id)&&(i.add(e.id),!0));s&&l.push(s),n(l)},[e]),t}(t),v=e=>{if(!e){f({open:!1}),b.current=!1;return}let t=document.querySelector('[data-message-id="'.concat(null==e?void 0:e.id,'"]'));t&&(b.current=!0,f({open:!0,message:e,messageDiv:t}))};return(0,a.useEffect)(()=>{x.current&&(x.current.scrollTop=x.current.scrollHeight)},[t]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Y,{open:p.open,message:p.message,messageDiv:p.messageDiv,user:{id:l},onReact:i,onReply:()=>{},onEdit:()=>{},onCopy:()=>{},onDelete:()=>{},onClose:()=>v(null)}),(0,r.jsxs)("div",{id:"chat-container",className:"w-full max-w-md mx-auto h-screen flex flex-col bg-white/70 backdrop-blur-xl sm:rounded-[2rem] shadow-2xl overflow-hidden",children:[(0,r.jsxs)("div",{className:"p-4 bg-white/60 border-b border-gray-200/80 flex justify-between items-center shrink-0",children:[(0,r.jsxs)("div",{className:"text-left",children:[(0,r.jsx)("p",{className:"text-xs font-medium text-gray-500",children:"Status"}),(0,r.jsx)("p",{className:"text-sm font-semibold text-green-600",children:o})]}),(0,r.jsx)(m,{onClick:s,variant:"destructive",size:"sm",className:"rounded-full",children:"End Chat"})]}),(0,r.jsx)("div",{ref:x,className:"flex-grow overflow-y-auto p-4",children:y.map((e,n)=>"System"===e.sender?(0,r.jsx)("div",{className:"text-center my-2",children:(0,r.jsx)("span",{className:"text-xs text-gray-500 bg-gray-100 rounded-full px-3 py-1",children:e.content})},n):(0,r.jsx)(F,{index:n,message:e,user:{id:l},isLast:n===t.length-1,onSwipe:()=>{},onStartedSwipe:()=>{},onEndedSwipe:()=>{},onReact:i,onOpenEmojiMenu:()=>v(e),onResendMessage:()=>{},isEmojiMenuOpen:h,theme:g,animate:!0,secondVisibleElement:null},n))}),(0,r.jsx)("div",{className:"p-4 bg-white/60 border-t border-gray-200/80 shrink-0",children:(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault();let t=d.trim();t&&(n(t),u(""))},className:"flex space-x-3",children:[(0,r.jsx)(c,{type:"text",value:d,onChange:e=>u(e.target.value),placeholder:"Type a message...",className:"flex-grow p-3 border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500 bg-white/80",autoComplete:"off",required:!0}),(0,r.jsx)(m,{type:"submit",className:"bg-green-500 text-white font-bold w-12 h-12 rounded-full hover:bg-green-600 flex items-center justify-center shadow-lg",children:(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("line",{x1:"12",y1:"19",x2:"12",y2:"5"}),(0,r.jsx)("polyline",{points:"5 12 12 5 19 12"})]})})]})}),(0,r.jsx)("footer",{className:"p-2 text-center text-xs text-gray-500 bg-white/60 border-t border-gray-200/80 shrink-0",children:"not all features are implemented, still in early stages -@tyronscott_"})]})]})}var X=n(1368);let J=()=>{let[e,t]=(0,a.useState)("intro"),[r,s]=(0,a.useState)(""),[i,l]=(0,a.useState)(null),[o,c]=(0,a.useState)("Initializing..."),[d,u]=(0,a.useState)(!1),[m,x]=(0,a.useState)([]),[h,p]=(0,a.useState)(!1),f=(0,a.useRef)(null),g=(0,a.useRef)(null),b=(0,a.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Ready to connect";i&&i.close(),g.current&&g.current.close(),l(null),x([]),t("matchmaking"),c(e),u(!1)},[i]),y=(0,a.useCallback)((e,t,n)=>{x(r=>r.map(r=>{let s;if(r.id!==e||"system"===r.type)return r;let a=r.reactions||[],i=a.findIndex(e=>e.user_id===n);return i>-1?t?(s=[...a])[i]={user_id:n,emoji:t}:s=a.filter((e,t)=>t!==i):s=t?[...a,{user_id:n,emoji:t}]:a,{...r,reactions:s}}))},[]),v=async(e,t)=>{if(h)return void console.log("Reactions are disabled for outdated clients.");y(e,t||null,r),i&&i.open&&i.send({type:"reaction",payload:{messageId:e,emoji:t||null,userId:r}})};(0,a.useEffect)(()=>{if(i){var e;p(!1);let t=(null==(e=i.metadata)?void 0:e.interest)||"an unknown topic";x([{id:(0,X.A)(),content:"Connected with a stranger on: ".concat(t),type:"system",sender:"system",created_at:new Date().toISOString(),session_id:"1"}]),i.on("data",e=>{let t;if("string"==typeof e){p(!0);let t={id:(0,X.A)(),content:e,sender:i.peer,type:"user",reactions:[],session_id:"1",created_at:new Date().toISOString()};x(e=>[...e,t]);let n="outdated-client-warning";x(e=>e.find(e=>e.id===n)?e:[...e,{id:n,content:"Your chat partner is using an outdated version. Reactions and other features are disabled.",type:"system",sender:"system",created_at:new Date().toISOString(),session_id:"1"}]),i.send("Your chat partner is using a new version of AnimoChat. Please refresh the page to get the latest features!");return}try{t="object"==typeof e&&null!==e?e:JSON.parse(e)}catch(t){console.error("Failed to parse incoming data:",e);return}if("message"===t.type){let e=t.payload;x(t=>[...t,e])}else if("reaction"===t.type){let{messageId:e,emoji:n,userId:r}=t.payload;y(e,n,r)}}),i.on("close",()=>{let e={id:(0,X.A)(),content:"Stranger has disconnected.",type:"system",sender:"system",created_at:new Date().toISOString(),session_id:"1"};x(t=>[...t,e]),b("Stranger disconnected. Find a new match.")})}},[i,b,y]);let j=(0,a.useCallback)(()=>{f.current||n.e(723).then(n.bind(n,5723)).then(e=>{let{default:n}=e,r=new n;f.current=r,r.on("open",e=>{s(e),c("Ready to connect"),u(!1)}),r.on("connection",e=>{l(e),t("chat"),u(!1)}),r.on("error",e=>{console.error("PeerJS error:",e),b("Error: ".concat(e.type))})}).catch(e=>console.error("Failed to load PeerJS",e))},[b]),w=(0,a.useCallback)(e=>{if(!r||0===e.length||!f.current)return;c("Finding a match..."),u(!0);let n=e.join(","),s=new EventSource("".concat("https://animochat-turn-server.onrender.com","/matchmaking?userId=").concat(r,"&interest=").concat(n));g.current=s,s.onopen=()=>c("Waiting for a match..."),s.onmessage=e=>{try{let n=JSON.parse(e.data);if("MATCHED"===n.state&&f.current){c("Match found! Connecting...");let e=f.current.connect(n.matchedUserId,{metadata:{interest:n.interest}});l(e),t("chat"),u(!1),s.close()}}catch(e){console.error("Failed to parse matchmaking data:",e)}},s.onerror=()=>{console.error("Matchmaking EventSource error."),b("Connection error. Please try again.")}},[r,b]);return(0,a.useEffect)(()=>()=>{f.current&&f.current.destroy(),g.current&&g.current.close()},[]),{screen:e,peerId:r,status:o,isConnecting:d,conn:i,messages:m,isPeerOutdated:h,handleGetStarted:()=>{u(!0),t("matchmaking"),f.current||j()},startMatchmaking:w,endChat:()=>{let e={id:(0,X.A)(),content:"You have ended the chat.",type:"system",sender:"system",created_at:new Date().toISOString(),session_id:"1"};x(t=>[...t,e]),b("Chat ended. Find a new match.")},sendMessage:e=>{if(i&&i.open&&e){let t={id:(0,X.A)(),content:e,sender:r,session_id:"1",created_at:new Date().toISOString(),reactions:[],type:"user"};h?i.send(t.content):i.send({type:"message",payload:t}),x(e=>[...e,t])}},onReact:v}};function V(){let{screen:e,peerId:t,status:n,isConnecting:i,messages:l,handleGetStarted:o,startMatchmaking:c,endChat:d,sendMessage:u,onReact:x,isPeerOutdated:h}=J(),[p,g]=(0,a.useState)(new Set),b=e=>{0!==e.size&&c(Array.from(e))};return(0,r.jsx)("div",{className:"h-full overflow-y-auto overflow-x-hidden",children:(0,r.jsxs)("main",{className:"container h-full mx-auto flex flex-col ".concat("chat"===e?"p-0":"px-4 py-8 md:py-16"),children:["chat"!==e&&(0,r.jsx)(s,{}),(0,r.jsx)("div",{className:"flex-grow flex flex-col justify-center items-center",children:(()=>{switch(e){case"chat":return(0,r.jsx)("div",{className:"h-full w-full flex items-center justify-center sm:p-4",children:(0,r.jsx)(H,{onReact:x,messages:l,sendMessage:u,endChat:d,peerId:t,status:n})});case"matchmaking":return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"max-w-3xl mx-auto relative w-full",children:(0,r.jsxs)("div",{className:"text-center mb-12",children:[(0,r.jsx)("h2",{className:"text-4xl md:text-6xl font-bold bg-gradient-to-r from-green-600 to-green-400 bg-clip-text text-transparent",children:"Choose Your Interests"}),(0,r.jsx)("p",{className:"text-gray-600 text-lg my-8",children:"Find someone to chat with based on what you like."})]})}),(0,r.jsx)(f,{interests:p,onInterestsChange:g,onFindMatch:b,isConnecting:i,status:n})]});default:return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"max-w-3xl mx-auto relative w-full",children:(0,r.jsxs)("div",{className:"text-center mb-12",children:[(0,r.jsxs)("h2",{className:"text-4xl md:text-6xl font-bold bg-gradient-to-r from-green-600 to-green-400 bg-clip-text text-transparent",children:["Real-time",(0,r.jsx)("br",{}),"Anonymous Chat"]}),(0,r.jsx)("p",{className:"text-gray-600 text-lg my-8",children:"Connect with students anonymously and securely."})]})}),(0,r.jsxs)("div",{className:"max-w-md mx-auto text-sm space-y-6 text-center",children:[(0,r.jsxs)("details",{className:"text-gray-500 bg-gray-50/80 p-3 rounded-2xl border border-gray-200",children:[(0,r.jsx)("summary",{className:"cursor-pointer font-medium hover:text-green-600",children:"What is Peer-to-Peer (P2P) Chat?"}),(0,r.jsx)("p",{className:"mt-2 text-left",children:'Peer-to-Peer chat means your messages go directly to the other user without passing through a central server. This provides better privacy and can be faster. Our server only helps to "introduce" two users to each other.'})]}),(0,r.jsx)("div",{className:"text-red-700 bg-red-50 p-4 rounded-2xl border border-red-200 font-medium",children:(0,r.jsx)("p",{children:"This is a test version of AnimoChat. Not all features are implemented, and you may encounter bugs."})})]}),(0,r.jsx)("div",{className:"text-center mt-12",children:(0,r.jsx)(m,{onClick:o,disabled:i,size:"lg",className:"rounded-full py-7 px-8 bg-green-500 hover:bg-green-600 text-white font-bold text-lg",children:i?"Initializing...":"Get Started"})})]})}})()}),"chat"!==e&&(0,r.jsxs)("footer",{className:"text-xs text-gray-500 text-center py-4 shrink-0",children:[(0,r.jsxs)("h3",{className:"py-4",children:["Created by developers from"," ",(0,r.jsx)("span",{className:"text-green-700 font-semibold",children:"De La Salle Lipa"})]}),t&&(0,r.jsxs)("p",{className:"font-mono text-gray-400 text-[10px] mt-2",children:["Your Peer ID: ",t]})]})]})})}},3287:()=>{},6379:(e,t,n)=>{Promise.resolve().then(n.bind(n,2975))},7351:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[817,576,441,684,358],()=>t(6379)),_N_E=e.O()}]);